<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Calvin">

<title>IEEE 754 ‚Äì Systems in Rust</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./42_sha512.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-a4a11d514c7d463668e07712114998e6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70c9a4798e5f6abb0636bcdc3eed0e90.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./50_754.html">IEEE 754</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Systems in Rust</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_welcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_rustup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rustup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_hiworld.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hi world</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Packages</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_hicargo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hi cargo</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Options</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_guess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guess</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_wordle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wordle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_bits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_hamming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hamming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_macros.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Macros</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./40_sha2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SHA-2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41_constants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Constants</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42_sha512.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SHA-512</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_754.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">IEEE 754</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#announcements" id="toc-announcements" class="nav-link active" data-scroll-target="#announcements">Announcements</a></li>
  <li><a href="#today" id="toc-today" class="nav-link" data-scroll-target="#today">Today</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  <li><a href="#mission-statement" id="toc-mission-statement" class="nav-link" data-scroll-target="#mission-statement">Mission Statement</a></li>
  <li><a href="#common-fallacies" id="toc-common-fallacies" class="nav-link" data-scroll-target="#common-fallacies">Common Fallacies</a></li>
  <li><a href="#common-fallacies-2.0" id="toc-common-fallacies-2.0" class="nav-link" data-scroll-target="#common-fallacies-2.0">Common Fallacies 2.0</a></li>
  <li><a href="#anatomy-of-ieee-floats" id="toc-anatomy-of-ieee-floats" class="nav-link" data-scroll-target="#anatomy-of-ieee-floats">Anatomy of IEEE Floats</a></li>
  <li><a href="#ieee-float-specification" id="toc-ieee-float-specification" class="nav-link" data-scroll-target="#ieee-float-specification">IEEE Float Specification</a></li>
  <li><a href="#assurances" id="toc-assurances" class="nav-link" data-scroll-target="#assurances">Assurances</a></li>
  <li><a href="#assurances-2.0" id="toc-assurances-2.0" class="nav-link" data-scroll-target="#assurances-2.0">Assurances 2.0</a></li>
  <li><a href="#ieee-float-specification-1" id="toc-ieee-float-specification-1" class="nav-link" data-scroll-target="#ieee-float-specification-1">IEEE Float Specification</a></li>
  <li><a href="#aside-scientific-notation" id="toc-aside-scientific-notation" class="nav-link" data-scroll-target="#aside-scientific-notation">Aside: Scientific Notation</a></li>
  <li><a href="#aside-explanation" id="toc-aside-explanation" class="nav-link" data-scroll-target="#aside-explanation">Aside: Explanation</a></li>
  <li><a href="#aside-physical-examples" id="toc-aside-physical-examples" class="nav-link" data-scroll-target="#aside-physical-examples">Aside: Physical Examples</a></li>
  <li><a href="#aside-economic-examples" id="toc-aside-economic-examples" class="nav-link" data-scroll-target="#aside-economic-examples">Aside: Economic Examples</a></li>
  <li><a href="#ieee-layout" id="toc-ieee-layout" class="nav-link" data-scroll-target="#ieee-layout">IEEE Layout</a></li>
  <li><a href="#with-binary" id="toc-with-binary" class="nav-link" data-scroll-target="#with-binary">With Binary</a></li>
  <li><a href="#singles-and-doubles" id="toc-singles-and-doubles" class="nav-link" data-scroll-target="#singles-and-doubles">Singles and Doubles</a></li>
  <li><a href="#understanding-check" id="toc-understanding-check" class="nav-link" data-scroll-target="#understanding-check">Understanding check</a></li>
  <li><a href="#special-floats---nan" id="toc-special-floats---nan" class="nav-link" data-scroll-target="#special-floats---nan">Special Floats - NaN</a></li>
  <li><a href="#special-floats---inf" id="toc-special-floats---inf" class="nav-link" data-scroll-target="#special-floats---inf">Special Floats - inf</a></li>
  <li><a href="#infinity-is-signed" id="toc-infinity-is-signed" class="nav-link" data-scroll-target="#infinity-is-signed">Infinity is signed</a></li>
  <li><a href="#signed-zero" id="toc-signed-zero" class="nav-link" data-scroll-target="#signed-zero">Signed Zero</a></li>
  <li><a href="#simple-example" id="toc-simple-example" class="nav-link" data-scroll-target="#simple-example">Simple Example</a></li>
  <li><a href="#simple-example-1" id="toc-simple-example-1" class="nav-link" data-scroll-target="#simple-example-1">Simple Example</a></li>
  <li><a href="#storage-of-1." id="toc-storage-of-1." class="nav-link" data-scroll-target="#storage-of-1.">Storage of 1.</a></li>
  <li><a href="#except" id="toc-except" class="nav-link" data-scroll-target="#except">Except‚Ä¶</a></li>
  <li><a href="#shift-127" id="toc-shift-127" class="nav-link" data-scroll-target="#shift-127">Shift 127</a></li>
  <li><a href="#breakdown" id="toc-breakdown" class="nav-link" data-scroll-target="#breakdown">Breakdown</a></li>
  <li><a href="#how-precise" id="toc-how-precise" class="nav-link" data-scroll-target="#how-precise">How precise?</a></li>
  <li><a href="#epsilon" id="toc-epsilon" class="nav-link" data-scroll-target="#epsilon">‚ÄúEpsilon‚Äù</a></li>
  <li><a href="#easier-sig-figs" id="toc-easier-sig-figs" class="nav-link" data-scroll-target="#easier-sig-figs">Easier: ‚ÄúSig figs‚Äù</a></li>
  <li><a href="#sig-figs" id="toc-sig-figs" class="nav-link" data-scroll-target="#sig-figs">Sig figs</a></li>
  <li><a href="#small-values" id="toc-small-values" class="nav-link" data-scroll-target="#small-values">Small Values</a></li>
  <li><a href="#test-it" id="toc-test-it" class="nav-link" data-scroll-target="#test-it">Test it</a></li>
  <li><a href="#denormalized-number" id="toc-denormalized-number" class="nav-link" data-scroll-target="#denormalized-number">‚ÄúDenormalized Number‚Äù</a></li>
  <li><a href="#floating-point-precision" id="toc-floating-point-precision" class="nav-link" data-scroll-target="#floating-point-precision">Floating Point Precision</a></li>
  <li><a href="#visually" id="toc-visually" class="nav-link" data-scroll-target="#visually">Visually</a></li>
  <li><a href="#floating-point-precision-1" id="toc-floating-point-precision-1" class="nav-link" data-scroll-target="#floating-point-precision-1">Floating Point Precision</a></li>
  <li><a href="#errors-in-floating-point" id="toc-errors-in-floating-point" class="nav-link" data-scroll-target="#errors-in-floating-point">Errors in Floating Point</a></li>
  <li><a href="#measuring-error-ulps" id="toc-measuring-error-ulps" class="nav-link" data-scroll-target="#measuring-error-ulps">Measuring Error: ‚ÄúUlps‚Äù</a></li>
  <li><a href="#generators" id="toc-generators" class="nav-link" data-scroll-target="#generators">Generators</a></li>
  <li><a href="#iterators" id="toc-iterators" class="nav-link" data-scroll-target="#iterators">Iterators</a></li>
  <li><a href="#on-ulps" id="toc-on-ulps" class="nav-link" data-scroll-target="#on-ulps">On ‚ÄúUlps‚Äù</a></li>
  <li><a href="#rounding" id="toc-rounding" class="nav-link" data-scroll-target="#rounding">Rounding</a></li>
  <li><a href="#relative-error" id="toc-relative-error" class="nav-link" data-scroll-target="#relative-error">Relative Error</a>
  <ul class="collapse">
  <li><a href="#rounding-error" id="toc-rounding-error" class="nav-link" data-scroll-target="#rounding-error">Rounding Error</a></li>
  <li><a href="#rounding-error-1" id="toc-rounding-error-1" class="nav-link" data-scroll-target="#rounding-error-1">Rounding Error</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#special-bits" id="toc-special-bits" class="nav-link" data-scroll-target="#special-bits">Special bits</a></li>
  <li><a href="#significance-error" id="toc-significance-error" class="nav-link" data-scroll-target="#significance-error">Significance Error</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">0.012345000170171261000000000000 !=</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">0.0148140005767345430</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">(-0.002469000406563282000000000000)</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">12.345000267028809000000000000000 !=</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">11.701118469238281000000000000000</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">(0.643881797790527340000000000000)</a></li>
  <li><a href="#ùë•" id="toc-ùë•" class="nav-link" data-scroll-target="#ùë•">ùë•</a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6">10. 0</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#demystifying-floating-point" id="toc-demystifying-floating-point" class="nav-link" data-scroll-target="#demystifying-floating-point">Demystifying Floating Point</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="50_754.rjs.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">IEEE 754</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
<p class="subtitle lead">Systems in Rust</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Calvin </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="announcements" class="level2">
<h2 class="anchored" data-anchor-id="announcements">Announcements</h2>
<ul>
<li><strong>Welcome</strong> to Systems in Rust</li>
<li><strong>Action Items</strong>:
<ul>
<li>‚ÄúSHA-512‚Äù is due on next Friday</li>
<li>Lecture on numbers, inspired by the lab, while we wait.</li>
</ul></li>
</ul>
</section>
<section id="today" class="level2">
<h2 class="anchored" data-anchor-id="today">Today</h2>
<ul>
<li>Understand the basics of floats</li>
<li>Understand the language of floats</li>
<li>Get a feel for when further investigation is required</li>
<li>Have a few tools ready to help</li>
<li>Be prepared to keep learning about IEEE floats</li>
</ul>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">Citation</h2>
<ul>
<li>Yoinked</li>
<li><a href="https://github.com/DigitalInBlue/CPPCon2015">url</a></li>
<li>Author John Farrier, Booz Allen Hamilton</li>
</ul>
</section>
<section id="mission-statement" class="level2">
<h2 class="anchored" data-anchor-id="mission-statement">Mission Statement</h2>
<ul>
<li>I‚Äôm a normal person.
<ul>
<li>I think <code>5/2</code> is <code>2.5</code> or perhaps 2¬Ω.</li>
</ul></li>
<li>I‚Äôm a scientist.
<ul>
<li>I‚Äôm solving ‚ÄúBlack-Scholes‚Äù</li>
<li><a href="https://numba.pydata.org/numba-examples/examples/finance/blackscholes/results.html">Does anyone know what this is doing?</a> <span class="math display">\[
d_2 = d_1 - \sigma\sqrt{T - t} = \frac{1}{\sigma\sqrt{T - t}}\left[\ln\left(\frac{S_t}{K}\right) + \left(r - q - \frac{1}{2}\sigma^2\right)(T - t)\right]
\]</span></li>
</ul></li>
</ul>
</section>
<section id="common-fallacies" class="level2">
<h2 class="anchored" data-anchor-id="common-fallacies">Common Fallacies</h2>
<ul>
<li>‚ÄúFloating point numbers are numbers‚Äù
<ul>
<li><code>max(count())</code> Pinocchios</li>
</ul></li>
<li>‚ÄúIt‚Äôs floating point error‚Äù
<ul>
<li>‚ÄúAll floating point involves magical rounding errors‚Äù</li>
</ul></li>
<li>‚ÄúLinux and Windows handle floats differently‚Äù</li>
<li>‚ÄúFloating point represents an interval value near the actual value‚Äù</li>
</ul>
</section>
<section id="common-fallacies-2.0" class="level2">
<h2 class="anchored" data-anchor-id="common-fallacies-2.0">Common Fallacies 2.0</h2>
<ul>
<li>‚ÄúA double (an <code>f64</code>) holds 15 decimal places and I only need 3, so I have nothing to worry about‚Äù<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>‚ÄúMy programming language does better math than your programming language‚Äù<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>‚ÄúWhy can‚Äôt computers just store whatever number I use‚Äù<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ul>
</section>
<section id="anatomy-of-ieee-floats" class="level2">
<h2 class="anchored" data-anchor-id="anatomy-of-ieee-floats">Anatomy of IEEE Floats</h2>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/IEEE754.svg/550px-IEEE754.svg.png" class="img-fluid"></p>
</section>
<section id="ieee-float-specification" class="level2">
<h2 class="anchored" data-anchor-id="ieee-float-specification">IEEE Float Specification</h2>
<ul>
<li>IEEE 754-1985, IEEE 854-1987, IEEE 754-2008
<ul>
<li>These are paywalled.</li>
<li>Those are years.</li>
</ul></li>
<li>Provide for portable, provably consistent math
<ul>
<li>Consistent, not correct.</li>
</ul></li>
</ul>
</section>
<section id="assurances" class="level2">
<h2 class="anchored" data-anchor-id="assurances">Assurances</h2>
<ul>
<li>Ensure some significant mathematical identities hold true:
<ul>
<li><span class="math inline">\(x + y  = y + x\)</span>
<ul>
<li>Symmetry of addition</li>
</ul></li>
<li><span class="math inline">\(x + 0 = x\)</span>
<ul>
<li>Additive identity</li>
</ul></li>
<li><span class="math inline">\(x = y \implies x - y = 0\)</span>
<ul>
<li>Identity under subtraction</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="assurances-2.0" class="level2">
<h2 class="anchored" data-anchor-id="assurances-2.0">Assurances 2.0</h2>
<p><span class="math display">\[
\frac{x}{\sqrt{x^2+y^2}} \leq 1
\]</span></p>
<ul>
<li>What is missing?</li>
</ul>
</section>
<section id="ieee-float-specification-1" class="level2">
<h2 class="anchored" data-anchor-id="ieee-float-specification-1">IEEE Float Specification</h2>
<ul>
<li>Ensure every floating point number is unique</li>
<li>Ensure every floating point number has an opposite
<ul>
<li><em>Zero</em> is a special case because of this</li>
</ul></li>
<li>Specifies algorithms for addition, subtraction, multiplication, division, and square-root
<ul>
<li>Not really operations/relations! They are algorithms.</li>
</ul></li>
</ul>
</section>
<section id="aside-scientific-notation" class="level2">
<h2 class="anchored" data-anchor-id="aside-scientific-notation">Aside: Scientific Notation</h2>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Scientific_notation">Scientific notation is a way of expressing numbers that are too large or too small to be conveniently written in decimal form, since to do so would require writing out an inconveniently long string of digits.</a></p>
</blockquote>
<ul>
<li>In scientific notation, nonzero numbers are written in the form</li>
</ul>
<p><span class="math display">\[a \times 10^b\]</span></p>
</section>
<section id="aside-explanation" class="level2">
<h2 class="anchored" data-anchor-id="aside-explanation">Aside: Explanation</h2>
<ul>
<li>In scientific notation, nonzero numbers are written in the form</li>
</ul>
<p><span class="math display">\[a \times 10^b\]</span></p>
<ul>
<li><span class="math inline">\(a\)</span> (the coefficient or mantissa) is a number greater than or equal to 1 and less than 10 (<span class="math inline">\(1 \le |a| &lt; 10\)</span>).</li>
<li><span class="math inline">\(10\)</span> is the base.</li>
<li><span class="math inline">\(b\)</span> (the exponent) is an integer.</li>
</ul>
</section>
<section id="aside-physical-examples" class="level2">
<h2 class="anchored" data-anchor-id="aside-physical-examples">Aside: Physical Examples</h2>
<ol type="1">
<li><p><strong>Speed of light:</strong> The speed of light in a vacuum is approximately <span class="math inline">\(300,000,000 \text{ m/s}\)</span> <span class="math display">\[
3 \times 10^8 \text{ m/s}
\]</span></p></li>
<li><p><strong>Mass of an electron:</strong> The mass of an electron is approximately <span class="math inline">\(0.00000000000000000000000000091093837 \text{ g}\)</span>. <span class="math display">\[
9.1093837 \times 10^{-28} \text{ g}
\]</span></p></li>
</ol>
</section>
<section id="aside-economic-examples" class="level2">
<h2 class="anchored" data-anchor-id="aside-economic-examples">Aside: Economic Examples</h2>
<ul>
<li>We can use social science numbers.</li>
<li><a href="https://www.newyorkfed.org/research/college-labor-market#--:explore:outcomes-by-major">Labor Market Outcomes of College Graduates by Major</a></li>
<li>Computer Science majors in 2023 have a $80,000 median wage ‚Äúearly career‚Äù
<ul>
<li><span class="math inline">\(8.0000 \times 10^4\)</span></li>
</ul></li>
<li>And 6.1% unemployment
<ul>
<li><span class="math inline">\(6.1 \times 10^{-2}\)</span></li>
</ul></li>
</ul>
</section>
<section id="ieee-layout" class="level2">
<h2 class="anchored" data-anchor-id="ieee-layout">IEEE Layout</h2>
<ul>
<li>An approximation using scientific notation
<ul>
<li><span class="math inline">\(x = -1^s \times 2^e \times 1.m\)</span></li>
<li><span class="math inline">\(x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}\)</span>
<ul>
<li>Where the mantissa is the technical term for the the digits after the decimal point.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="with-binary" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="with-binary">With Binary</h2>
<ul>
<li><span class="math inline">\(x = -0b1^{\text{0b0}} \times 0b10^{\text{0b10000000}}  \times 0b1.10010010000111111011011\)</span></li>
<li>Express in memory as the concatenation:
<ul>
<li><code>0b0</code> to <code>0b10000000</code> to <code>0b10010010000111111011011</code></li>
<li><code>01000000010010010000111111011011</code></li>
</ul></li>
</ul>
</section>
<section id="singles-and-doubles" class="level2">
<h2 class="anchored" data-anchor-id="singles-and-doubles">Singles and Doubles</h2>
<ul>
<li>32 - bits = 1 sign bit + 8 exponent bits + 23 mantissa bits
<ul>
<li><code>0b0</code> to <code>0b10000000</code> to <code>0b10010010000111111011011</code></li>
</ul></li>
<li>64 - bits = 1 sign bit + 12 exponent bits + 52 mantissa bits</li>
</ul>
</section>
<section id="understanding-check" class="level2">
<h2 class="anchored" data-anchor-id="understanding-check">Understanding check</h2>
<ul>
<li>What is the probability a <em>real number</em> <span class="math inline">\(a \in \mathbb{R}\)</span> has an exact float representation?</li>
<li>What is the probability an <em>integer</em> <span class="math inline">\(n \in \mathbb{Z}\)</span> has an exact float representation?</li>
<li>What is the probability a <em>course number</em> <span class="math inline">\(n &lt; 600\)</span> has an exact float representation?</li>
</ul>
</section>
<section id="special-floats---nan" class="level2">
<h2 class="anchored" data-anchor-id="special-floats---nan">Special Floats - NaN</h2>
<ul>
<li>Divide by Zero
<ul>
<li>1 / 0</li>
</ul></li>
<li>Not a Number (NaN)</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">1</span>)<span class="op">/</span>f32(<span class="dv">0</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: divide by zero encountered <span class="kw">in</span> scalar divide</span>
<span id="cb1-4"><a href="#cb1-4"></a>np.float32(inf)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span><span class="op">/</span><span class="dv">0</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>Traceback (most recent call last):</span>
<span id="cb1-7"><a href="#cb1-7"></a>  File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="pp">ZeroDivisionError</span>: division by zero</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="special-floats---inf" class="level2">
<h2 class="anchored" data-anchor-id="special-floats---inf">Special Floats - inf</h2>
<ul>
<li>Signed Infinity
<ul>
<li>Overflow protection</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: overflow encountered <span class="kw">in</span> scalar power</span>
<span id="cb2-3"><a href="#cb2-3"></a>np.float32(inf)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">10.0</span> <span class="op">**</span> <span class="dv">10000</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>Traceback (most recent call last):</span>
<span id="cb2-6"><a href="#cb2-6"></a>File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="pp">OverflowError</span>: (<span class="dv">34</span>, <span class="st">'Numerical result out of range'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="infinity-is-signed" class="level2">
<h2 class="anchored" data-anchor-id="infinity-is-signed">Infinity is signed</h2>
<ul>
<li>We can get negative infinity through a variety of means.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span>(f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a>np.float32(<span class="op">-</span>inf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We note that this suppresses the overflow error use <code>()</code></li>
<li>In some languages this is not ever regarded as an overflow error, like Julia (where we have to use larger powers due to the f64 default)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource jl number-lines code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1"></a>julia<span class="op">&gt;</span> <span class="fl">10.0</span><span class="op">^</span><span class="fl">10000</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="cn">Inf</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>julia<span class="op">&gt;</span> <span class="fu">-</span>(<span class="fl">10.0</span><span class="op">^</span><span class="fl">10000</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="op">-</span><span class="cn">Inf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="signed-zero" class="level2">
<h2 class="anchored" data-anchor-id="signed-zero">Signed Zero</h2>
<ul>
<li>Signed Zero
<ul>
<li>Underflow protection, preserves sign</li>
<li><ul>
<li>0 =‚àí 0</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">==</span> (<span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="va">True</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">-</span> <span class="fl">0.0</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="fl">0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>Works in base Python (e.g.&nbsp;don‚Äôt need NumPy).</li>
<li>Couldn‚Äôt get it to work in Julia actually (went to -inf or NaN)</li>
</ul>
</section>
<section id="simple-example" class="level2">
<h2 class="anchored" data-anchor-id="simple-example">Simple Example</h2>
<ul>
<li>Floating point is great because it will work exactly how you expect.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>More or less.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fl">0.30000000000000004</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-example-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-example-1">Simple Example</h2>
<ul>
<li>We shouldn‚Äôt be suprised by this!</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f32(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fl">0.100000001490116119384765625</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fl">0.20000000298023223876953125</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fl">0.300000011920928955078125</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f64(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="fl">0.1000000000000000055511151231257827021181583404541015625</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="fl">0.200000000000000011102230246251565404236316680908203125</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fl">0.299999999999999988897769753748434595763683319091796875</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="storage-of-1." class="level2">
<h2 class="anchored" data-anchor-id="storage-of-1.">Storage of 1.</h2>
<ul>
<li><span class="math inline">\(x = -1^s \times 2^e \times 1.m\)</span></li>
<li><span class="math inline">\(x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}\)</span></li>
<li><span class="math inline">\(x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1 + \text{mantissa} \times \frac{1}{2^n}\)</span></li>
<li><span class="math inline">\(1 = -1^0 \times 2^0 \times (1 + 0 \times \frac{1}{2^n}\)</span></li>
<li>So each of the sign bit, the base, and the mantissa are zero.
<ul>
<li>I should note I was unable to reproduce this in Rust or C.</li>
<li>I‚Äôm not really a floating pointer.</li>
</ul></li>
</ul>
</section>
<section id="except" class="level2">
<h2 class="anchored" data-anchor-id="except">Except‚Ä¶</h2>
<ul>
<li>This is actually a little bit fake.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">$</span> cat src<span class="op">/</span>main<span class="op">.</span>rs</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">1.0</span><span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> x<span class="op">.</span>to_bits())<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="op">}</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="op">$</span> cargo run</span>
<span id="cb9-7"><a href="#cb9-7"></a>    Finished `dev` profile [unoptimized <span class="op">+</span> debuginfo] target(s) <span class="kw">in</span> <span class="dv">0</span><span class="op">.</span>00s</span>
<span id="cb9-8"><a href="#cb9-8"></a>     Running `target<span class="op">/</span>debug<span class="op">/</span>bits`</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="dv">00111111100000000000000000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>What is that?</li>
</ul>
</section>
<section id="shift-127" class="level2">
<h2 class="anchored" data-anchor-id="shift-127">Shift 127</h2>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Internal_representation">While the exponent can be positive or negative, in binary formats it is stored as an unsigned number that has a fixed ‚Äúbias‚Äù added to it.</a></p>
</blockquote>
<ul>
<li>The IEEE 754 binary format specifies a hardware implementation of such that the exponent, be it positive or negative, in binary formats is stored as an unsigned number that has a fixed ‚Äúbias‚Äù added to it.</li>
<li>In the case of 32 bit floats, the bias is 127.</li>
</ul>
</section>
<section id="breakdown" class="level2">
<h2 class="anchored" data-anchor-id="breakdown">Breakdown</h2>
<ul>
<li>Take the following:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="ex">00111111100000000000000000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>That is:
<ul>
<li>Sign bit of <code>0</code></li>
<li>Exponent of <code>01111111</code>
<ul>
<li>All zeroes and all ones are reserved for <code>NaN</code>, <code>inf</code>, etc.</li>
</ul></li>
<li>Mantissa of 23 zeroes.</li>
</ul></li>
</ul>
</section>
<section id="how-precise" class="level2">
<h2 class="anchored" data-anchor-id="how-precise">How precise?</h2>
<ul>
<li>I have referred to <code>f32</code> as having ‚Äú32 bits of precision‚Äù.</li>
<li>How much precision is that?</li>
<li>Well, let‚Äôs set the least significant bit of the mantissa to one.</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">1.0</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="kw">let</span> <span class="kw">mut</span> b<span class="op">:</span><span class="dt">u32</span> <span class="op">=</span> x<span class="op">.</span>to_bits()<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    b <span class="op">|=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="pp">println!</span>(<span class="st">"{:1.32}"</span><span class="op">,</span> <span class="dt">f32</span><span class="pp">::</span>from_bits(b))<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="epsilon" class="level2">
<h2 class="anchored" data-anchor-id="epsilon">‚ÄúEpsilon‚Äù</h2>
<ul>
<li>What do we get?</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="ex">$</span> cargo run</span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.00s</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>     <span class="ex">Running</span> <span class="kw">`</span><span class="ex">target/debug/bits</span><span class="kw">`</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="ex">00111111100000000000000000000001</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="ex">1.00000011920928955078125000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We refer to this value (less one) as <a href="https://en.wikipedia.org/wiki/Machine_epsilon">machine epsilon</a>, or perhaps <span class="math inline">\(\varepsilon\)</span>.</li>
<li>The difference between 1.0 and the next available floating point number.</li>
<li>Much lower, of course, with double and quad precision.</li>
</ul>
</section>
<section id="easier-sig-figs" class="level2">
<h2 class="anchored" data-anchor-id="easier-sig-figs">Easier: ‚ÄúSig figs‚Äù</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Format</th>
<th style="text-align: center;">Sign</th>
<th style="text-align: center;">Exp.</th>
<th style="text-align: center;">Mant.</th>
<th style="text-align: center;">Bits</th>
<th style="text-align: center;">Bias</th>
<th style="text-align: center;">Prec.</th>
<th style="text-align: center;">Significance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Half</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;"><strong>3-4</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Single</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">127</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;"><strong>6-9</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Double</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">1023</td>
<td style="text-align: center;">53</td>
<td style="text-align: center;"><strong>15-17</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Quad</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">128</td>
<td style="text-align: center;">16383</td>
<td style="text-align: center;">113</td>
<td style="text-align: center;"><strong>33-36</strong></td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://people.eecs.berkeley.edu/~wkahan/ieee754status/IEEE754.PDF">Prof.&nbsp;Kahan, UCB EECS</a></li>
</ul>
</section>
<section id="sig-figs" class="level2">
<h2 class="anchored" data-anchor-id="sig-figs">Sig figs</h2>
<ul>
<li>IEEE 754 was intended for <em>scientific computing</em></li>
<li>That is, not systems computing, software etc.</li>
<li>Useful to us to think about information and how bits work.</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Significant_figures">Significant figures, also referred to as significant digits, are specific digits within a number that is written in positional notation that carry both reliability and necessity in conveying a particular quantity.</a></p>
</blockquote>
</section>
<section id="small-values" class="level2">
<h2 class="anchored" data-anchor-id="small-values">Small Values</h2>
<ul>
<li>For 32-bit floats, the minimum base 10 exponent is -36.</li>
<li>How is <span class="math inline">\(1.0 \times 10^{-37}\)</span> represented?</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">// In Rust, we may use '0b' prefix for binary representation.</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">// In Rust, we may us underscores within numerical values.</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="dv">0b0_00000000_11011001110001111101110</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="test-it" class="level2">
<h2 class="anchored" data-anchor-id="test-it">Test it</h2>
<ul>
<li>Write a simple test‚Ä¶</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="kw">let</span> b<span class="op">:</span><span class="dt">u32</span> <span class="op">=</span> <span class="dv">0b0_00000000_11011001110001111101110</span><span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="pp">println!</span>(<span class="st">"{:1.100}"</span><span class="op">,</span> <span class="dt">f32</span><span class="pp">::</span>from_bits(b))<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">10.0_f32</span><span class="op">.</span>powf(<span class="op">-</span><span class="dv">38.0_f32</span>)<span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> x<span class="op">.</span>to_bits())<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="pp">println!</span>(<span class="st">"{:1.100}"</span><span class="op">,</span> x)<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Results are as expected.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="denormalized-number" class="level2">
<h2 class="anchored" data-anchor-id="denormalized-number">‚ÄúDenormalized Number‚Äù</h2>
<ul>
<li>Numbers that have a zero exponent</li>
<li>Required when the exponent is below the minimum exponent</li>
<li>Helps prevent underflow</li>
<li>Generally speaking, if you are using one these, the math is about to get wronger than you‚Äôd think.</li>
<li>The good (???) language C++ provides a <code>std::nextafter</code> for which Rust crates exist.</li>
</ul>
</section>
<section id="floating-point-precision" class="level2">
<h2 class="anchored" data-anchor-id="floating-point-precision">Floating Point Precision</h2>
<ul>
<li>Representation is not uniform between numbers</li>
<li>Most precision lies between 0.0 and 0.1</li>
<li>Precision falls away</li>
</ul>
</section>
<section id="visually" class="level2">
<h2 class="anchored" data-anchor-id="visually">Visually</h2>
<p><img src="https://dwayneneed.github.io/static/img/2010-05-06-fun-with-floating-point_6bit-float-distribution.png" class="img-fluid"></p>
<ul>
<li><a href="https://dwayneneed.github.io/.net/2010/05/06/fun-with-floating-point.html">Fun with floating point, Dwayne Need</a></li>
</ul>
</section>
<section id="floating-point-precision-1" class="level2">
<h2 class="anchored" data-anchor-id="floating-point-precision-1">Floating Point Precision</h2>
<p>The number of floats from 0.0</p>
<ul>
<li>‚Ä¶ to 0.1 = 1,036,831,949</li>
<li>‚Ä¶ to 0.2 = 8,388,608</li>
<li>‚Ä¶ to 0.4 = 8,388,608</li>
<li>‚Ä¶ to 0.8 = 8,388,608</li>
<li>‚Ä¶ to 1.6 = 8,388,608</li>
<li>‚Ä¶ to 3.2 = 8,388,608</li>
</ul>
</section>
<section id="errors-in-floating-point" class="level2">
<h2 class="anchored" data-anchor-id="errors-in-floating-point">Errors in Floating Point</h2>
<ul>
<li>Storage of <span class="math inline">\(\pi\)</span></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> pi <span class="im">as</span> pi</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># copy paste Wolfram|Alpha</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="op">&gt;&gt;&gt;</span> <span class="ss">f'</span><span class="sc">{</span>pi<span class="sc">:1.100}</span><span class="ss">'</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">'3.141592653589793115997963468544185161590576171875'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>They differ fairly early on!</li>
</ul>
</section>
<section id="measuring-error-ulps" class="level2">
<h2 class="anchored" data-anchor-id="measuring-error-ulps">Measuring Error: ‚ÄúUlps‚Äù</h2>
<ul>
<li>Units in Last Place</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Unit_in_the_last_place">In computer science and numerical analysis, unit in the last place or unit of least precision (ulp) is the spacing between two consecutive floating-point numbers, i.e., the value the least significant digit (rightmost digit) represents if it is 1. It is used as a measure of accuracy in numeric calculations.</a></p>
</blockquote>
</section>
<section id="generators" class="level2">
<h2 class="anchored" data-anchor-id="generators">Generators</h2>
<ul>
<li>By convention we check number theoretic results with lazily evaluated generator expressions in Python.</li>
<li>The following generators all powers of two for a which adding one does not change the value within Python floating points.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">from</span> itertools <span class="im">import</span> count</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>gen <span class="op">=</span> (i <span class="cf">for</span> i <span class="kw">in</span> count() <span class="cf">if</span> <span class="fl">2.0</span> <span class="op">**</span> <span class="bu">float</span>(i) <span class="op">+</span> <span class="fl">1.0</span> <span class="op">==</span> <span class="fl">2.0</span> <span class="op">**</span> <span class="bu">float</span>(i))</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a>x <span class="op">=</span> <span class="bu">next</span>(gen)</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="bu">print</span>(<span class="st">'2.0 ** x + 0.0 = '</span>, <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">0.0</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="bu">print</span>(<span class="st">'2.0 ** x + 1.0 = '</span>, <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="iterators" class="level2">
<h2 class="anchored" data-anchor-id="iterators">Iterators</h2>
<ul>
<li>Rust doesn‚Äôt require iterators, supporting the infinite iterator by default using <code>unwrap</code>.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">let</span> x <span class="op">=</span> (<span class="dv">0</span><span class="op">..</span>)<span class="op">.</span>find(<span class="op">|&amp;</span>i<span class="op">|</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> i) <span class="op">+</span> <span class="dv">1.0</span> <span class="op">==</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> i))<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw">let</span> base <span class="op">=</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> x)<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">// Prints the result (2^53 = 9007199254740992.0)</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="pp">println!</span>(<span class="st">"2.0 ** x + 0.0 = {:.1}"</span><span class="op">,</span> base)<span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="pp">println!</span>(<span class="st">"2.0 ** x + 1.0 = {:.1}"</span><span class="op">,</span> base <span class="op">+</span> <span class="dv">1.0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I haven‚Äôt used <code>find</code> before, this is an LLM donation to our knowledge base.</li>
<li>By the way, that is basically <code>2 ** 53</code> and there are 52 bits of mantissa precision.</li>
</ul>
</section>
<section id="on-ulps" class="level2">
<h2 class="anchored" data-anchor-id="on-ulps">On ‚ÄúUlps‚Äù</h2>
<ul>
<li>We can measure error using ULPs.</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://www.cs.berkeley.edu/~wkahan/LOG10HAF.TXT">The gap between the two floating-point numbers nearest to x, even if x is one of )them.</a></p>
</blockquote>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32, pi <span class="im">as</span> pi, float64 <span class="im">as</span> f64</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="op">&gt;&gt;&gt;</span> f64(pi) <span class="op">-</span> f64(f32(pi))</span>
<span id="cb19-3"><a href="#cb19-3"></a>np.float64(<span class="op">-</span><span class="fl">8.742278012618954e-08</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="rounding" class="level2">
<h2 class="anchored" data-anchor-id="rounding">Rounding</h2>
<ul>
<li>We have some guarantees:
<ul>
<li>IEEE 754 requires that that elementary arithmetic operations are correctly rounded to within 0.5 ulps</li>
<li>Transcendental functions are generally rounded to between 0.5 and 1.0 ulps
<ul>
<li>Transcendental as in <span class="math inline">\(\pi\)</span> or <span class="math inline">\(e\)</span></li>
</ul></li>
</ul></li>
<li>~9 ulps</li>
</ul>
</section>
<section id="relative-error" class="level1">
<h1>Relative Error</h1>
<ul>
<li>The difference between the ‚Äúreal‚Äù number and the approximated number, divided by the ‚Äúreal‚Äù number.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">&gt;&gt;&gt;</span> f64(f32(pi))<span class="op">/</span>f64(pi)</span>
<span id="cb20-2"><a href="#cb20-2"></a>np.float64(<span class="fl">1.0000000278275352</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>So for <code>pi</code> in <code>f32</code>, around <span class="math inline">\(2.9 \times 10^{-8}\)</span></li>
</ul>
<section id="rounding-error" class="level2">
<h2 class="anchored" data-anchor-id="rounding-error">Rounding Error</h2>
<ul>
<li>Induced by approximating an infinite range of numbers into a finite number of bits</li>
<li>Rounding is:
<ul>
<li>Towards the nearest</li>
<li>Towards zero</li>
<li>Towards positive infinity (round up)</li>
<li>Towards negative infinity (round down)</li>
</ul></li>
</ul>
</section>
<section id="rounding-error-1" class="level2">
<h2 class="anchored" data-anchor-id="rounding-error-1">Rounding Error</h2>
<ul>
<li>What about rounding the half-way case? (i.e.&nbsp;0.5)
<ul>
<li>Round Up vs.&nbsp;Round Even</li>
</ul></li>
<li>Correct Rounding:
<ul>
<li>Basic operations (add, subtract, multiply, divide, sqrt) should return the number nearest the mathematical result.</li>
<li>If there is a tie, round to the number with an even mantissa</li>
</ul></li>
</ul>
</section>
<section id="implementation" class="level2">
<h2 class="anchored" data-anchor-id="implementation">Implementation</h2>
<ul>
<li>‚ÄúGuard Bit‚Äù, ‚ÄúRound Bit‚Äù, ‚ÄúSticky Bit‚Äù</li>
<li>Only used while doing calculations
<ul>
<li>Not stored in the float itself</li>
<li>The mantissa is shifted in calculations to align radix</li>
</ul></li>
<li>The guard bits and round bits are extra precision</li>
<li>The sticky bit is an OR of anything that shifts through it</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb21-1"><a href="#cb21-1"></a>0_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="special-bits" class="level2">
<h2 class="anchored" data-anchor-id="special-bits">Special bits</h2>
<ul>
<li>‚ÄúGuard Bit‚Äù, ‚ÄúRound Bit‚Äù, ‚ÄúSticky Bit‚Äù</li>
<li><strong>[G][R][S]</strong></li>
<li><strong>[0][-][-]</strong> - Round Down (do nothing)</li>
<li><strong>[1][0][0]</strong> - Round Up if the mantissa LSB is 1</li>
<li><strong>[1][0][1]</strong> - Round Up</li>
<li><strong>[1][1][0]</strong> - Round Up</li>
<li><strong>[1][1][1]</strong> - Round Up</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1"></a>0_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="significance-error" class="level2">
<h2 class="anchored" data-anchor-id="significance-error">Significance Error</h2>
<ul>
<li>Compute the Area of a Triangle
<ul>
<li>Heron‚Äôs Formula:
<ul>
<li>ùê¥ = ùë•+ùë¶ 2 +ùëç ùë•+ùë¶ 2 +ùëç ‚àíùë• ùë•+ùë¶ 2 +ùëç ‚àíùë¶ ùë•+ùë¶ 2 +ùëç ‚àíùëß</li>
</ul></li>
<li>Kahan‚ÄôsAlgorithm:
<ul>
<li>Sort x, y, z such that ùë•‚â•ùë¶ ‚â•ùëß</li>
<li>If ùëß&lt; ùë•‚àíùë¶, then no such triangle exists.</li>
<li>Else ùê¥ = (ùë•+ùë¶+ùëß) √ó ùëß‚àí(ùë•‚àíùë¶ )√ó 4 (ùëß+ùë•‚àíùë¶ )√ó(ùë•+ùë¶‚àíùëß)</li>
</ul></li>
</ul></li>
</ul>
<p>Significance Error</p>
<pre><code>/// Area of a triangle
/// From http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html
/// From https://www.cs.berkeley.edu/~wkahan/Triangle.pdf
TEST(CPPCon2015, AreaOfATriangleFloat)
{
const auto a = 100000.0f;
const auto b = 99999.99979f;
const auto c = 0.00029f;</code></pre>
<pre><code>ASSERT_TRUE(a &gt;= b);
ASSERT_TRUE(b &gt;= c);</code></pre>
<pre><code>auto heronsFormula = HeronsFormula(a, b, c);
auto kahansFormula = KahansFormula(a, b, c);
EXPECT_NE(kahansFormula, heronsFormula);
cppCon() &lt;&lt; "Kahan: " &lt;&lt; kahansFormula;
cppCon() &lt;&lt; "Heron: " &lt;&lt; heronsFormula;
cppCon() &lt;&lt; "delta: " &lt;&lt; kahansFormula - heronsFormula &lt;&lt; "\n";
}</code></pre>
<p>Significance Error</p>
<p>Heron: 0.000000000000000000000000000000</p>
<p>Kahan: 14.500000000000000000000000000000</p>
<p>delta: 14.500000000000000000000000000000</p>
<p>Significance Error</p>
<p>Heron: 0.000000000000000000000000000000</p>
<p>Kahan: 14.500000000000000000000000000000</p>
<p>delta: 14.500000000000000000000000000000</p>
<p>Hint: The Answer is 10.0</p>
<p>Significance Error</p>
<p>Heron: 0.000000000000000000000000000000</p>
<p>Kahan: 14.500000000000000000000000000000</p>
<p>delta: 14.500000000000000000000000000000</p>
<p>Heron: 9.999999809638328700000000000000</p>
<p>Kahan: 10.000000077021038000000000000000</p>
<p>delta: 0.000000267382709751018410000000</p>
<p>Significance Error - Use Stable Algorithms</p>
<ul>
<li>Loss of Significance
<ul>
<li>Keep big numbers with big numbers, little numbers with little numbers.</li>
</ul></li>
<li>Parentheses can help</li>
<li>Analysis of Algorithms is Critical</li>
<li>The compiler won‚Äôt re-arrange your math if it cannot prove it would yield the same</li>
</ul>
<p>result, even if the computation would be faster</p>
<ul>
<li>ùë• = ùëè‚àí ùëé+ùëè ‚àíùëé should not be replaced with ùë•= 0</li>
<li>See the ‚ÄúKahan‚ÄôsAlgorithm‚Äù example</li>
</ul>
<p>Significance Error ‚Äì Simulation Time</p>
<ul>
<li>Time is used to compute distance, velocity, acceleration
<ul>
<li>High frequency phenomena</li>
<li>Sensors: Doppler shift, pulse compression, PRF</li>
</ul></li>
<li>These computed values feed into other computed values which may or may not</li>
</ul>
<p>require a time component</p>
<ul>
<li>Thousands of computations per frame of simulation
<ul>
<li>Thousands of little compounding errors per frame</li>
</ul></li>
<li>Combine with poor or nonexistent testing</li>
</ul>
<p>Significance Error ‚Äì Simulation Time</p>
<ul>
<li>Accumulate Time (works for arbitrary</li>
</ul>
<p>time steps)</p>
<p>auto totalFrames = size_t(0); auto frameLength = 0.01f; auto simTime = 0.0f;</p>
<p>// Run 120 Frames auto simTime120Frames = 1.20f; for(; totalFrames &lt; 120; totalFrames++) { simTime += frameLength; }</p>
<pre><code>auto totalFrames = size_t(0);
auto frameLength = 0.01f;
auto simTime = 0.0f;</code></pre>
<pre><code>// Run 120 Frames
auto simTime120Frames = 1.20f;
totalFrames = 120;
simTime = totalFrames * frameLength;</code></pre>
<ul>
<li>Delta Time (works for fixed time steps)</li>
</ul>
<p>Significance Error ‚Äì Simulation Time</p>
<p>Accumulate Time (works for arbitrary time steps)</p>
<ul>
<li>1.199999999999999955591079014994 != <strong>1.199999213218688964843750000000</strong> (0.000000786781310990747329014994)</li>
<li>12.000000000000000000000000000000 != <strong>12.000179290771484375000000000000</strong> (- 0.000179290771484375000000000000)</li>
<li>120.000000000000000000000000000000 != <strong>120.007225036621093750000000000000</strong> (- 0.007225036621093750000000000000)</li>
<li>600.000000000000000000000000000000 != <strong>600.274414062500000000000000000000</strong> (- 0.274414062500000000000000000000)</li>
<li>3600.000000000000000000000000000000 != <strong>3603.204101562500000000000000000000</strong> (- 3.204101562500000000000000000000)</li>
</ul>
<p>Delta Time (works for fixed time steps)</p>
<ul>
<li>1.200000047683715820312500000000 != <strong>1.199999928474426269531250000000</strong> (0.000000119209289550781250000000)</li>
<li>12.000000000000000000000000000000 == <strong>12.000000000000000000000000000000</strong> (0.000000000000000000000000000000)</li>
<li>120.000000000000000000000000000000 == <strong>120.000000000000000000000000000000</strong> (0.000000000000000000000000000000)</li>
<li>600.000000000000000000000000000000 == <strong>600.000000000000000000000000000000</strong> (0.000000000000000000000000000000)</li>
<li>-3600.000000000000000000000000000000 == <strong>3600.000000000000000000000000000000</strong> (0.000000000000000000000000000000)</li>
</ul>
<p>Significance Error ‚Äì Simulation Time</p>
<ul>
<li>‚ÄúSub-Microsecond Precision‚Äù
<ul>
<li>1.2345e-6 seconds per frame (810044.5 Hz)</li>
</ul></li>
</ul>
<p>Significance Error ‚Äì Simulation Time</p>
<ul>
<li>‚ÄúSub-Microsecond Precision‚Äù
<ul>
<li>1.2345e-6 seconds per frame (810044.5 Hz)</li>
</ul></li>
</ul>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">0.012345000170171261000000000000 !=</h3>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1">0.0148140005767345430</h3>
</section>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2">(-0.002469000406563282000000000000)</h3>
</section>
<section id="section-3" class="level3">
<h3 class="anchored" data-anchor-id="section-3">12.345000267028809000000000000000 !=</h3>
</section>
<section id="section-4" class="level3">
<h3 class="anchored" data-anchor-id="section-4">11.701118469238281000000000000000</h3>
</section>
<section id="section-5" class="level3">
<h3 class="anchored" data-anchor-id="section-5">(0.643881797790527340000000000000)</h3>
<p>Significance Error ‚Äì Don‚Äôt use IEEE Floats?</p>
<ul>
<li>Use integers
<ul>
<li>Very fast</li>
<li>Trade more precision for less range</li>
<li>Only input/output may be impacted by floating point conversions</li>
<li>Financial applications represent dollars as only cents or tenth‚Äôs of cents</li>
</ul></li>
<li>Use a math library
<ul>
<li>Slower</li>
<li>Define your own level of accuracy</li>
<li>MPFR (w/C++ Wrapper), TTMath, Boost, GMP C++</li>
<li>CRlibm(Correctly Rounded Mathematical Library)</li>
</ul></li>
</ul>
<p>(Store simTimeas uint64_tand get microsecond precision for 584555 years.)</p>
<p>Algebraic Assumption Error</p>
<ul>
<li>Mathematical Identities
<ul>
<li>Traditional identities (associative, commutative, distributive) do not hold</li>
</ul></li>
<li>Distributive Rule does not apply: ùë• √óùë¶ ‚àíùë• √ó ùëß ‚â† ùë• (ùë¶ ‚àíùëß)</li>
<li>Associative Rule does not apply: ùë• + ùë¶ +ùëß ‚â† ùë• +ùë¶ +ùëß</li>
<li>Cannot interchange division and multiplication:</li>
</ul>
</section>
<section id="ùë•" class="level3">
<h3 class="anchored" data-anchor-id="ùë•">ùë•</h3>
</section>
<section id="section-6" class="level3">
<h3 class="anchored" data-anchor-id="section-6">10. 0</h3>
<p>‚â† ùë• √ó 0. 1</p>
<p>Does a na√Øve compiler make these assumptions too?</p>
<p>https://msdn.microsoft.com/library/aa289157.aspx</p>
<p>Algebraic Assumption Error</p>
<pre><code>const auto oneRadian = 0.15915494309f;
const auto control = 0.000000000015915494309f;</code></pre>
<pre><code>const auto oneRadianMultiplied = oneRadian * 1.0e-10f;
const auto oneRadianDivided = oneRadian / 1.0e10f;</code></pre>
<p>Algebraic Assumption Error</p>
<pre><code>const auto oneRadian = 0.15915494309f;
const auto control = 0.000000000015915494309f;</code></pre>
<pre><code>const auto oneRadianMultiplied = oneRadian * 1.0e-10f;
const auto oneRadianDivided = oneRadian / 1.0e10f;</code></pre>
<p>Control: 0.000000000015915494616658421000 x*1.0e-10f: 0.000000000015915494616658421000(0.000000000000000000000000000000) x/1.0e10f: 0.00000000001591549 2881934945000 (0.000000000000000001734723475977) Relative Error: 0.000000108995891423546710000000</p>
<p>Floating Point Exceptions</p>
<ul>
<li>Enable floating point exceptions to be alerted when things go awry.</li>
</ul>
<pre><code>ùë•is the exact result of the operation
Œ±= 192 for single precision, 1536 for double
ùë•ùëöùëéùë•= 1. 111 ... 111 √ó 2 ùëíùëöùëñùëõ.
See &lt;cfenv&gt; -Floating Point Environment</code></pre>
<p>IEEE 754 Exception Result when traps disabled Argument to trap handler</p>
<p>overflow ¬±‚àû or ¬±ùë•ùëöùëéùë• round(ùë• 2 ‚àíùõº)</p>
<p>underflow 0, 2 ùëíùëöùëñùëõor denormalized round(ùë• 2 ùõº)</p>
<p>divide by zero ¬±‚àû invalid operation</p>
<p>invalid NaN invalid operation</p>
<p>inexact round( <em>x</em> ) round( <em>x</em> )</p>
<p>But Wait! There‚Äôs More!</p>
<ul>
<li>Binary to Decimal Conversion Error</li>
<li>Summation Error</li>
<li>Propagation Error</li>
<li>Underflow, Overflow</li>
<li>Type Narrowing/Widening Rules</li>
</ul>
<p>Miscellaneous Notes</p>
<p><a href="http://preshing.com/images/float-point-perf.png">http://preshing.com/images/float-point-perf.png</a> https://github.com/DigitalInBlue/CPPCon2015</p>
<p>Use Your Compiler‚Äôs Output</p>
<ul>
<li>warning C4244: ‚Äòinitializing‚Äô : conversion from ‚Äòdouble‚Äô to</li>
</ul>
<p>‚Äòfloat‚Äô, possible loss of data</p>
<ul>
<li>warning C4056: overflow in floating point constant arithmetic</li>
<li>warning C4305: ‚Äòidentifier‚Äô : truncation from ‚Äòtype1‚Äô to</li>
</ul>
<p>‚Äòtype2‚Äô</p>
<ul>
<li>warning: conversion to ‚Äòfloat‚Äô from ‚Äòint‚Äô may alter its value</li>
<li>warning: floating constant exceeds range of ‚Äòdouble‚Äô</li>
</ul>
<p>Fused Multiply-Add (FMA)</p>
<ul>
<li>a = a + (b * c); a += b * c;</li>
<li>Multiplier-accumulator (MAC Unit)</li>
<li>One rounding</li>
<li>Compiler Options
<ul>
<li>GCC = -mfma</li>
<li>VC++ = #pragma fp_contract (off)</li>
</ul></li>
<li>Reference: FMA3, FMA4
<ul>
<li><a href="http://en.wikipedia.org/wiki/FMA_instruction_set">http://en.wikipedia.org/wiki/FMA_instruction_set</a></li>
</ul></li>
</ul>
<p>Streaming SIMD Extensions (SSE)</p>
<ul>
<li>SSE can provide significant performance gains
<ul>
<li>Supports integer, floating point, logical, conversion, shift, and shuffle operations</li>
</ul></li>
<li>C, C++, Fortran do not natively support SSE, but compiler-specific support exists</li>
</ul>
<p>Float Tricks</p>
<pre><code>/// Fast reciprocal square root approximation for x &gt; 0.25
/// Quake‚Äôs float Q_rsqrt(float number) is much more entertaining.
inline float FastInvSqrt(float x)
{
int tmp = ((0x3f800000 &lt;&lt; 1) + 0x3f800000 - *(long*)&amp;x) &gt;&gt; 1;
auto y = *(float*)&amp;tmp;
return y * (1.47f ‚Äì 0.47f * x * y * y);
}</code></pre>
<p>Testing</p>
<ul>
<li>Design for Numerical Stability</li>
<li>Perform Meaningful Testing</li>
<li>Document assumptions</li>
<li>Track sources of approximation</li>
<li>Quantify goodness
<ul>
<li>Well conditioned algorithms</li>
</ul></li>
<li>Backward error analysis
<ul>
<li>Are the outputs identical for slightly modified inputs?</li>
</ul></li>
</ul>
<pre><code>TEST(CPPCon2015, pointOnePlusPointTwo)
{
auto zeroPointOne = 0.1f;
auto zeroPointTwo = 0.2f;
auto zeroPointThree = 0.3f;
auto sum = zeroPointOne + zeroPointTwo;</code></pre>
<pre><code>EXPECT_DOUBLE_EQ(0.3f, zeroPointThree);
EXPECT_EQ(0.3f, zeroPointThree);
EXPECT_EQ(0.3f, sum);</code></pre>
<pre><code>EXPECT_EQ(zeroPointThree, sum);
EXPECT_DOUBLE_EQ(zeroPointThree, sum);
}</code></pre>
<p><a href="http://xkcd.com/217/">http://xkcd.com/217/</a> <a href="http://www.explainxkcd.com/wiki/index.php/217:_e_to_the_pi_Minus_pi">http://www.explainxkcd.com/wiki/index.php/217:_e_to_the_pi_Minus_pi</a></p>
<pre><code>https://github.com/DigitalInBlue/CPPCon2015</code></pre>
</section>
</section>
</section>
<section id="demystifying-floating-point" class="level1">
<h1>Demystifying Floating Point</h1>
<p>John Farrier, Booz Allen Hamilton</p>
<pre><code>https://github.com/DigitalInBlue/CPPCon2015</code></pre>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Grammatically, this statement should be ‚Äúso I have nothing about which to worry.‚Äù<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>This is true in the special case that your programming language is Haskell.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>This is due to how many numbers there are.<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./42_sha512.html" class="pagination-link" aria-label="SHA-512">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">SHA-512</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="an">title:</span><span class="co"> "IEEE 754"</span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co">---</span></span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="fu">## Announcements</span></span>
<span id="cb39-6"><a href="#cb39-6"></a></span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="ss">- </span>**Welcome** to Systems in Rust</span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="ss">- </span>**Action Items**:</span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="ss">  - </span>"SHA-512" is due on next Friday</span>
<span id="cb39-10"><a href="#cb39-10"></a><span class="ss">  - </span>Lecture on numbers, inspired by the lab, while we wait.</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="fu">## Today</span></span>
<span id="cb39-13"><a href="#cb39-13"></a></span>
<span id="cb39-14"><a href="#cb39-14"></a><span class="ss">- </span>Understand the basics of floats</span>
<span id="cb39-15"><a href="#cb39-15"></a><span class="ss">- </span>Understand the language of floats</span>
<span id="cb39-16"><a href="#cb39-16"></a><span class="ss">- </span>Get a feel for when further investigation is required</span>
<span id="cb39-17"><a href="#cb39-17"></a><span class="ss">- </span>Have a few tools ready to help</span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="ss">- </span>Be prepared to keep learning about IEEE floats</span>
<span id="cb39-19"><a href="#cb39-19"></a></span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="fu">## Citation</span></span>
<span id="cb39-21"><a href="#cb39-21"></a></span>
<span id="cb39-22"><a href="#cb39-22"></a><span class="ss">- </span>Yoinked</span>
<span id="cb39-23"><a href="#cb39-23"></a><span class="ss">- </span><span class="co">[</span><span class="ot">url</span><span class="co">](https://github.com/DigitalInBlue/CPPCon2015)</span></span>
<span id="cb39-24"><a href="#cb39-24"></a><span class="ss">- </span>Author John Farrier, Booz Allen Hamilton</span>
<span id="cb39-25"><a href="#cb39-25"></a></span>
<span id="cb39-26"><a href="#cb39-26"></a><span class="fu">## Mission Statement</span></span>
<span id="cb39-27"><a href="#cb39-27"></a></span>
<span id="cb39-28"><a href="#cb39-28"></a><span class="ss">- </span>I'm a normal person.</span>
<span id="cb39-29"><a href="#cb39-29"></a><span class="ss">    -   </span>I think <span class="in">`5/2`</span> is <span class="in">`2.5`</span> or perhaps 2¬Ω.</span>
<span id="cb39-30"><a href="#cb39-30"></a><span class="ss">- </span>I'm a scientist.</span>
<span id="cb39-31"><a href="#cb39-31"></a><span class="ss">    - </span>I'm solving "Black-Scholes"</span>
<span id="cb39-32"><a href="#cb39-32"></a><span class="ss">    - </span><span class="co">[</span><span class="ot">Does anyone know what this is doing?</span><span class="co">](https://numba.pydata.org/numba-examples/examples/finance/blackscholes/results.html)</span></span>
<span id="cb39-33"><a href="#cb39-33"></a>$$</span>
<span id="cb39-34"><a href="#cb39-34"></a>d_2 = d_1 - \sigma\sqrt{T - t} = \frac{1}{\sigma\sqrt{T - t}}\left<span class="co">[</span><span class="ot">\ln\left(\frac{S_t}{K}\right) + \left(r - q - \frac{1}{2}\sigma^2\right)(T - t)\right</span><span class="co">]</span></span>
<span id="cb39-35"><a href="#cb39-35"></a>$$</span>
<span id="cb39-36"><a href="#cb39-36"></a></span>
<span id="cb39-37"><a href="#cb39-37"></a><span class="fu">## Common Fallacies</span></span>
<span id="cb39-38"><a href="#cb39-38"></a></span>
<span id="cb39-39"><a href="#cb39-39"></a><span class="ss">- </span>"Floating point numbers are numbers"</span>
<span id="cb39-40"><a href="#cb39-40"></a><span class="ss">    - </span><span class="in">`max(count())`</span> Pinocchios</span>
<span id="cb39-41"><a href="#cb39-41"></a><span class="ss">- </span>"It‚Äôs floating point error"</span>
<span id="cb39-42"><a href="#cb39-42"></a><span class="ss">    - </span>"All floating point involves magical rounding errors"</span>
<span id="cb39-43"><a href="#cb39-43"></a><span class="ss">- </span>"Linux and Windows handle floats differently"</span>
<span id="cb39-44"><a href="#cb39-44"></a><span class="ss">- </span>"Floating point represents an interval value near the actual value"</span>
<span id="cb39-45"><a href="#cb39-45"></a></span>
<span id="cb39-46"><a href="#cb39-46"></a><span class="fu">## Common Fallacies 2.0</span></span>
<span id="cb39-47"><a href="#cb39-47"></a></span>
<span id="cb39-48"><a href="#cb39-48"></a><span class="ss">- </span>"A double (an <span class="in">`f64`</span>) holds 15 decimal places and I only need 3, so I have nothing to worry about"<span class="ot">[^1]</span></span>
<span id="cb39-49"><a href="#cb39-49"></a><span class="ss">- </span>"My programming language does better math than your programming language"<span class="ot">[^2]</span></span>
<span id="cb39-50"><a href="#cb39-50"></a><span class="ss">- </span>"Why can't computers just store whatever number I use"<span class="ot">[^3]</span></span>
<span id="cb39-51"><a href="#cb39-51"></a></span>
<span id="cb39-52"><a href="#cb39-52"></a><span class="ot">[^1]: </span>Grammatically, this statement should be "so I have nothing about which to worry."</span>
<span id="cb39-53"><a href="#cb39-53"></a><span class="ot">[^2]: </span>This is true in the special case that your programming language is Haskell.</span>
<span id="cb39-54"><a href="#cb39-54"></a><span class="ot">[^3]: </span>This is due to how many numbers there are.</span>
<span id="cb39-55"><a href="#cb39-55"></a></span>
<span id="cb39-56"><a href="#cb39-56"></a><span class="fu">## Anatomy of IEEE Floats</span></span>
<span id="cb39-57"><a href="#cb39-57"></a></span>
<span id="cb39-58"><a href="#cb39-58"></a><span class="al">![](https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/IEEE754.svg/550px-IEEE754.svg.png)</span></span>
<span id="cb39-59"><a href="#cb39-59"></a></span>
<span id="cb39-60"><a href="#cb39-60"></a><span class="fu">## IEEE Float Specification</span></span>
<span id="cb39-61"><a href="#cb39-61"></a></span>
<span id="cb39-62"><a href="#cb39-62"></a><span class="ss">- </span>IEEE 754-1985, IEEE 854-1987, IEEE 754-2008</span>
<span id="cb39-63"><a href="#cb39-63"></a><span class="ss">    - </span>These are paywalled.</span>
<span id="cb39-64"><a href="#cb39-64"></a><span class="ss">    - </span>Those are years.</span>
<span id="cb39-65"><a href="#cb39-65"></a><span class="ss">- </span>Provide for portable, provably consistent math</span>
<span id="cb39-66"><a href="#cb39-66"></a><span class="ss">    - </span>Consistent, not correct.</span>
<span id="cb39-67"><a href="#cb39-67"></a></span>
<span id="cb39-68"><a href="#cb39-68"></a><span class="fu">## Assurances</span></span>
<span id="cb39-69"><a href="#cb39-69"></a></span>
<span id="cb39-70"><a href="#cb39-70"></a><span class="ss">- </span>Ensure some significant mathematical identities hold true:</span>
<span id="cb39-71"><a href="#cb39-71"></a><span class="ss">    - </span>$x + y  = y + x$</span>
<span id="cb39-72"><a href="#cb39-72"></a><span class="ss">        - </span>Symmetry of addition</span>
<span id="cb39-73"><a href="#cb39-73"></a><span class="ss">    - </span>$x + 0 = x$</span>
<span id="cb39-74"><a href="#cb39-74"></a><span class="ss">        - </span>Additive identity</span>
<span id="cb39-75"><a href="#cb39-75"></a><span class="ss">    - </span>$x = y \implies x - y = 0$</span>
<span id="cb39-76"><a href="#cb39-76"></a><span class="ss">        - </span>Identity under subtraction</span>
<span id="cb39-77"><a href="#cb39-77"></a>        </span>
<span id="cb39-78"><a href="#cb39-78"></a><span class="fu">## Assurances 2.0</span></span>
<span id="cb39-79"><a href="#cb39-79"></a></span>
<span id="cb39-80"><a href="#cb39-80"></a>$$</span>
<span id="cb39-81"><a href="#cb39-81"></a>\frac{x}{\sqrt{x^2+y^2}} \leq 1</span>
<span id="cb39-82"><a href="#cb39-82"></a>$$</span>
<span id="cb39-83"><a href="#cb39-83"></a></span>
<span id="cb39-84"><a href="#cb39-84"></a><span class="ss">- </span>What is missing?</span>
<span id="cb39-85"><a href="#cb39-85"></a></span>
<span id="cb39-86"><a href="#cb39-86"></a><span class="fu">## IEEE Float Specification</span></span>
<span id="cb39-87"><a href="#cb39-87"></a></span>
<span id="cb39-88"><a href="#cb39-88"></a><span class="ss">- </span>Ensure every floating point number is unique</span>
<span id="cb39-89"><a href="#cb39-89"></a><span class="ss">- </span>Ensure every floating point number has an opposite</span>
<span id="cb39-90"><a href="#cb39-90"></a><span class="ss">    - </span>_Zero_ is a special case because of this</span>
<span id="cb39-91"><a href="#cb39-91"></a><span class="ss">- </span>Specifies algorithms for addition, subtraction, multiplication, division, and square-root</span>
<span id="cb39-92"><a href="#cb39-92"></a><span class="ss">    - </span>Not really operations/relations! They are algorithms.</span>
<span id="cb39-93"><a href="#cb39-93"></a>    </span>
<span id="cb39-94"><a href="#cb39-94"></a>    </span>
<span id="cb39-95"><a href="#cb39-95"></a><span class="fu">## Aside: Scientific Notation</span></span>
<span id="cb39-96"><a href="#cb39-96"></a></span>
<span id="cb39-97"><a href="#cb39-97"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">Scientific notation is a way of expressing numbers that are too large or too small to be conveniently written in decimal form, since to do so would require writing out an inconveniently long string of digits.</span><span class="co">](https://en.wikipedia.org/wiki/Scientific_notation)</span></span>
<span id="cb39-98"><a href="#cb39-98"></a></span>
<span id="cb39-99"><a href="#cb39-99"></a><span class="ss">- </span>In scientific notation, nonzero numbers are written in the form </span>
<span id="cb39-100"><a href="#cb39-100"></a></span>
<span id="cb39-101"><a href="#cb39-101"></a>$$a \times 10^b$$</span>
<span id="cb39-102"><a href="#cb39-102"></a></span>
<span id="cb39-103"><a href="#cb39-103"></a><span class="fu">## Aside: Explanation</span></span>
<span id="cb39-104"><a href="#cb39-104"></a></span>
<span id="cb39-105"><a href="#cb39-105"></a></span>
<span id="cb39-106"><a href="#cb39-106"></a><span class="ss">- </span>In scientific notation, nonzero numbers are written in the form </span>
<span id="cb39-107"><a href="#cb39-107"></a></span>
<span id="cb39-108"><a href="#cb39-108"></a>$$a \times 10^b$$</span>
<span id="cb39-109"><a href="#cb39-109"></a></span>
<span id="cb39-110"><a href="#cb39-110"></a></span>
<span id="cb39-111"><a href="#cb39-111"></a><span class="ss">* </span>$a$ (the coefficient or mantissa) is a number greater than or equal to 1 and less than 10 ($1 \le |a| &lt; 10$).</span>
<span id="cb39-112"><a href="#cb39-112"></a><span class="ss">* </span>$10$ is the base.</span>
<span id="cb39-113"><a href="#cb39-113"></a><span class="ss">* </span>$b$ (the exponent) is an integer.</span>
<span id="cb39-114"><a href="#cb39-114"></a></span>
<span id="cb39-115"><a href="#cb39-115"></a></span>
<span id="cb39-116"><a href="#cb39-116"></a><span class="fu">## Aside: Physical Examples</span></span>
<span id="cb39-117"><a href="#cb39-117"></a></span>
<span id="cb39-118"><a href="#cb39-118"></a><span class="ss">1.  </span>**Speed of light:** The speed of light in a vacuum is approximately $300,000,000 \text{ m/s}$</span>
<span id="cb39-119"><a href="#cb39-119"></a>$$</span>
<span id="cb39-120"><a href="#cb39-120"></a>3 \times 10^8 \text{ m/s}</span>
<span id="cb39-121"><a href="#cb39-121"></a>$$</span>
<span id="cb39-122"><a href="#cb39-122"></a></span>
<span id="cb39-123"><a href="#cb39-123"></a><span class="ss">2.  </span>**Mass of an electron:** The mass of an electron is approximately $0.00000000000000000000000000091093837 \text{ g}$.</span>
<span id="cb39-124"><a href="#cb39-124"></a>$$</span>
<span id="cb39-125"><a href="#cb39-125"></a>9.1093837 \times 10^{-28} \text{ g}</span>
<span id="cb39-126"><a href="#cb39-126"></a>$$</span>
<span id="cb39-127"><a href="#cb39-127"></a></span>
<span id="cb39-128"><a href="#cb39-128"></a><span class="fu">## Aside: Economic Examples</span></span>
<span id="cb39-129"><a href="#cb39-129"></a></span>
<span id="cb39-130"><a href="#cb39-130"></a><span class="ss">- </span>We can use social science numbers.</span>
<span id="cb39-131"><a href="#cb39-131"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Labor Market Outcomes of College Graduates by Major</span><span class="co">](https://www.newyorkfed.org/research/college-labor-market#--:explore:outcomes-by-major)</span></span>
<span id="cb39-132"><a href="#cb39-132"></a><span class="ss">- </span>Computer Science majors in 2023 have a \$80,000 median wage "early career"</span>
<span id="cb39-133"><a href="#cb39-133"></a><span class="ss">    - </span>$8.0000 \times 10^4$</span>
<span id="cb39-134"><a href="#cb39-134"></a><span class="ss">- </span>And 6.1% unemployment</span>
<span id="cb39-135"><a href="#cb39-135"></a><span class="ss">    - </span>$6.1 \times 10^{-2}$</span>
<span id="cb39-136"><a href="#cb39-136"></a></span>
<span id="cb39-137"><a href="#cb39-137"></a><span class="fu">## IEEE Layout</span></span>
<span id="cb39-138"><a href="#cb39-138"></a></span>
<span id="cb39-139"><a href="#cb39-139"></a><span class="ss">- </span>An approximation using scientific notation</span>
<span id="cb39-140"><a href="#cb39-140"></a><span class="ss">    - </span>$x = -1^s \times 2^e \times 1.m$</span>
<span id="cb39-141"><a href="#cb39-141"></a><span class="ss">    - </span>$x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}$</span>
<span id="cb39-142"><a href="#cb39-142"></a><span class="ss">        - </span>Where the mantissa is the technical term for the the digits after the decimal point.</span>
<span id="cb39-143"><a href="#cb39-143"></a>        </span>
<span id="cb39-144"><a href="#cb39-144"></a><span class="fu">## With Binary{.smaller}</span></span>
<span id="cb39-145"><a href="#cb39-145"></a></span>
<span id="cb39-146"><a href="#cb39-146"></a><span class="ss">- </span>$x = -0b1^{\text{0b0}} \times 0b10^{\text{0b10000000}}  \times 0b1.10010010000111111011011$</span>
<span id="cb39-147"><a href="#cb39-147"></a><span class="ss">- </span>Express in memory as the concatenation:</span>
<span id="cb39-148"><a href="#cb39-148"></a><span class="ss">    - </span><span class="in">`0b0`</span> to <span class="in">`0b10000000`</span> to <span class="in">`0b10010010000111111011011`</span></span>
<span id="cb39-149"><a href="#cb39-149"></a><span class="ss">    - </span><span class="in">`01000000010010010000111111011011`</span></span>
<span id="cb39-150"><a href="#cb39-150"></a>        </span>
<span id="cb39-151"><a href="#cb39-151"></a><span class="fu">## Singles and Doubles</span></span>
<span id="cb39-152"><a href="#cb39-152"></a>        </span>
<span id="cb39-153"><a href="#cb39-153"></a><span class="ss">- </span>32 - bits = 1 sign bit + 8 exponent bits + 23 mantissa bits</span>
<span id="cb39-154"><a href="#cb39-154"></a><span class="ss">    - </span><span class="in">`0b0`</span> to <span class="in">`0b10000000`</span> to <span class="in">`0b10010010000111111011011`</span></span>
<span id="cb39-155"><a href="#cb39-155"></a><span class="ss">- </span>64 - bits = 1 sign bit + 12 exponent bits + 52 mantissa bits</span>
<span id="cb39-156"><a href="#cb39-156"></a></span>
<span id="cb39-157"><a href="#cb39-157"></a><span class="fu">## Understanding check</span></span>
<span id="cb39-158"><a href="#cb39-158"></a></span>
<span id="cb39-159"><a href="#cb39-159"></a><span class="ss">- </span>What is the probability a *real number* $a \in \mathbb{R}$ has an exact float representation?</span>
<span id="cb39-160"><a href="#cb39-160"></a><span class="ss">- </span>What is the probability an *integer* $n \in \mathbb{Z}$ has an exact float representation?</span>
<span id="cb39-161"><a href="#cb39-161"></a><span class="ss">- </span>What is the probability a *course number* $n &lt; 600$ has an exact float representation?</span>
<span id="cb39-162"><a href="#cb39-162"></a></span>
<span id="cb39-163"><a href="#cb39-163"></a></span>
<span id="cb39-164"><a href="#cb39-164"></a><span class="fu">## Special Floats - NaN</span></span>
<span id="cb39-165"><a href="#cb39-165"></a></span>
<span id="cb39-166"><a href="#cb39-166"></a><span class="ss">- </span>Divide by Zero</span>
<span id="cb39-167"><a href="#cb39-167"></a><span class="ss">    - </span>1 / 0</span>
<span id="cb39-168"><a href="#cb39-168"></a><span class="ss">- </span>Not a Number (NaN)</span>
<span id="cb39-169"><a href="#cb39-169"></a></span>
<span id="cb39-170"><a href="#cb39-170"></a><span class="in">```py</span></span>
<span id="cb39-171"><a href="#cb39-171"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32</span>
<span id="cb39-172"><a href="#cb39-172"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">1</span>)<span class="op">/</span>f32(<span class="dv">0</span>)</span>
<span id="cb39-173"><a href="#cb39-173"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: divide by zero encountered <span class="kw">in</span> scalar divide</span>
<span id="cb39-174"><a href="#cb39-174"></a>np.float32(inf)</span>
<span id="cb39-175"><a href="#cb39-175"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span><span class="op">/</span><span class="dv">0</span></span>
<span id="cb39-176"><a href="#cb39-176"></a>Traceback (most recent call last):</span>
<span id="cb39-177"><a href="#cb39-177"></a>  File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb39-178"><a href="#cb39-178"></a><span class="pp">ZeroDivisionError</span>: division by zero</span>
<span id="cb39-179"><a href="#cb39-179"></a><span class="in">```</span></span>
<span id="cb39-180"><a href="#cb39-180"></a></span>
<span id="cb39-181"><a href="#cb39-181"></a><span class="fu">## Special Floats - inf</span></span>
<span id="cb39-182"><a href="#cb39-182"></a></span>
<span id="cb39-183"><a href="#cb39-183"></a><span class="ss">- </span>Signed Infinity</span>
<span id="cb39-184"><a href="#cb39-184"></a><span class="ss">    - </span>Overflow protection</span>
<span id="cb39-185"><a href="#cb39-185"></a><span class="in">```py</span></span>
<span id="cb39-186"><a href="#cb39-186"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>)</span>
<span id="cb39-187"><a href="#cb39-187"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: overflow encountered <span class="kw">in</span> scalar power</span>
<span id="cb39-188"><a href="#cb39-188"></a>np.float32(inf)</span>
<span id="cb39-189"><a href="#cb39-189"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">10.0</span> <span class="op">**</span> <span class="dv">10000</span></span>
<span id="cb39-190"><a href="#cb39-190"></a>Traceback (most recent call last):</span>
<span id="cb39-191"><a href="#cb39-191"></a>  File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb39-192"><a href="#cb39-192"></a><span class="pp">OverflowError</span>: (<span class="dv">34</span>, <span class="st">'Numerical result out of range'</span>)</span>
<span id="cb39-193"><a href="#cb39-193"></a><span class="in">```</span></span>
<span id="cb39-194"><a href="#cb39-194"></a></span>
<span id="cb39-195"><a href="#cb39-195"></a><span class="fu">## Infinity is signed </span></span>
<span id="cb39-196"><a href="#cb39-196"></a></span>
<span id="cb39-197"><a href="#cb39-197"></a><span class="ss">- </span>We can get negative infinity through a variety of means.</span>
<span id="cb39-198"><a href="#cb39-198"></a></span>
<span id="cb39-199"><a href="#cb39-199"></a><span class="in">```py</span></span>
<span id="cb39-200"><a href="#cb39-200"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span>(f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>))</span>
<span id="cb39-201"><a href="#cb39-201"></a>np.float32(<span class="op">-</span>inf)</span>
<span id="cb39-202"><a href="#cb39-202"></a><span class="in">```</span></span>
<span id="cb39-203"><a href="#cb39-203"></a></span>
<span id="cb39-204"><a href="#cb39-204"></a><span class="ss">- </span>We note that this suppresses the overflow error use <span class="in">`()`</span></span>
<span id="cb39-205"><a href="#cb39-205"></a><span class="ss">- </span>In some languages this is not ever regarded as an overflow error, like Julia (where we have to use larger powers due to the f64 default)</span>
<span id="cb39-206"><a href="#cb39-206"></a><span class="in">```jl</span></span>
<span id="cb39-207"><a href="#cb39-207"></a><span class="in">julia&gt; 10.0^10000</span></span>
<span id="cb39-208"><a href="#cb39-208"></a><span class="in">Inf</span></span>
<span id="cb39-209"><a href="#cb39-209"></a></span>
<span id="cb39-210"><a href="#cb39-210"></a><span class="in">julia&gt; -(10.0^10000)</span></span>
<span id="cb39-211"><a href="#cb39-211"></a><span class="in">-Inf</span></span>
<span id="cb39-212"><a href="#cb39-212"></a></span>
<span id="cb39-213"><a href="#cb39-213"></a><span class="in">```</span></span>
<span id="cb39-214"><a href="#cb39-214"></a></span>
<span id="cb39-215"><a href="#cb39-215"></a><span class="fu">## Signed Zero</span></span>
<span id="cb39-216"><a href="#cb39-216"></a></span>
<span id="cb39-217"><a href="#cb39-217"></a><span class="ss">- </span>Signed Zero</span>
<span id="cb39-218"><a href="#cb39-218"></a><span class="ss">    - </span>Underflow protection, preserves sign</span>
<span id="cb39-219"><a href="#cb39-219"></a><span class="ss">    - </span>+ 0 =‚àí 0</span>
<span id="cb39-220"><a href="#cb39-220"></a><span class="in">```py</span></span>
<span id="cb39-221"><a href="#cb39-221"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span></span>
<span id="cb39-222"><a href="#cb39-222"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb39-223"><a href="#cb39-223"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">==</span> (<span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span>)</span>
<span id="cb39-224"><a href="#cb39-224"></a><span class="va">True</span></span>
<span id="cb39-225"><a href="#cb39-225"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb39-226"><a href="#cb39-226"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb39-227"><a href="#cb39-227"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">-</span> <span class="fl">0.0</span></span>
<span id="cb39-228"><a href="#cb39-228"></a><span class="fl">0.0</span></span>
<span id="cb39-229"><a href="#cb39-229"></a><span class="in">```</span></span>
<span id="cb39-230"><a href="#cb39-230"></a><span class="ss">- </span>Works in base Python (e.g. don't need NumPy).</span>
<span id="cb39-231"><a href="#cb39-231"></a><span class="ss">- </span>Couldn't get it to work in Julia actually (went to -inf or NaN)</span>
<span id="cb39-232"><a href="#cb39-232"></a></span>
<span id="cb39-233"><a href="#cb39-233"></a></span>
<span id="cb39-234"><a href="#cb39-234"></a></span>
<span id="cb39-235"><a href="#cb39-235"></a><span class="fu">## Simple Example</span></span>
<span id="cb39-236"><a href="#cb39-236"></a></span>
<span id="cb39-237"><a href="#cb39-237"></a><span class="ss">- </span>Floating point is great because it will work exactly how you expect.</span>
<span id="cb39-238"><a href="#cb39-238"></a></span>
<span id="cb39-239"><a href="#cb39-239"></a><span class="in">```py</span></span>
<span id="cb39-240"><a href="#cb39-240"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb39-241"><a href="#cb39-241"></a><span class="va">False</span></span>
<span id="cb39-242"><a href="#cb39-242"></a><span class="in">```</span></span>
<span id="cb39-243"><a href="#cb39-243"></a></span>
<span id="cb39-244"><a href="#cb39-244"></a><span class="ss">- </span>More or less.</span>
<span id="cb39-245"><a href="#cb39-245"></a></span>
<span id="cb39-246"><a href="#cb39-246"></a><span class="in">```py</span></span>
<span id="cb39-247"><a href="#cb39-247"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span></span>
<span id="cb39-248"><a href="#cb39-248"></a><span class="fl">0.30000000000000004</span></span>
<span id="cb39-249"><a href="#cb39-249"></a><span class="in">```</span></span>
<span id="cb39-250"><a href="#cb39-250"></a></span>
<span id="cb39-251"><a href="#cb39-251"></a><span class="fu">## Simple Example</span></span>
<span id="cb39-252"><a href="#cb39-252"></a></span>
<span id="cb39-253"><a href="#cb39-253"></a></span>
<span id="cb39-254"><a href="#cb39-254"></a><span class="ss">- </span>We shouldn't be suprised by this!</span>
<span id="cb39-255"><a href="#cb39-255"></a><span class="in">```py</span></span>
<span id="cb39-256"><a href="#cb39-256"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f32(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb39-257"><a href="#cb39-257"></a><span class="fl">0.100000001490116119384765625</span></span>
<span id="cb39-258"><a href="#cb39-258"></a><span class="fl">0.20000000298023223876953125</span></span>
<span id="cb39-259"><a href="#cb39-259"></a><span class="fl">0.300000011920928955078125</span></span>
<span id="cb39-260"><a href="#cb39-260"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f64(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb39-261"><a href="#cb39-261"></a><span class="fl">0.1000000000000000055511151231257827021181583404541015625</span></span>
<span id="cb39-262"><a href="#cb39-262"></a><span class="fl">0.200000000000000011102230246251565404236316680908203125</span></span>
<span id="cb39-263"><a href="#cb39-263"></a><span class="fl">0.299999999999999988897769753748434595763683319091796875</span></span>
<span id="cb39-264"><a href="#cb39-264"></a><span class="in">```</span></span>
<span id="cb39-265"><a href="#cb39-265"></a></span>
<span id="cb39-266"><a href="#cb39-266"></a><span class="fu">## Storage of 1.</span></span>
<span id="cb39-267"><a href="#cb39-267"></a></span>
<span id="cb39-268"><a href="#cb39-268"></a></span>
<span id="cb39-269"><a href="#cb39-269"></a><span class="ss">- </span>$x = -1^s \times 2^e \times 1.m$</span>
<span id="cb39-270"><a href="#cb39-270"></a><span class="ss">- </span>$x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}$</span>
<span id="cb39-271"><a href="#cb39-271"></a><span class="ss">- </span>$x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1 + \text{mantissa} \times \frac{1}{2^n}$</span>
<span id="cb39-272"><a href="#cb39-272"></a><span class="ss">- </span>$1 = -1^0 \times 2^0 \times (1 + 0 \times \frac{1}{2^n}$</span>
<span id="cb39-273"><a href="#cb39-273"></a><span class="ss">- </span>So each of the sign bit, the base, and the mantissa are zero.</span>
<span id="cb39-274"><a href="#cb39-274"></a><span class="ss">    - </span>I should note I was unable to reproduce this in Rust or C.</span>
<span id="cb39-275"><a href="#cb39-275"></a><span class="ss">    - </span>I'm not really a floating pointer.</span>
<span id="cb39-276"><a href="#cb39-276"></a></span>
<span id="cb39-277"><a href="#cb39-277"></a><span class="fu">## Except...</span></span>
<span id="cb39-278"><a href="#cb39-278"></a></span>
<span id="cb39-279"><a href="#cb39-279"></a><span class="ss">- </span>This is actually a little bit fake.</span>
<span id="cb39-280"><a href="#cb39-280"></a><span class="in">```rs</span></span>
<span id="cb39-281"><a href="#cb39-281"></a><span class="op">$</span> cat src<span class="op">/</span>main<span class="op">.</span>rs</span>
<span id="cb39-282"><a href="#cb39-282"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb39-283"><a href="#cb39-283"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">1.0</span><span class="op">;</span></span>
<span id="cb39-284"><a href="#cb39-284"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> x<span class="op">.</span>to_bits())<span class="op">;</span></span>
<span id="cb39-285"><a href="#cb39-285"></a><span class="op">}</span></span>
<span id="cb39-286"><a href="#cb39-286"></a><span class="op">$</span> cargo run</span>
<span id="cb39-287"><a href="#cb39-287"></a>    Finished `dev` profile [unoptimized <span class="op">+</span> debuginfo] target(s) <span class="kw">in</span> <span class="dv">0</span><span class="op">.</span>00s</span>
<span id="cb39-288"><a href="#cb39-288"></a>     Running `target<span class="op">/</span>debug<span class="op">/</span>bits`</span>
<span id="cb39-289"><a href="#cb39-289"></a><span class="dv">00111111100000000000000000000000</span></span>
<span id="cb39-290"><a href="#cb39-290"></a><span class="in">```</span></span>
<span id="cb39-291"><a href="#cb39-291"></a><span class="ss">- </span>What is that?</span>
<span id="cb39-292"><a href="#cb39-292"></a></span>
<span id="cb39-293"><a href="#cb39-293"></a><span class="fu">## Shift 127</span></span>
<span id="cb39-294"><a href="#cb39-294"></a></span>
<span id="cb39-295"><a href="#cb39-295"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">While the exponent can be positive or negative, in binary formats it is stored as an unsigned number that has a fixed "bias" added to it.</span><span class="co">](https://en.wikipedia.org/wiki/Floating-point_arithmetic#Internal_representation)</span></span>
<span id="cb39-296"><a href="#cb39-296"></a></span>
<span id="cb39-297"><a href="#cb39-297"></a><span class="ss">- </span>The IEEE 754 binary format specifies a hardware implementation of such that the exponent, be it positive or negative, in binary formats is stored as an unsigned number that has a fixed "bias" added to it.</span>
<span id="cb39-298"><a href="#cb39-298"></a><span class="ss">- </span>In the case of 32 bit floats, the bias is 127.</span>
<span id="cb39-299"><a href="#cb39-299"></a></span>
<span id="cb39-300"><a href="#cb39-300"></a><span class="fu">## Breakdown</span></span>
<span id="cb39-301"><a href="#cb39-301"></a></span>
<span id="cb39-302"><a href="#cb39-302"></a><span class="ss">- </span>Take the following:</span>
<span id="cb39-303"><a href="#cb39-303"></a><span class="in">```sh</span></span>
<span id="cb39-304"><a href="#cb39-304"></a><span class="ex">00111111100000000000000000000000</span></span>
<span id="cb39-305"><a href="#cb39-305"></a><span class="in">```</span></span>
<span id="cb39-306"><a href="#cb39-306"></a><span class="ss">- </span>That is:</span>
<span id="cb39-307"><a href="#cb39-307"></a><span class="ss">    - </span>Sign bit of <span class="in">`0`</span></span>
<span id="cb39-308"><a href="#cb39-308"></a><span class="ss">    - </span>Exponent of <span class="in">`01111111`</span></span>
<span id="cb39-309"><a href="#cb39-309"></a><span class="ss">        - </span>All zeroes and all ones are reserved for <span class="in">`NaN`</span>, <span class="in">`inf`</span>, etc.</span>
<span id="cb39-310"><a href="#cb39-310"></a><span class="ss">    - </span>Mantissa of 23 zeroes.</span>
<span id="cb39-311"><a href="#cb39-311"></a>    </span>
<span id="cb39-312"><a href="#cb39-312"></a><span class="fu">## How precise?</span></span>
<span id="cb39-313"><a href="#cb39-313"></a></span>
<span id="cb39-314"><a href="#cb39-314"></a><span class="ss">- </span>I have referred to <span class="in">`f32`</span> as having "32 bits of precision".</span>
<span id="cb39-315"><a href="#cb39-315"></a><span class="ss">- </span>How much precision is that?</span>
<span id="cb39-316"><a href="#cb39-316"></a><span class="ss">- </span>Well, let's set the least significant bit of the mantissa to one.</span>
<span id="cb39-317"><a href="#cb39-317"></a><span class="in">```{.rs filename="main.rs"}</span></span>
<span id="cb39-318"><a href="#cb39-318"></a><span class="in">fn main() {</span></span>
<span id="cb39-319"><a href="#cb39-319"></a><span class="in">    let x:f32 = 1.0;</span></span>
<span id="cb39-320"><a href="#cb39-320"></a><span class="in">    let mut b:u32 = x.to_bits();</span></span>
<span id="cb39-321"><a href="#cb39-321"></a><span class="in">    b |= 1;</span></span>
<span id="cb39-322"><a href="#cb39-322"></a><span class="in">    println!("{:032b}", b);</span></span>
<span id="cb39-323"><a href="#cb39-323"></a><span class="in">    println!("{:1.32}", f32::from_bits(b));</span></span>
<span id="cb39-324"><a href="#cb39-324"></a><span class="in">}</span></span>
<span id="cb39-325"><a href="#cb39-325"></a><span class="in">```</span></span>
<span id="cb39-326"><a href="#cb39-326"></a></span>
<span id="cb39-327"><a href="#cb39-327"></a><span class="fu">## "Epsilon"</span></span>
<span id="cb39-328"><a href="#cb39-328"></a></span>
<span id="cb39-329"><a href="#cb39-329"></a><span class="ss">- </span>What do we get?</span>
<span id="cb39-330"><a href="#cb39-330"></a><span class="in">```sh</span></span>
<span id="cb39-331"><a href="#cb39-331"></a><span class="ex">$</span> cargo run</span>
<span id="cb39-332"><a href="#cb39-332"></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.00s</span></span>
<span id="cb39-333"><a href="#cb39-333"></a>     <span class="ex">Running</span> <span class="kw">`</span><span class="ex">target/debug/bits</span><span class="kw">`</span></span>
<span id="cb39-334"><a href="#cb39-334"></a><span class="ex">00111111100000000000000000000001</span></span>
<span id="cb39-335"><a href="#cb39-335"></a><span class="ex">1.00000011920928955078125000000000</span></span>
<span id="cb39-336"><a href="#cb39-336"></a><span class="in">```</span></span>
<span id="cb39-337"><a href="#cb39-337"></a></span>
<span id="cb39-338"><a href="#cb39-338"></a><span class="ss">- </span>We refer to this value (less one) as <span class="co">[</span><span class="ot">machine epsilon</span><span class="co">](https://en.wikipedia.org/wiki/Machine_epsilon)</span>, or perhaps $\varepsilon$.</span>
<span id="cb39-339"><a href="#cb39-339"></a><span class="ss">- </span>The difference between 1.0 and the next available floating point number.</span>
<span id="cb39-340"><a href="#cb39-340"></a><span class="ss">- </span>Much lower, of course, with double and quad precision.</span>
<span id="cb39-341"><a href="#cb39-341"></a></span>
<span id="cb39-342"><a href="#cb39-342"></a></span>
<span id="cb39-343"><a href="#cb39-343"></a><span class="fu">## Easier: "Sig figs"</span></span>
<span id="cb39-344"><a href="#cb39-344"></a></span>
<span id="cb39-345"><a href="#cb39-345"></a>| Format | Sign | Exp.  | Mant. | Bits  | Bias | Prec. | Significance |</span>
<span id="cb39-346"><a href="#cb39-346"></a>| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: |</span>
<span id="cb39-347"><a href="#cb39-347"></a>| Half  | 1 | 5 | 10 | 16 | 15 | 11 | **3-4** |</span>
<span id="cb39-348"><a href="#cb39-348"></a>| Single | 1 | 8 | 23 | 32 | 127 | 24 | **6-9** |</span>
<span id="cb39-349"><a href="#cb39-349"></a>| Double | 1 | 11 | 52 | 64 | 1023 | 53 | **15-17** |</span>
<span id="cb39-350"><a href="#cb39-350"></a>| Quad | 1 | 15 | 112 | 128 | 16383 | 113 | **33-36** |</span>
<span id="cb39-351"><a href="#cb39-351"></a></span>
<span id="cb39-352"><a href="#cb39-352"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Prof. Kahan, UCB EECS</span><span class="co">](https://people.eecs.berkeley.edu/~wkahan/ieee754status/IEEE754.PDF)</span></span>
<span id="cb39-353"><a href="#cb39-353"></a></span>
<span id="cb39-354"><a href="#cb39-354"></a><span class="fu">## Sig figs</span></span>
<span id="cb39-355"><a href="#cb39-355"></a></span>
<span id="cb39-356"><a href="#cb39-356"></a><span class="ss">- </span>IEEE 754 was intended for *scientific computing*</span>
<span id="cb39-357"><a href="#cb39-357"></a><span class="ss">- </span>That is, not systems computing, software etc.</span>
<span id="cb39-358"><a href="#cb39-358"></a><span class="ss">- </span>Useful to us to think about information and how bits work.</span>
<span id="cb39-359"><a href="#cb39-359"></a></span>
<span id="cb39-360"><a href="#cb39-360"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">Significant figures, also referred to as significant digits, are specific digits within a number that is written in positional notation that carry both reliability and necessity in conveying a particular quantity.</span><span class="co">](https://en.wikipedia.org/wiki/Significant_figures)</span></span>
<span id="cb39-361"><a href="#cb39-361"></a></span>
<span id="cb39-362"><a href="#cb39-362"></a><span class="fu">## Small Values</span></span>
<span id="cb39-363"><a href="#cb39-363"></a></span>
<span id="cb39-364"><a href="#cb39-364"></a><span class="ss">- </span>For 32-bit floats, the minimum base 10 exponent is -36.</span>
<span id="cb39-365"><a href="#cb39-365"></a><span class="ss">- </span>How is $1.0 \times 10^{-37}$ represented?</span>
<span id="cb39-366"><a href="#cb39-366"></a></span>
<span id="cb39-367"><a href="#cb39-367"></a><span class="in">```rs</span></span>
<span id="cb39-368"><a href="#cb39-368"></a><span class="co">// In Rust, we may use '0b' prefix for binary representation.</span></span>
<span id="cb39-369"><a href="#cb39-369"></a><span class="co">// In Rust, we may us underscores within numerical values.</span></span>
<span id="cb39-370"><a href="#cb39-370"></a><span class="dv">0b0_00000000_11011001110001111101110</span></span>
<span id="cb39-371"><a href="#cb39-371"></a><span class="in">```</span></span>
<span id="cb39-372"><a href="#cb39-372"></a></span>
<span id="cb39-373"><a href="#cb39-373"></a><span class="fu">## Test it</span></span>
<span id="cb39-374"><a href="#cb39-374"></a></span>
<span id="cb39-375"><a href="#cb39-375"></a><span class="ss">- </span>Write a simple test...</span>
<span id="cb39-376"><a href="#cb39-376"></a><span class="in">```{.rs filename="src/main.rs"}</span></span>
<span id="cb39-377"><a href="#cb39-377"></a><span class="in">fn main() {</span></span>
<span id="cb39-378"><a href="#cb39-378"></a><span class="in">    let b:u32 = 0b0_00000000_11011001110001111101110;</span></span>
<span id="cb39-379"><a href="#cb39-379"></a><span class="in">    println!("{:032b}", b);</span></span>
<span id="cb39-380"><a href="#cb39-380"></a><span class="in">    println!("{:1.100}", f32::from_bits(b));</span></span>
<span id="cb39-381"><a href="#cb39-381"></a><span class="in">    let x:f32 = 10.0_f32.powf(-38.0_f32);</span></span>
<span id="cb39-382"><a href="#cb39-382"></a><span class="in">    println!("{:032b}", x.to_bits());</span></span>
<span id="cb39-383"><a href="#cb39-383"></a><span class="in">    println!("{:1.100}", x);</span></span>
<span id="cb39-384"><a href="#cb39-384"></a><span class="in">}</span></span>
<span id="cb39-385"><a href="#cb39-385"></a><span class="in">```</span></span>
<span id="cb39-386"><a href="#cb39-386"></a><span class="ss">- </span>Results are as expected.</span>
<span id="cb39-387"><a href="#cb39-387"></a><span class="in">```sh</span></span>
<span id="cb39-388"><a href="#cb39-388"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb39-389"><a href="#cb39-389"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span>
<span id="cb39-390"><a href="#cb39-390"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb39-391"><a href="#cb39-391"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span>
<span id="cb39-392"><a href="#cb39-392"></a><span class="in">```</span></span>
<span id="cb39-393"><a href="#cb39-393"></a></span>
<span id="cb39-394"><a href="#cb39-394"></a></span>
<span id="cb39-395"><a href="#cb39-395"></a><span class="fu">## "Denormalized Number"</span></span>
<span id="cb39-396"><a href="#cb39-396"></a></span>
<span id="cb39-397"><a href="#cb39-397"></a><span class="ss">- </span>Numbers that have a zero exponent</span>
<span id="cb39-398"><a href="#cb39-398"></a><span class="ss">- </span>Required when the exponent is below the minimum exponent</span>
<span id="cb39-399"><a href="#cb39-399"></a><span class="ss">- </span>Helps prevent underflow</span>
<span id="cb39-400"><a href="#cb39-400"></a><span class="ss">- </span>Generally speaking, if you are using one these, the math is about to get wronger than you'd think.</span>
<span id="cb39-401"><a href="#cb39-401"></a><span class="ss">- </span>The good (???) language C++ provides a <span class="in">`std::nextafter`</span> for which Rust crates exist.</span>
<span id="cb39-402"><a href="#cb39-402"></a></span>
<span id="cb39-403"><a href="#cb39-403"></a><span class="fu">## Floating Point Precision</span></span>
<span id="cb39-404"><a href="#cb39-404"></a></span>
<span id="cb39-405"><a href="#cb39-405"></a></span>
<span id="cb39-406"><a href="#cb39-406"></a><span class="ss">- </span>Representation is not uniform between numbers</span>
<span id="cb39-407"><a href="#cb39-407"></a><span class="ss">- </span>Most precision lies between 0.0 and 0.1</span>
<span id="cb39-408"><a href="#cb39-408"></a><span class="ss">- </span>Precision falls away</span>
<span id="cb39-409"><a href="#cb39-409"></a></span>
<span id="cb39-410"><a href="#cb39-410"></a><span class="fu">## Visually</span></span>
<span id="cb39-411"><a href="#cb39-411"></a></span>
<span id="cb39-412"><a href="#cb39-412"></a><span class="al">![](https://dwayneneed.github.io/static/img/2010-05-06-fun-with-floating-point_6bit-float-distribution.png)</span></span>
<span id="cb39-413"><a href="#cb39-413"></a></span>
<span id="cb39-414"><a href="#cb39-414"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Fun with floating point, Dwayne Need</span><span class="co">](https://dwayneneed.github.io/.net/2010/05/06/fun-with-floating-point.html)</span></span>
<span id="cb39-415"><a href="#cb39-415"></a></span>
<span id="cb39-416"><a href="#cb39-416"></a><span class="fu">## Floating Point Precision</span></span>
<span id="cb39-417"><a href="#cb39-417"></a></span>
<span id="cb39-418"><a href="#cb39-418"></a>The number of floats from 0.0</span>
<span id="cb39-419"><a href="#cb39-419"></a></span>
<span id="cb39-420"><a href="#cb39-420"></a><span class="ss">- </span>... to 0.1 = 1,036,831,949</span>
<span id="cb39-421"><a href="#cb39-421"></a><span class="ss">- </span>... to 0.2 = 8,388,608</span>
<span id="cb39-422"><a href="#cb39-422"></a><span class="ss">- </span>... to 0.4 = 8,388,608</span>
<span id="cb39-423"><a href="#cb39-423"></a><span class="ss">- </span>... to 0.8 = 8,388,608</span>
<span id="cb39-424"><a href="#cb39-424"></a><span class="ss">- </span>... to 1.6 = 8,388,608</span>
<span id="cb39-425"><a href="#cb39-425"></a><span class="ss">- </span>... to 3.2 = 8,388,608</span>
<span id="cb39-426"><a href="#cb39-426"></a></span>
<span id="cb39-427"><a href="#cb39-427"></a></span>
<span id="cb39-428"><a href="#cb39-428"></a><span class="fu">## Errors in Floating Point</span></span>
<span id="cb39-429"><a href="#cb39-429"></a></span>
<span id="cb39-430"><a href="#cb39-430"></a><span class="ss">- </span>Storage of $\pi$</span>
<span id="cb39-431"><a href="#cb39-431"></a><span class="in">```py</span></span>
<span id="cb39-432"><a href="#cb39-432"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> pi <span class="im">as</span> pi</span>
<span id="cb39-433"><a href="#cb39-433"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># copy paste Wolfram|Alpha</span></span>
<span id="cb39-434"><a href="#cb39-434"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb39-435"><a href="#cb39-435"></a><span class="co">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb39-436"><a href="#cb39-436"></a><span class="op">&gt;&gt;&gt;</span> <span class="ss">f'</span><span class="sc">{</span>pi<span class="sc">:1.100}</span><span class="ss">'</span></span>
<span id="cb39-437"><a href="#cb39-437"></a><span class="co">'3.141592653589793115997963468544185161590576171875'</span></span>
<span id="cb39-438"><a href="#cb39-438"></a><span class="in">```</span></span>
<span id="cb39-439"><a href="#cb39-439"></a><span class="ss">- </span>They differ fairly early on!</span>
<span id="cb39-440"><a href="#cb39-440"></a></span>
<span id="cb39-441"><a href="#cb39-441"></a><span class="fu">## Measuring Error: "Ulps"</span></span>
<span id="cb39-442"><a href="#cb39-442"></a></span>
<span id="cb39-443"><a href="#cb39-443"></a><span class="ss">- </span>Units in Last Place</span>
<span id="cb39-444"><a href="#cb39-444"></a></span>
<span id="cb39-445"><a href="#cb39-445"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">In computer science and numerical analysis, unit in the last place or unit of least precision (ulp) is the spacing between two consecutive floating-point numbers, i.e., the value the least significant digit (rightmost digit) represents if it is 1. It is used as a measure of accuracy in numeric calculations.</span><span class="co">](https://en.wikipedia.org/wiki/Unit_in_the_last_place)</span></span>
<span id="cb39-446"><a href="#cb39-446"></a></span>
<span id="cb39-447"><a href="#cb39-447"></a><span class="fu">## Generators</span></span>
<span id="cb39-448"><a href="#cb39-448"></a></span>
<span id="cb39-449"><a href="#cb39-449"></a><span class="ss">- </span>By convention we check number theoretic results with lazily evaluated generator expressions in Python.</span>
<span id="cb39-450"><a href="#cb39-450"></a><span class="ss">- </span>The following generators all powers of two for a which adding one does not change the value within Python floating points.</span>
<span id="cb39-451"><a href="#cb39-451"></a><span class="in">```py</span></span>
<span id="cb39-452"><a href="#cb39-452"></a><span class="im">from</span> itertools <span class="im">import</span> count</span>
<span id="cb39-453"><a href="#cb39-453"></a></span>
<span id="cb39-454"><a href="#cb39-454"></a>gen <span class="op">=</span> (i <span class="cf">for</span> i <span class="kw">in</span> count() <span class="cf">if</span> <span class="fl">2.0</span> <span class="op">**</span> <span class="bu">float</span>(i) <span class="op">+</span> <span class="fl">1.0</span> <span class="op">==</span> <span class="fl">2.0</span> <span class="op">**</span> <span class="bu">float</span>(i))</span>
<span id="cb39-455"><a href="#cb39-455"></a></span>
<span id="cb39-456"><a href="#cb39-456"></a>x <span class="op">=</span> <span class="bu">next</span>(gen)</span>
<span id="cb39-457"><a href="#cb39-457"></a></span>
<span id="cb39-458"><a href="#cb39-458"></a><span class="bu">print</span>(<span class="st">'2.0 ** x + 0.0 = '</span>, <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">0.0</span>)</span>
<span id="cb39-459"><a href="#cb39-459"></a><span class="bu">print</span>(<span class="st">'2.0 ** x + 1.0 = '</span>, <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">1.0</span>)</span>
<span id="cb39-460"><a href="#cb39-460"></a><span class="in">```</span></span>
<span id="cb39-461"><a href="#cb39-461"></a></span>
<span id="cb39-462"><a href="#cb39-462"></a><span class="fu">## Iterators</span></span>
<span id="cb39-463"><a href="#cb39-463"></a></span>
<span id="cb39-464"><a href="#cb39-464"></a><span class="ss">- </span>Rust doesn't require iterators, supporting the infinite iterator by default using <span class="in">`unwrap`</span>.</span>
<span id="cb39-465"><a href="#cb39-465"></a><span class="in">```rs</span></span>
<span id="cb39-466"><a href="#cb39-466"></a><span class="kw">let</span> x <span class="op">=</span> (<span class="dv">0</span><span class="op">..</span>)<span class="op">.</span>find(<span class="op">|&amp;</span>i<span class="op">|</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> i) <span class="op">+</span> <span class="dv">1.0</span> <span class="op">==</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> i))<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb39-467"><a href="#cb39-467"></a></span>
<span id="cb39-468"><a href="#cb39-468"></a><span class="kw">let</span> base <span class="op">=</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> x)<span class="op">;</span></span>
<span id="cb39-469"><a href="#cb39-469"></a></span>
<span id="cb39-470"><a href="#cb39-470"></a><span class="co">// Prints the result (2^53 = 9007199254740992.0)</span></span>
<span id="cb39-471"><a href="#cb39-471"></a><span class="pp">println!</span>(<span class="st">"2.0 ** x + 0.0 = {:.1}"</span><span class="op">,</span> base)<span class="op">;</span></span>
<span id="cb39-472"><a href="#cb39-472"></a><span class="pp">println!</span>(<span class="st">"2.0 ** x + 1.0 = {:.1}"</span><span class="op">,</span> base <span class="op">+</span> <span class="dv">1.0</span>)<span class="op">;</span></span>
<span id="cb39-473"><a href="#cb39-473"></a><span class="in">```</span></span>
<span id="cb39-474"><a href="#cb39-474"></a><span class="ss">- </span>I haven't used <span class="in">`find`</span> before, this is an LLM donation to our knowledge base.</span>
<span id="cb39-475"><a href="#cb39-475"></a><span class="ss">- </span>By the way, that is basically <span class="in">`2 ** 53`</span> and there are 52 bits of mantissa precision.</span>
<span id="cb39-476"><a href="#cb39-476"></a></span>
<span id="cb39-477"><a href="#cb39-477"></a><span class="fu">## On "Ulps"</span></span>
<span id="cb39-478"><a href="#cb39-478"></a></span>
<span id="cb39-479"><a href="#cb39-479"></a><span class="ss">- </span>We can measure error using ULPs.</span>
<span id="cb39-480"><a href="#cb39-480"></a></span>
<span id="cb39-481"><a href="#cb39-481"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">The gap between the two floating-point numbers nearest to x, even if x is one of )them.</span><span class="co">](https://www.cs.berkeley.edu/~wkahan/LOG10HAF.TXT)</span></span>
<span id="cb39-482"><a href="#cb39-482"></a></span>
<span id="cb39-483"><a href="#cb39-483"></a><span class="in">```py</span></span>
<span id="cb39-484"><a href="#cb39-484"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32, pi <span class="im">as</span> pi, float64 <span class="im">as</span> f64</span>
<span id="cb39-485"><a href="#cb39-485"></a><span class="op">&gt;&gt;&gt;</span> f64(pi) <span class="op">-</span> f64(f32(pi))</span>
<span id="cb39-486"><a href="#cb39-486"></a>np.float64(<span class="op">-</span><span class="fl">8.742278012618954e-08</span>)</span>
<span id="cb39-487"><a href="#cb39-487"></a><span class="in">```</span></span>
<span id="cb39-488"><a href="#cb39-488"></a></span>
<span id="cb39-489"><a href="#cb39-489"></a><span class="fu">## Rounding</span></span>
<span id="cb39-490"><a href="#cb39-490"></a></span>
<span id="cb39-491"><a href="#cb39-491"></a><span class="ss">- </span>We have some guarantees:</span>
<span id="cb39-492"><a href="#cb39-492"></a><span class="ss">    - </span>IEEE 754 requires that that elementary arithmetic operations are correctly rounded to within 0.5 ulps</span>
<span id="cb39-493"><a href="#cb39-493"></a><span class="ss">    - </span>Transcendental functions are generally rounded to between 0.5 and 1.0 ulps</span>
<span id="cb39-494"><a href="#cb39-494"></a><span class="ss">        - </span>Transcendental as in $\pi$ or $e$</span>
<span id="cb39-495"><a href="#cb39-495"></a></span>
<span id="cb39-496"><a href="#cb39-496"></a><span class="ss">- </span>~9 ulps</span>
<span id="cb39-497"><a href="#cb39-497"></a></span>
<span id="cb39-498"><a href="#cb39-498"></a><span class="fu"># Relative Error</span></span>
<span id="cb39-499"><a href="#cb39-499"></a></span>
<span id="cb39-500"><a href="#cb39-500"></a><span class="ss">- </span>The difference between the "real" number and the approximated number, divided by the "real" number.</span>
<span id="cb39-501"><a href="#cb39-501"></a></span>
<span id="cb39-502"><a href="#cb39-502"></a><span class="in">```py</span></span>
<span id="cb39-503"><a href="#cb39-503"></a><span class="op">&gt;&gt;&gt;</span> f64(f32(pi))<span class="op">/</span>f64(pi)</span>
<span id="cb39-504"><a href="#cb39-504"></a>np.float64(<span class="fl">1.0000000278275352</span>)</span>
<span id="cb39-505"><a href="#cb39-505"></a><span class="in">```</span></span>
<span id="cb39-506"><a href="#cb39-506"></a></span>
<span id="cb39-507"><a href="#cb39-507"></a><span class="ss">- </span>So for <span class="in">`pi`</span> in <span class="in">`f32`</span>, around $2.9 \times 10^{-8}$</span>
<span id="cb39-508"><a href="#cb39-508"></a></span>
<span id="cb39-509"><a href="#cb39-509"></a><span class="fu">## Rounding Error</span></span>
<span id="cb39-510"><a href="#cb39-510"></a></span>
<span id="cb39-511"><a href="#cb39-511"></a><span class="ss">- </span>Induced by approximating an infinite range of numbers into a finite number of bits</span>
<span id="cb39-512"><a href="#cb39-512"></a><span class="ss">- </span>Rounding is:</span>
<span id="cb39-513"><a href="#cb39-513"></a><span class="ss">    - </span>Towards the nearest</span>
<span id="cb39-514"><a href="#cb39-514"></a><span class="ss">    - </span>Towards zero</span>
<span id="cb39-515"><a href="#cb39-515"></a><span class="ss">    - </span>Towards positive infinity (round up)</span>
<span id="cb39-516"><a href="#cb39-516"></a><span class="ss">    - </span>Towards negative infinity (round down)</span>
<span id="cb39-517"><a href="#cb39-517"></a></span>
<span id="cb39-518"><a href="#cb39-518"></a><span class="fu">## Rounding Error</span></span>
<span id="cb39-519"><a href="#cb39-519"></a></span>
<span id="cb39-520"><a href="#cb39-520"></a><span class="ss">- </span>What about rounding the half-way case? (i.e. 0.5)</span>
<span id="cb39-521"><a href="#cb39-521"></a><span class="ss">    - </span>Round Up vs. Round Even</span>
<span id="cb39-522"><a href="#cb39-522"></a><span class="ss">- </span>Correct Rounding:</span>
<span id="cb39-523"><a href="#cb39-523"></a><span class="ss">    - </span>Basic operations (add, subtract, multiply, divide, sqrt) should return the number nearest the</span>
<span id="cb39-524"><a href="#cb39-524"></a>       mathematical result.</span>
<span id="cb39-525"><a href="#cb39-525"></a><span class="ss">    - </span>If there is a tie, round to the number with an even mantissa</span>
<span id="cb39-526"><a href="#cb39-526"></a></span>
<span id="cb39-527"><a href="#cb39-527"></a><span class="fu">## Implementation</span></span>
<span id="cb39-528"><a href="#cb39-528"></a></span>
<span id="cb39-529"><a href="#cb39-529"></a><span class="ss">- </span>"Guard Bit", "Round Bit", "Sticky Bit"</span>
<span id="cb39-530"><a href="#cb39-530"></a><span class="ss">- </span>Only used while doing calculations</span>
<span id="cb39-531"><a href="#cb39-531"></a><span class="ss">    - </span>Not stored in the float itself</span>
<span id="cb39-532"><a href="#cb39-532"></a><span class="ss">    - </span>The mantissa is shifted in calculations to align radix</span>
<span id="cb39-533"><a href="#cb39-533"></a><span class="ss">- </span>The guard bits and round bits are extra precision</span>
<span id="cb39-534"><a href="#cb39-534"></a><span class="ss">- </span>The sticky bit is an OR of anything that shifts through it</span>
<span id="cb39-535"><a href="#cb39-535"></a></span>
<span id="cb39-536"><a href="#cb39-536"></a><span class="in">```rs</span></span>
<span id="cb39-537"><a href="#cb39-537"></a>0_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span>
<span id="cb39-538"><a href="#cb39-538"></a><span class="in">```</span></span>
<span id="cb39-539"><a href="#cb39-539"></a></span>
<span id="cb39-540"><a href="#cb39-540"></a><span class="fu">## Special bits</span></span>
<span id="cb39-541"><a href="#cb39-541"></a></span>
<span id="cb39-542"><a href="#cb39-542"></a><span class="ss">- </span>"Guard Bit", "Round Bit", "Sticky Bit"</span>
<span id="cb39-543"><a href="#cb39-543"></a><span class="ss">- </span>**[G][R][S]**</span>
<span id="cb39-544"><a href="#cb39-544"></a><span class="ss">- </span>**[0][-][-]** - Round Down (do nothing)</span>
<span id="cb39-545"><a href="#cb39-545"></a><span class="ss">- </span>**[1][0][0]** - Round Up if the mantissa LSB is 1</span>
<span id="cb39-546"><a href="#cb39-546"></a><span class="ss">- </span>**[1][0][1]** - Round Up</span>
<span id="cb39-547"><a href="#cb39-547"></a><span class="ss">- </span>**[1][1][0]** - Round Up</span>
<span id="cb39-548"><a href="#cb39-548"></a><span class="ss">- </span>**[1][1][1]** - Round Up</span>
<span id="cb39-549"><a href="#cb39-549"></a></span>
<span id="cb39-550"><a href="#cb39-550"></a><span class="in">```rs</span></span>
<span id="cb39-551"><a href="#cb39-551"></a>0_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span>
<span id="cb39-552"><a href="#cb39-552"></a><span class="in">```</span></span>
<span id="cb39-553"><a href="#cb39-553"></a></span>
<span id="cb39-554"><a href="#cb39-554"></a><span class="fu">## Significance Error</span></span>
<span id="cb39-555"><a href="#cb39-555"></a></span>
<span id="cb39-556"><a href="#cb39-556"></a><span class="ss">- </span>Compute the Area of a Triangle</span>
<span id="cb39-557"><a href="#cb39-557"></a><span class="ss">    - </span>Heron‚Äôs Formula:</span>
<span id="cb39-558"><a href="#cb39-558"></a><span class="ss">       - </span>ùê¥ = ùë•+ùë¶ 2 +ùëç ùë•+ùë¶ 2 +ùëç ‚àíùë• ùë•+ùë¶ 2 +ùëç ‚àíùë¶ ùë•+ùë¶ 2 +ùëç ‚àíùëß</span>
<span id="cb39-559"><a href="#cb39-559"></a><span class="ss">    - </span>Kahan‚ÄôsAlgorithm:</span>
<span id="cb39-560"><a href="#cb39-560"></a><span class="ss">       - </span>Sort x, y, z such that ùë•‚â•ùë¶ ‚â•ùëß</span>
<span id="cb39-561"><a href="#cb39-561"></a><span class="ss">       - </span>If ùëß&lt; ùë•‚àíùë¶, then no such triangle exists.</span>
<span id="cb39-562"><a href="#cb39-562"></a><span class="ss">       - </span>Else ùê¥ = (ùë•+ùë¶+ùëß) √ó ùëß‚àí(ùë•‚àíùë¶ )√ó 4 (ùëß+ùë•‚àíùë¶ )√ó(ùë•+ùë¶‚àíùëß)</span>
<span id="cb39-563"><a href="#cb39-563"></a></span>
<span id="cb39-564"><a href="#cb39-564"></a></span>
<span id="cb39-565"><a href="#cb39-565"></a>Significance Error</span>
<span id="cb39-566"><a href="#cb39-566"></a></span>
<span id="cb39-567"><a href="#cb39-567"></a><span class="in">```</span></span>
<span id="cb39-568"><a href="#cb39-568"></a><span class="in">/// Area of a triangle</span></span>
<span id="cb39-569"><a href="#cb39-569"></a><span class="in">/// From http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html</span></span>
<span id="cb39-570"><a href="#cb39-570"></a><span class="in">/// From https://www.cs.berkeley.edu/~wkahan/Triangle.pdf</span></span>
<span id="cb39-571"><a href="#cb39-571"></a><span class="in">TEST(CPPCon2015, AreaOfATriangleFloat)</span></span>
<span id="cb39-572"><a href="#cb39-572"></a><span class="in">{</span></span>
<span id="cb39-573"><a href="#cb39-573"></a><span class="in">const auto a = 100000.0f;</span></span>
<span id="cb39-574"><a href="#cb39-574"></a><span class="in">const auto b = 99999.99979f;</span></span>
<span id="cb39-575"><a href="#cb39-575"></a><span class="in">const auto c = 0.00029f;</span></span>
<span id="cb39-576"><a href="#cb39-576"></a><span class="in">```</span></span>
<span id="cb39-577"><a href="#cb39-577"></a><span class="in">```</span></span>
<span id="cb39-578"><a href="#cb39-578"></a><span class="in">ASSERT_TRUE(a &gt;= b);</span></span>
<span id="cb39-579"><a href="#cb39-579"></a><span class="in">ASSERT_TRUE(b &gt;= c);</span></span>
<span id="cb39-580"><a href="#cb39-580"></a><span class="in">```</span></span>
<span id="cb39-581"><a href="#cb39-581"></a><span class="in">```</span></span>
<span id="cb39-582"><a href="#cb39-582"></a><span class="in">auto heronsFormula = HeronsFormula(a, b, c);</span></span>
<span id="cb39-583"><a href="#cb39-583"></a><span class="in">auto kahansFormula = KahansFormula(a, b, c);</span></span>
<span id="cb39-584"><a href="#cb39-584"></a><span class="in">EXPECT_NE(kahansFormula, heronsFormula);</span></span>
<span id="cb39-585"><a href="#cb39-585"></a><span class="in">cppCon() &lt;&lt; "Kahan: " &lt;&lt; kahansFormula;</span></span>
<span id="cb39-586"><a href="#cb39-586"></a><span class="in">cppCon() &lt;&lt; "Heron: " &lt;&lt; heronsFormula;</span></span>
<span id="cb39-587"><a href="#cb39-587"></a><span class="in">cppCon() &lt;&lt; "delta: " &lt;&lt; kahansFormula - heronsFormula &lt;&lt; "\n";</span></span>
<span id="cb39-588"><a href="#cb39-588"></a><span class="in">}</span></span>
<span id="cb39-589"><a href="#cb39-589"></a><span class="in">```</span></span>
<span id="cb39-590"><a href="#cb39-590"></a></span>
<span id="cb39-591"><a href="#cb39-591"></a>Significance Error</span>
<span id="cb39-592"><a href="#cb39-592"></a></span>
<span id="cb39-593"><a href="#cb39-593"></a>Heron: 0.000000000000000000000000000000</span>
<span id="cb39-594"><a href="#cb39-594"></a></span>
<span id="cb39-595"><a href="#cb39-595"></a>Kahan: 14.500000000000000000000000000000</span>
<span id="cb39-596"><a href="#cb39-596"></a></span>
<span id="cb39-597"><a href="#cb39-597"></a>delta: 14.500000000000000000000000000000</span>
<span id="cb39-598"><a href="#cb39-598"></a></span>
<span id="cb39-599"><a href="#cb39-599"></a></span>
<span id="cb39-600"><a href="#cb39-600"></a>Significance Error</span>
<span id="cb39-601"><a href="#cb39-601"></a></span>
<span id="cb39-602"><a href="#cb39-602"></a>Heron: 0.000000000000000000000000000000</span>
<span id="cb39-603"><a href="#cb39-603"></a></span>
<span id="cb39-604"><a href="#cb39-604"></a>Kahan: 14.500000000000000000000000000000</span>
<span id="cb39-605"><a href="#cb39-605"></a></span>
<span id="cb39-606"><a href="#cb39-606"></a>delta: 14.500000000000000000000000000000</span>
<span id="cb39-607"><a href="#cb39-607"></a></span>
<span id="cb39-608"><a href="#cb39-608"></a>Hint: The Answer is 10.0</span>
<span id="cb39-609"><a href="#cb39-609"></a></span>
<span id="cb39-610"><a href="#cb39-610"></a></span>
<span id="cb39-611"><a href="#cb39-611"></a>Significance Error</span>
<span id="cb39-612"><a href="#cb39-612"></a></span>
<span id="cb39-613"><a href="#cb39-613"></a>Heron: 0.000000000000000000000000000000</span>
<span id="cb39-614"><a href="#cb39-614"></a></span>
<span id="cb39-615"><a href="#cb39-615"></a>Kahan: 14.500000000000000000000000000000</span>
<span id="cb39-616"><a href="#cb39-616"></a></span>
<span id="cb39-617"><a href="#cb39-617"></a>delta: 14.500000000000000000000000000000</span>
<span id="cb39-618"><a href="#cb39-618"></a></span>
<span id="cb39-619"><a href="#cb39-619"></a>Heron: 9.999999809638328700000000000000</span>
<span id="cb39-620"><a href="#cb39-620"></a></span>
<span id="cb39-621"><a href="#cb39-621"></a>Kahan: 10.000000077021038000000000000000</span>
<span id="cb39-622"><a href="#cb39-622"></a></span>
<span id="cb39-623"><a href="#cb39-623"></a>delta: 0.000000267382709751018410000000</span>
<span id="cb39-624"><a href="#cb39-624"></a></span>
<span id="cb39-625"><a href="#cb39-625"></a></span>
<span id="cb39-626"><a href="#cb39-626"></a>Significance Error - Use Stable Algorithms</span>
<span id="cb39-627"><a href="#cb39-627"></a></span>
<span id="cb39-628"><a href="#cb39-628"></a><span class="ss">- </span>Loss of Significance</span>
<span id="cb39-629"><a href="#cb39-629"></a><span class="ss">    - </span>Keep big numbers with big numbers, little numbers with little numbers.</span>
<span id="cb39-630"><a href="#cb39-630"></a><span class="ss">- </span>Parentheses can help</span>
<span id="cb39-631"><a href="#cb39-631"></a><span class="ss">- </span>Analysis of Algorithms is Critical</span>
<span id="cb39-632"><a href="#cb39-632"></a><span class="ss">- </span>The compiler won‚Äôt re-arrange your math if it cannot prove it would yield the same</span>
<span id="cb39-633"><a href="#cb39-633"></a></span>
<span id="cb39-634"><a href="#cb39-634"></a>result, even if the computation would be faster</span>
<span id="cb39-635"><a href="#cb39-635"></a></span>
<span id="cb39-636"><a href="#cb39-636"></a><span class="ss">- </span>ùë• = ùëè‚àí ùëé+ùëè ‚àíùëé should not be replaced with ùë•= 0</span>
<span id="cb39-637"><a href="#cb39-637"></a><span class="ss">- </span>See the "Kahan‚ÄôsAlgorithm" example</span>
<span id="cb39-638"><a href="#cb39-638"></a></span>
<span id="cb39-639"><a href="#cb39-639"></a></span>
<span id="cb39-640"><a href="#cb39-640"></a>Significance Error ‚Äì Simulation Time</span>
<span id="cb39-641"><a href="#cb39-641"></a></span>
<span id="cb39-642"><a href="#cb39-642"></a><span class="ss">- </span>Time is used to compute distance, velocity, acceleration</span>
<span id="cb39-643"><a href="#cb39-643"></a><span class="ss">    - </span>High frequency phenomena</span>
<span id="cb39-644"><a href="#cb39-644"></a><span class="ss">    - </span>Sensors: Doppler shift, pulse compression, PRF</span>
<span id="cb39-645"><a href="#cb39-645"></a><span class="ss">- </span>These computed values feed into other computed values which may or may not</span>
<span id="cb39-646"><a href="#cb39-646"></a></span>
<span id="cb39-647"><a href="#cb39-647"></a>require a time component</span>
<span id="cb39-648"><a href="#cb39-648"></a></span>
<span id="cb39-649"><a href="#cb39-649"></a><span class="ss">- </span>Thousands of computations per frame of simulation</span>
<span id="cb39-650"><a href="#cb39-650"></a><span class="ss">    - </span>Thousands of little compounding errors per frame</span>
<span id="cb39-651"><a href="#cb39-651"></a><span class="ss">- </span>Combine with poor or nonexistent testing</span>
<span id="cb39-652"><a href="#cb39-652"></a></span>
<span id="cb39-653"><a href="#cb39-653"></a></span>
<span id="cb39-654"><a href="#cb39-654"></a>Significance Error ‚Äì Simulation Time</span>
<span id="cb39-655"><a href="#cb39-655"></a></span>
<span id="cb39-656"><a href="#cb39-656"></a><span class="ss">- </span>Accumulate Time (works for arbitrary</span>
<span id="cb39-657"><a href="#cb39-657"></a></span>
<span id="cb39-658"><a href="#cb39-658"></a>time steps)</span>
<span id="cb39-659"><a href="#cb39-659"></a></span>
<span id="cb39-660"><a href="#cb39-660"></a>auto totalFrames = size_t(0);</span>
<span id="cb39-661"><a href="#cb39-661"></a>auto frameLength = 0.01f;</span>
<span id="cb39-662"><a href="#cb39-662"></a>auto simTime = 0.0f;</span>
<span id="cb39-663"><a href="#cb39-663"></a></span>
<span id="cb39-664"><a href="#cb39-664"></a>// Run 120 Frames</span>
<span id="cb39-665"><a href="#cb39-665"></a>auto simTime120Frames = 1.20f;</span>
<span id="cb39-666"><a href="#cb39-666"></a>for(; totalFrames &lt; 120; totalFrames++)</span>
<span id="cb39-667"><a href="#cb39-667"></a>{</span>
<span id="cb39-668"><a href="#cb39-668"></a>simTime += frameLength;</span>
<span id="cb39-669"><a href="#cb39-669"></a>}</span>
<span id="cb39-670"><a href="#cb39-670"></a></span>
<span id="cb39-671"><a href="#cb39-671"></a><span class="in">```</span></span>
<span id="cb39-672"><a href="#cb39-672"></a><span class="in">auto totalFrames = size_t(0);</span></span>
<span id="cb39-673"><a href="#cb39-673"></a><span class="in">auto frameLength = 0.01f;</span></span>
<span id="cb39-674"><a href="#cb39-674"></a><span class="in">auto simTime = 0.0f;</span></span>
<span id="cb39-675"><a href="#cb39-675"></a><span class="in">```</span></span>
<span id="cb39-676"><a href="#cb39-676"></a><span class="in">```</span></span>
<span id="cb39-677"><a href="#cb39-677"></a><span class="in">// Run 120 Frames</span></span>
<span id="cb39-678"><a href="#cb39-678"></a><span class="in">auto simTime120Frames = 1.20f;</span></span>
<span id="cb39-679"><a href="#cb39-679"></a><span class="in">totalFrames = 120;</span></span>
<span id="cb39-680"><a href="#cb39-680"></a><span class="in">simTime = totalFrames * frameLength;</span></span>
<span id="cb39-681"><a href="#cb39-681"></a><span class="in">```</span></span>
<span id="cb39-682"><a href="#cb39-682"></a><span class="ss">- </span>Delta Time (works for fixed time steps)</span>
<span id="cb39-683"><a href="#cb39-683"></a></span>
<span id="cb39-684"><a href="#cb39-684"></a></span>
<span id="cb39-685"><a href="#cb39-685"></a>Significance Error ‚Äì Simulation Time</span>
<span id="cb39-686"><a href="#cb39-686"></a></span>
<span id="cb39-687"><a href="#cb39-687"></a>Accumulate Time (works for arbitrary time steps)</span>
<span id="cb39-688"><a href="#cb39-688"></a></span>
<span id="cb39-689"><a href="#cb39-689"></a><span class="ss">- </span>1.199999999999999955591079014994 !=</span>
<span id="cb39-690"><a href="#cb39-690"></a>    **1.199999213218688964843750000000**</span>
<span id="cb39-691"><a href="#cb39-691"></a>    (0.000000786781310990747329014994)</span>
<span id="cb39-692"><a href="#cb39-692"></a><span class="ss">- </span>12.000000000000000000000000000000 !=</span>
<span id="cb39-693"><a href="#cb39-693"></a>    **12.000179290771484375000000000000** (-</span>
<span id="cb39-694"><a href="#cb39-694"></a>    0.000179290771484375000000000000)</span>
<span id="cb39-695"><a href="#cb39-695"></a><span class="ss">- </span>120.000000000000000000000000000000 !=</span>
<span id="cb39-696"><a href="#cb39-696"></a>    **120.007225036621093750000000000000** (-</span>
<span id="cb39-697"><a href="#cb39-697"></a>    0.007225036621093750000000000000)</span>
<span id="cb39-698"><a href="#cb39-698"></a><span class="ss">- </span>600.000000000000000000000000000000 !=</span>
<span id="cb39-699"><a href="#cb39-699"></a>    **600.274414062500000000000000000000** (-</span>
<span id="cb39-700"><a href="#cb39-700"></a>    0.274414062500000000000000000000)</span>
<span id="cb39-701"><a href="#cb39-701"></a><span class="ss">- </span>3600.000000000000000000000000000000 !=</span>
<span id="cb39-702"><a href="#cb39-702"></a>    **3603.204101562500000000000000000000** (-</span>
<span id="cb39-703"><a href="#cb39-703"></a>    3.204101562500000000000000000000)</span>
<span id="cb39-704"><a href="#cb39-704"></a></span>
<span id="cb39-705"><a href="#cb39-705"></a>Delta Time (works for fixed time steps)</span>
<span id="cb39-706"><a href="#cb39-706"></a></span>
<span id="cb39-707"><a href="#cb39-707"></a><span class="ss">- </span>1.200000047683715820312500000000 !=</span>
<span id="cb39-708"><a href="#cb39-708"></a>    **1.199999928474426269531250000000**</span>
<span id="cb39-709"><a href="#cb39-709"></a>    (0.000000119209289550781250000000)</span>
<span id="cb39-710"><a href="#cb39-710"></a><span class="ss">- </span>12.000000000000000000000000000000 ==</span>
<span id="cb39-711"><a href="#cb39-711"></a>    **12.000000000000000000000000000000**</span>
<span id="cb39-712"><a href="#cb39-712"></a>    (0.000000000000000000000000000000)</span>
<span id="cb39-713"><a href="#cb39-713"></a><span class="ss">- </span>120.000000000000000000000000000000 ==</span>
<span id="cb39-714"><a href="#cb39-714"></a>    **120.000000000000000000000000000000**</span>
<span id="cb39-715"><a href="#cb39-715"></a>    (0.000000000000000000000000000000)</span>
<span id="cb39-716"><a href="#cb39-716"></a><span class="ss">- </span>600.000000000000000000000000000000 ==</span>
<span id="cb39-717"><a href="#cb39-717"></a>    **600.000000000000000000000000000000**</span>
<span id="cb39-718"><a href="#cb39-718"></a>    (0.000000000000000000000000000000)</span>
<span id="cb39-719"><a href="#cb39-719"></a><span class="ss">- </span>-3600.000000000000000000000000000000 ==</span>
<span id="cb39-720"><a href="#cb39-720"></a>    **3600.000000000000000000000000000000**</span>
<span id="cb39-721"><a href="#cb39-721"></a>    (0.000000000000000000000000000000)</span>
<span id="cb39-722"><a href="#cb39-722"></a></span>
<span id="cb39-723"><a href="#cb39-723"></a></span>
<span id="cb39-724"><a href="#cb39-724"></a>Significance Error ‚Äì Simulation Time</span>
<span id="cb39-725"><a href="#cb39-725"></a></span>
<span id="cb39-726"><a href="#cb39-726"></a><span class="ss">- </span>"Sub-Microsecond Precision"</span>
<span id="cb39-727"><a href="#cb39-727"></a><span class="ss">    - </span>1.2345e-6 seconds per frame (810044.5 Hz)</span>
<span id="cb39-728"><a href="#cb39-728"></a></span>
<span id="cb39-729"><a href="#cb39-729"></a></span>
<span id="cb39-730"><a href="#cb39-730"></a>Significance Error ‚Äì Simulation Time</span>
<span id="cb39-731"><a href="#cb39-731"></a></span>
<span id="cb39-732"><a href="#cb39-732"></a><span class="ss">- </span>"Sub-Microsecond Precision"</span>
<span id="cb39-733"><a href="#cb39-733"></a><span class="ss">    - </span>1.2345e-6 seconds per frame (810044.5 Hz)</span>
<span id="cb39-734"><a href="#cb39-734"></a></span>
<span id="cb39-735"><a href="#cb39-735"></a><span class="fu">### 0.012345000170171261000000000000 !=</span></span>
<span id="cb39-736"><a href="#cb39-736"></a></span>
<span id="cb39-737"><a href="#cb39-737"></a><span class="fu">### 0.0148140005767345430</span></span>
<span id="cb39-738"><a href="#cb39-738"></a></span>
<span id="cb39-739"><a href="#cb39-739"></a><span class="fu">### (-0.002469000406563282000000000000)</span></span>
<span id="cb39-740"><a href="#cb39-740"></a></span>
<span id="cb39-741"><a href="#cb39-741"></a><span class="fu">### 12.345000267028809000000000000000 !=</span></span>
<span id="cb39-742"><a href="#cb39-742"></a></span>
<span id="cb39-743"><a href="#cb39-743"></a><span class="fu">### 11.701118469238281000000000000000</span></span>
<span id="cb39-744"><a href="#cb39-744"></a></span>
<span id="cb39-745"><a href="#cb39-745"></a><span class="fu">### (0.643881797790527340000000000000)</span></span>
<span id="cb39-746"><a href="#cb39-746"></a></span>
<span id="cb39-747"><a href="#cb39-747"></a></span>
<span id="cb39-748"><a href="#cb39-748"></a>Significance Error ‚Äì Don‚Äôt use IEEE Floats?</span>
<span id="cb39-749"><a href="#cb39-749"></a></span>
<span id="cb39-750"><a href="#cb39-750"></a><span class="ss">- </span>Use integers</span>
<span id="cb39-751"><a href="#cb39-751"></a><span class="ss">    - </span>Very fast</span>
<span id="cb39-752"><a href="#cb39-752"></a><span class="ss">    - </span>Trade more precision for less range</span>
<span id="cb39-753"><a href="#cb39-753"></a><span class="ss">    - </span>Only input/output may be impacted by floating point conversions</span>
<span id="cb39-754"><a href="#cb39-754"></a><span class="ss">    - </span>Financial applications represent dollars as only cents or tenth‚Äôs of cents</span>
<span id="cb39-755"><a href="#cb39-755"></a><span class="ss">- </span>Use a math library</span>
<span id="cb39-756"><a href="#cb39-756"></a><span class="ss">    - </span>Slower</span>
<span id="cb39-757"><a href="#cb39-757"></a><span class="ss">    - </span>Define your own level of accuracy</span>
<span id="cb39-758"><a href="#cb39-758"></a><span class="ss">    - </span>MPFR (w/C++ Wrapper), TTMath, Boost, GMP C++</span>
<span id="cb39-759"><a href="#cb39-759"></a><span class="ss">    - </span>CRlibm(Correctly Rounded Mathematical Library)</span>
<span id="cb39-760"><a href="#cb39-760"></a></span>
<span id="cb39-761"><a href="#cb39-761"></a>(Store simTimeas uint64_tand get microsecond precision for 584555 years.)</span>
<span id="cb39-762"><a href="#cb39-762"></a></span>
<span id="cb39-763"><a href="#cb39-763"></a></span>
<span id="cb39-764"><a href="#cb39-764"></a>Algebraic Assumption Error</span>
<span id="cb39-765"><a href="#cb39-765"></a></span>
<span id="cb39-766"><a href="#cb39-766"></a><span class="ss">- </span>Mathematical Identities</span>
<span id="cb39-767"><a href="#cb39-767"></a><span class="ss">    - </span>Traditional identities (associative, commutative, distributive) do not hold</span>
<span id="cb39-768"><a href="#cb39-768"></a><span class="ss">- </span>Distributive Rule does not apply: ùë• √óùë¶ ‚àíùë• √ó ùëß ‚â† ùë• (ùë¶ ‚àíùëß)</span>
<span id="cb39-769"><a href="#cb39-769"></a><span class="ss">- </span>Associative Rule does not apply: ùë• + ùë¶ +ùëß ‚â† ùë• +ùë¶ +ùëß</span>
<span id="cb39-770"><a href="#cb39-770"></a><span class="ss">- </span>Cannot interchange division and multiplication:</span>
<span id="cb39-771"><a href="#cb39-771"></a></span>
<span id="cb39-772"><a href="#cb39-772"></a><span class="fu">### ùë•</span></span>
<span id="cb39-773"><a href="#cb39-773"></a></span>
<span id="cb39-774"><a href="#cb39-774"></a><span class="fu">### 10. 0</span></span>
<span id="cb39-775"><a href="#cb39-775"></a></span>
<span id="cb39-776"><a href="#cb39-776"></a>‚â† ùë• √ó 0. 1</span>
<span id="cb39-777"><a href="#cb39-777"></a></span>
<span id="cb39-778"><a href="#cb39-778"></a>Does a na√Øve compiler make these assumptions too?</span>
<span id="cb39-779"><a href="#cb39-779"></a></span>
<span id="cb39-780"><a href="#cb39-780"></a>https://msdn.microsoft.com/library/aa289157.aspx</span>
<span id="cb39-781"><a href="#cb39-781"></a></span>
<span id="cb39-782"><a href="#cb39-782"></a></span>
<span id="cb39-783"><a href="#cb39-783"></a>Algebraic Assumption Error</span>
<span id="cb39-784"><a href="#cb39-784"></a></span>
<span id="cb39-785"><a href="#cb39-785"></a><span class="in">```</span></span>
<span id="cb39-786"><a href="#cb39-786"></a><span class="in">const auto oneRadian = 0.15915494309f;</span></span>
<span id="cb39-787"><a href="#cb39-787"></a><span class="in">const auto control = 0.000000000015915494309f;</span></span>
<span id="cb39-788"><a href="#cb39-788"></a><span class="in">```</span></span>
<span id="cb39-789"><a href="#cb39-789"></a><span class="in">```</span></span>
<span id="cb39-790"><a href="#cb39-790"></a><span class="in">const auto oneRadianMultiplied = oneRadian * 1.0e-10f;</span></span>
<span id="cb39-791"><a href="#cb39-791"></a><span class="in">const auto oneRadianDivided = oneRadian / 1.0e10f;</span></span>
<span id="cb39-792"><a href="#cb39-792"></a><span class="in">```</span></span>
<span id="cb39-793"><a href="#cb39-793"></a></span>
<span id="cb39-794"><a href="#cb39-794"></a>Algebraic Assumption Error</span>
<span id="cb39-795"><a href="#cb39-795"></a></span>
<span id="cb39-796"><a href="#cb39-796"></a><span class="in">```</span></span>
<span id="cb39-797"><a href="#cb39-797"></a><span class="in">const auto oneRadian = 0.15915494309f;</span></span>
<span id="cb39-798"><a href="#cb39-798"></a><span class="in">const auto control = 0.000000000015915494309f;</span></span>
<span id="cb39-799"><a href="#cb39-799"></a><span class="in">```</span></span>
<span id="cb39-800"><a href="#cb39-800"></a><span class="in">```</span></span>
<span id="cb39-801"><a href="#cb39-801"></a><span class="in">const auto oneRadianMultiplied = oneRadian * 1.0e-10f;</span></span>
<span id="cb39-802"><a href="#cb39-802"></a><span class="in">const auto oneRadianDivided = oneRadian / 1.0e10f;</span></span>
<span id="cb39-803"><a href="#cb39-803"></a><span class="in">```</span></span>
<span id="cb39-804"><a href="#cb39-804"></a>Control: 0.000000000015915494616658421000</span>
<span id="cb39-805"><a href="#cb39-805"></a>x*1.0e-10f: 0.000000000015915494616658421000(0.000000000000000000000000000000)</span>
<span id="cb39-806"><a href="#cb39-806"></a>x/1.0e10f: 0.00000000001591549 2881934945000 (0.000000000000000001734723475977)</span>
<span id="cb39-807"><a href="#cb39-807"></a>Relative Error: 0.000000108995891423546710000000</span>
<span id="cb39-808"><a href="#cb39-808"></a></span>
<span id="cb39-809"><a href="#cb39-809"></a></span>
<span id="cb39-810"><a href="#cb39-810"></a>Floating Point Exceptions</span>
<span id="cb39-811"><a href="#cb39-811"></a></span>
<span id="cb39-812"><a href="#cb39-812"></a><span class="ss">- </span>Enable floating point exceptions to be alerted when things go awry.</span>
<span id="cb39-813"><a href="#cb39-813"></a></span>
<span id="cb39-814"><a href="#cb39-814"></a><span class="in">```</span></span>
<span id="cb39-815"><a href="#cb39-815"></a><span class="in">ùë•is the exact result of the operation</span></span>
<span id="cb39-816"><a href="#cb39-816"></a><span class="in">Œ±= 192 for single precision, 1536 for double</span></span>
<span id="cb39-817"><a href="#cb39-817"></a><span class="in">ùë•ùëöùëéùë•= 1. 111 ... 111 √ó 2 ùëíùëöùëñùëõ.</span></span>
<span id="cb39-818"><a href="#cb39-818"></a><span class="in">See &lt;cfenv&gt; -Floating Point Environment</span></span>
<span id="cb39-819"><a href="#cb39-819"></a><span class="in">```</span></span>
<span id="cb39-820"><a href="#cb39-820"></a>IEEE 754 Exception Result when traps disabled Argument to trap handler</span>
<span id="cb39-821"><a href="#cb39-821"></a></span>
<span id="cb39-822"><a href="#cb39-822"></a>overflow ¬±‚àû or ¬±ùë•ùëöùëéùë• round(ùë• 2 ‚àíùõº)</span>
<span id="cb39-823"><a href="#cb39-823"></a></span>
<span id="cb39-824"><a href="#cb39-824"></a>underflow 0, 2 ùëíùëöùëñùëõor denormalized round(ùë• 2 ùõº)</span>
<span id="cb39-825"><a href="#cb39-825"></a></span>
<span id="cb39-826"><a href="#cb39-826"></a>divide by zero ¬±‚àû invalid operation</span>
<span id="cb39-827"><a href="#cb39-827"></a></span>
<span id="cb39-828"><a href="#cb39-828"></a>invalid NaN invalid operation</span>
<span id="cb39-829"><a href="#cb39-829"></a></span>
<span id="cb39-830"><a href="#cb39-830"></a>inexact round( _x_ ) round( _x_ )</span>
<span id="cb39-831"><a href="#cb39-831"></a></span>
<span id="cb39-832"><a href="#cb39-832"></a></span>
<span id="cb39-833"><a href="#cb39-833"></a>But Wait! There‚Äôs More!</span>
<span id="cb39-834"><a href="#cb39-834"></a></span>
<span id="cb39-835"><a href="#cb39-835"></a><span class="ss">- </span>Binary to Decimal Conversion Error</span>
<span id="cb39-836"><a href="#cb39-836"></a><span class="ss">- </span>Summation Error</span>
<span id="cb39-837"><a href="#cb39-837"></a><span class="ss">- </span>Propagation Error</span>
<span id="cb39-838"><a href="#cb39-838"></a><span class="ss">- </span>Underflow, Overflow</span>
<span id="cb39-839"><a href="#cb39-839"></a><span class="ss">- </span>Type Narrowing/Widening Rules</span>
<span id="cb39-840"><a href="#cb39-840"></a></span>
<span id="cb39-841"><a href="#cb39-841"></a></span>
<span id="cb39-842"><a href="#cb39-842"></a>Miscellaneous Notes</span>
<span id="cb39-843"><a href="#cb39-843"></a></span>
<span id="cb39-844"><a href="#cb39-844"></a><span class="co">[</span><span class="ot">http://preshing.com/images/float-point-perf.png</span><span class="co">](http://preshing.com/images/float-point-perf.png)</span></span>
<span id="cb39-845"><a href="#cb39-845"></a>https://github.com/DigitalInBlue/CPPCon2015</span>
<span id="cb39-846"><a href="#cb39-846"></a></span>
<span id="cb39-847"><a href="#cb39-847"></a></span>
<span id="cb39-848"><a href="#cb39-848"></a>Use Your Compiler‚Äôs Output</span>
<span id="cb39-849"><a href="#cb39-849"></a></span>
<span id="cb39-850"><a href="#cb39-850"></a><span class="ss">- </span>warning C4244: ‚Äòinitializing‚Äô : conversion from ‚Äòdouble‚Äô to</span>
<span id="cb39-851"><a href="#cb39-851"></a></span>
<span id="cb39-852"><a href="#cb39-852"></a>‚Äòfloat‚Äô, possible loss of data</span>
<span id="cb39-853"><a href="#cb39-853"></a></span>
<span id="cb39-854"><a href="#cb39-854"></a><span class="ss">- </span>warning C4056: overflow in floating point constant arithmetic</span>
<span id="cb39-855"><a href="#cb39-855"></a><span class="ss">- </span>warning C4305: 'identifier' : truncation from 'type1' to</span>
<span id="cb39-856"><a href="#cb39-856"></a></span>
<span id="cb39-857"><a href="#cb39-857"></a>'type2'</span>
<span id="cb39-858"><a href="#cb39-858"></a></span>
<span id="cb39-859"><a href="#cb39-859"></a><span class="ss">- </span>warning: conversion to 'float' from 'int' may alter its value</span>
<span id="cb39-860"><a href="#cb39-860"></a><span class="ss">- </span>warning: floating constant exceeds range of ‚Äòdouble‚Äô</span>
<span id="cb39-861"><a href="#cb39-861"></a></span>
<span id="cb39-862"><a href="#cb39-862"></a></span>
<span id="cb39-863"><a href="#cb39-863"></a>Fused Multiply-Add (FMA)</span>
<span id="cb39-864"><a href="#cb39-864"></a></span>
<span id="cb39-865"><a href="#cb39-865"></a><span class="ss">- </span>a = a + (b * c); a += b * c;</span>
<span id="cb39-866"><a href="#cb39-866"></a><span class="ss">- </span>Multiplier-accumulator (MAC Unit)</span>
<span id="cb39-867"><a href="#cb39-867"></a><span class="ss">- </span>One rounding</span>
<span id="cb39-868"><a href="#cb39-868"></a><span class="ss">- </span>Compiler Options</span>
<span id="cb39-869"><a href="#cb39-869"></a><span class="ss">    - </span>GCC = -mfma</span>
<span id="cb39-870"><a href="#cb39-870"></a><span class="ss">    - </span>VC++ = #pragma fp_contract (off)</span>
<span id="cb39-871"><a href="#cb39-871"></a><span class="ss">- </span>Reference: FMA3, FMA4</span>
<span id="cb39-872"><a href="#cb39-872"></a><span class="ss">    - </span><span class="co">[</span><span class="ot">http://en.wikipedia.org/wiki/FMA_instruction_set</span><span class="co">](http://en.wikipedia.org/wiki/FMA_instruction_set)</span></span>
<span id="cb39-873"><a href="#cb39-873"></a></span>
<span id="cb39-874"><a href="#cb39-874"></a></span>
<span id="cb39-875"><a href="#cb39-875"></a>Streaming SIMD Extensions (SSE)</span>
<span id="cb39-876"><a href="#cb39-876"></a></span>
<span id="cb39-877"><a href="#cb39-877"></a><span class="ss">- </span>SSE can provide significant performance gains</span>
<span id="cb39-878"><a href="#cb39-878"></a><span class="ss">    - </span>Supports integer, floating point, logical, conversion, shift, and shuffle operations</span>
<span id="cb39-879"><a href="#cb39-879"></a><span class="ss">- </span>C, C++, Fortran do not natively support SSE, but compiler-specific support exists</span>
<span id="cb39-880"><a href="#cb39-880"></a></span>
<span id="cb39-881"><a href="#cb39-881"></a></span>
<span id="cb39-882"><a href="#cb39-882"></a>Float Tricks</span>
<span id="cb39-883"><a href="#cb39-883"></a></span>
<span id="cb39-884"><a href="#cb39-884"></a><span class="in">```</span></span>
<span id="cb39-885"><a href="#cb39-885"></a><span class="in">/// Fast reciprocal square root approximation for x &gt; 0.25</span></span>
<span id="cb39-886"><a href="#cb39-886"></a><span class="in">/// Quake‚Äôs float Q_rsqrt(float number) is much more entertaining.</span></span>
<span id="cb39-887"><a href="#cb39-887"></a><span class="in">inline float FastInvSqrt(float x)</span></span>
<span id="cb39-888"><a href="#cb39-888"></a><span class="in">{</span></span>
<span id="cb39-889"><a href="#cb39-889"></a><span class="in">int tmp = ((0x3f800000 &lt;&lt; 1) + 0x3f800000 - *(long*)&amp;x) &gt;&gt; 1;</span></span>
<span id="cb39-890"><a href="#cb39-890"></a><span class="in">auto y = *(float*)&amp;tmp;</span></span>
<span id="cb39-891"><a href="#cb39-891"></a><span class="in">return y * (1.47f ‚Äì 0.47f * x * y * y);</span></span>
<span id="cb39-892"><a href="#cb39-892"></a><span class="in">}</span></span>
<span id="cb39-893"><a href="#cb39-893"></a><span class="in">```</span></span>
<span id="cb39-894"><a href="#cb39-894"></a></span>
<span id="cb39-895"><a href="#cb39-895"></a>Testing</span>
<span id="cb39-896"><a href="#cb39-896"></a></span>
<span id="cb39-897"><a href="#cb39-897"></a><span class="ss">- </span>Design for Numerical Stability</span>
<span id="cb39-898"><a href="#cb39-898"></a><span class="ss">- </span>Perform Meaningful Testing</span>
<span id="cb39-899"><a href="#cb39-899"></a><span class="ss">- </span>Document assumptions</span>
<span id="cb39-900"><a href="#cb39-900"></a><span class="ss">- </span>Track sources of approximation</span>
<span id="cb39-901"><a href="#cb39-901"></a><span class="ss">- </span>Quantify goodness</span>
<span id="cb39-902"><a href="#cb39-902"></a><span class="ss">    - </span>Well conditioned algorithms</span>
<span id="cb39-903"><a href="#cb39-903"></a><span class="ss">- </span>Backward error analysis</span>
<span id="cb39-904"><a href="#cb39-904"></a><span class="ss">    - </span>Are the outputs identical for slightly</span>
<span id="cb39-905"><a href="#cb39-905"></a>       modified inputs?</span>
<span id="cb39-906"><a href="#cb39-906"></a></span>
<span id="cb39-907"><a href="#cb39-907"></a><span class="in">```</span></span>
<span id="cb39-908"><a href="#cb39-908"></a><span class="in">TEST(CPPCon2015, pointOnePlusPointTwo)</span></span>
<span id="cb39-909"><a href="#cb39-909"></a><span class="in">{</span></span>
<span id="cb39-910"><a href="#cb39-910"></a><span class="in">auto zeroPointOne = 0.1f;</span></span>
<span id="cb39-911"><a href="#cb39-911"></a><span class="in">auto zeroPointTwo = 0.2f;</span></span>
<span id="cb39-912"><a href="#cb39-912"></a><span class="in">auto zeroPointThree = 0.3f;</span></span>
<span id="cb39-913"><a href="#cb39-913"></a><span class="in">auto sum = zeroPointOne + zeroPointTwo;</span></span>
<span id="cb39-914"><a href="#cb39-914"></a><span class="in">```</span></span>
<span id="cb39-915"><a href="#cb39-915"></a><span class="in">```</span></span>
<span id="cb39-916"><a href="#cb39-916"></a><span class="in">EXPECT_DOUBLE_EQ(0.3f, zeroPointThree);</span></span>
<span id="cb39-917"><a href="#cb39-917"></a><span class="in">EXPECT_EQ(0.3f, zeroPointThree);</span></span>
<span id="cb39-918"><a href="#cb39-918"></a><span class="in">EXPECT_EQ(0.3f, sum);</span></span>
<span id="cb39-919"><a href="#cb39-919"></a><span class="in">```</span></span>
<span id="cb39-920"><a href="#cb39-920"></a><span class="in">```</span></span>
<span id="cb39-921"><a href="#cb39-921"></a><span class="in">EXPECT_EQ(zeroPointThree, sum);</span></span>
<span id="cb39-922"><a href="#cb39-922"></a><span class="in">EXPECT_DOUBLE_EQ(zeroPointThree, sum);</span></span>
<span id="cb39-923"><a href="#cb39-923"></a><span class="in">}</span></span>
<span id="cb39-924"><a href="#cb39-924"></a><span class="in">```</span></span>
<span id="cb39-925"><a href="#cb39-925"></a></span>
<span id="cb39-926"><a href="#cb39-926"></a><span class="co">[</span><span class="ot">http://xkcd.com/217/</span><span class="co">](http://xkcd.com/217/)</span></span>
<span id="cb39-927"><a href="#cb39-927"></a><span class="co">[</span><span class="ot">http://www.explainxkcd.com/wiki/index.php/217:_e_to_the_pi_Minus_pi</span><span class="co">](http://www.explainxkcd.com/wiki/index.php/217:_e_to_the_pi_Minus_pi)</span></span>
<span id="cb39-928"><a href="#cb39-928"></a></span>
<span id="cb39-929"><a href="#cb39-929"></a><span class="in">```</span></span>
<span id="cb39-930"><a href="#cb39-930"></a><span class="in">https://github.com/DigitalInBlue/CPPCon2015</span></span>
<span id="cb39-931"><a href="#cb39-931"></a><span class="in">```</span></span>
<span id="cb39-932"><a href="#cb39-932"></a></span>
<span id="cb39-933"><a href="#cb39-933"></a><span class="fu"># Demystifying Floating Point</span></span>
<span id="cb39-934"><a href="#cb39-934"></a></span>
<span id="cb39-935"><a href="#cb39-935"></a>John Farrier, Booz Allen Hamilton</span>
<span id="cb39-936"><a href="#cb39-936"></a></span>
<span id="cb39-937"><a href="#cb39-937"></a><span class="in">```</span></span>
<span id="cb39-938"><a href="#cb39-938"></a><span class="in">https://github.com/DigitalInBlue/CPPCon2015</span></span>
<span id="cb39-939"><a href="#cb39-939"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>