<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Calvin">

<title>IEEE 754 – Systems in Rust</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./51_f16.html" rel="next">
<link href="./42_sha512.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-a4a11d514c7d463668e07712114998e6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70c9a4798e5f6abb0636bcdc3eed0e90.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./50_754.html">IEEE 754</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Systems in Rust</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_welcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_rustup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rustup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_hiworld.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hi world</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Packages</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_hicargo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hi cargo</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Options</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_guess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guess</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_wordle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wordle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_bits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_hamming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hamming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_macros.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Macros</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./40_sha2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SHA-2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41_constants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Constants</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42_sha512.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SHA-512</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_754.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">IEEE 754</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./51_f16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">f16</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./70_numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numbers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./71_ix_io.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numerical I/O</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./72_ix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./80_eddsa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EdDSA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./81_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./82_ed25519.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ed25519</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90_stack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stack</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#announcements" id="toc-announcements" class="nav-link active" data-scroll-target="#announcements">Announcements</a></li>
  <li><a href="#today" id="toc-today" class="nav-link" data-scroll-target="#today">Today</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  <li><a href="#mission-statement" id="toc-mission-statement" class="nav-link" data-scroll-target="#mission-statement">Mission Statement</a></li>
  <li><a href="#common-fallacies" id="toc-common-fallacies" class="nav-link" data-scroll-target="#common-fallacies">Common Fallacies</a></li>
  <li><a href="#common-fallacies-2.0" id="toc-common-fallacies-2.0" class="nav-link" data-scroll-target="#common-fallacies-2.0">Common Fallacies 2.0</a></li>
  <li><a href="#anatomy-of-ieee-floats" id="toc-anatomy-of-ieee-floats" class="nav-link" data-scroll-target="#anatomy-of-ieee-floats">Anatomy of IEEE Floats</a></li>
  <li><a href="#ieee-float-specification" id="toc-ieee-float-specification" class="nav-link" data-scroll-target="#ieee-float-specification">IEEE Float Specification</a></li>
  <li><a href="#assurances" id="toc-assurances" class="nav-link" data-scroll-target="#assurances">Assurances</a></li>
  <li><a href="#assurances-2.0" id="toc-assurances-2.0" class="nav-link" data-scroll-target="#assurances-2.0">Assurances 2.0</a></li>
  <li><a href="#ieee-float-specification-1" id="toc-ieee-float-specification-1" class="nav-link" data-scroll-target="#ieee-float-specification-1">IEEE Float Specification</a></li>
  <li><a href="#aside-scientific-notation" id="toc-aside-scientific-notation" class="nav-link" data-scroll-target="#aside-scientific-notation">Aside: Scientific Notation</a></li>
  <li><a href="#aside-explanation" id="toc-aside-explanation" class="nav-link" data-scroll-target="#aside-explanation">Aside: Explanation</a></li>
  <li><a href="#aside-physical-examples" id="toc-aside-physical-examples" class="nav-link" data-scroll-target="#aside-physical-examples">Aside: Physical Examples</a></li>
  <li><a href="#aside-economic-examples" id="toc-aside-economic-examples" class="nav-link" data-scroll-target="#aside-economic-examples">Aside: Economic Examples</a></li>
  <li><a href="#ieee-layout" id="toc-ieee-layout" class="nav-link" data-scroll-target="#ieee-layout">IEEE Layout</a></li>
  <li><a href="#with-binary" id="toc-with-binary" class="nav-link" data-scroll-target="#with-binary">With Binary</a></li>
  <li><a href="#singles-and-doubles" id="toc-singles-and-doubles" class="nav-link" data-scroll-target="#singles-and-doubles">Singles and Doubles</a></li>
  <li><a href="#understanding-check" id="toc-understanding-check" class="nav-link" data-scroll-target="#understanding-check">Understanding check</a></li>
  <li><a href="#special-floats---nan" id="toc-special-floats---nan" class="nav-link" data-scroll-target="#special-floats---nan">Special Floats - NaN</a></li>
  <li><a href="#special-floats---inf" id="toc-special-floats---inf" class="nav-link" data-scroll-target="#special-floats---inf">Special Floats - inf</a></li>
  <li><a href="#infinity-is-signed" id="toc-infinity-is-signed" class="nav-link" data-scroll-target="#infinity-is-signed">Infinity is signed</a></li>
  <li><a href="#signed-zero" id="toc-signed-zero" class="nav-link" data-scroll-target="#signed-zero">Signed Zero</a></li>
  <li><a href="#simple-example" id="toc-simple-example" class="nav-link" data-scroll-target="#simple-example">Simple Example</a></li>
  <li><a href="#simple-example-1" id="toc-simple-example-1" class="nav-link" data-scroll-target="#simple-example-1">Simple Example</a></li>
  <li><a href="#storage-of-1." id="toc-storage-of-1." class="nav-link" data-scroll-target="#storage-of-1.">Storage of 1.</a></li>
  <li><a href="#except" id="toc-except" class="nav-link" data-scroll-target="#except">Except…</a></li>
  <li><a href="#shift-127" id="toc-shift-127" class="nav-link" data-scroll-target="#shift-127">Shift 127</a></li>
  <li><a href="#breakdown" id="toc-breakdown" class="nav-link" data-scroll-target="#breakdown">Breakdown</a></li>
  <li><a href="#how-precise" id="toc-how-precise" class="nav-link" data-scroll-target="#how-precise">How precise?</a></li>
  <li><a href="#epsilon" id="toc-epsilon" class="nav-link" data-scroll-target="#epsilon">“Epsilon”</a></li>
  <li><a href="#easier-sig-figs" id="toc-easier-sig-figs" class="nav-link" data-scroll-target="#easier-sig-figs">Easier: “Sig figs”</a></li>
  <li><a href="#sig-figs" id="toc-sig-figs" class="nav-link" data-scroll-target="#sig-figs">Sig figs</a></li>
  <li><a href="#small-values" id="toc-small-values" class="nav-link" data-scroll-target="#small-values">Small Values</a></li>
  <li><a href="#test-it" id="toc-test-it" class="nav-link" data-scroll-target="#test-it">Test it</a></li>
  <li><a href="#denormalized-number" id="toc-denormalized-number" class="nav-link" data-scroll-target="#denormalized-number">“Denormalized Number”</a></li>
  <li><a href="#floating-point-precision" id="toc-floating-point-precision" class="nav-link" data-scroll-target="#floating-point-precision">Floating Point Precision</a></li>
  <li><a href="#visually" id="toc-visually" class="nav-link" data-scroll-target="#visually">Visually</a></li>
  <li><a href="#floating-point-precision-1" id="toc-floating-point-precision-1" class="nav-link" data-scroll-target="#floating-point-precision-1">Floating Point Precision</a></li>
  <li><a href="#errors-in-floating-point" id="toc-errors-in-floating-point" class="nav-link" data-scroll-target="#errors-in-floating-point">Errors in Floating Point</a></li>
  <li><a href="#measuring-error-ulps" id="toc-measuring-error-ulps" class="nav-link" data-scroll-target="#measuring-error-ulps">Measuring Error: “Ulps”</a></li>
  <li><a href="#haskell" id="toc-haskell" class="nav-link" data-scroll-target="#haskell">Haskell</a></li>
  <li><a href="#generators" id="toc-generators" class="nav-link" data-scroll-target="#generators">Generators</a></li>
  <li><a href="#iterators" id="toc-iterators" class="nav-link" data-scroll-target="#iterators">Iterators</a></li>
  <li><a href="#on-ulps" id="toc-on-ulps" class="nav-link" data-scroll-target="#on-ulps">On “Ulps”</a></li>
  <li><a href="#rounding" id="toc-rounding" class="nav-link" data-scroll-target="#rounding">Rounding</a></li>
  <li><a href="#relative-error" id="toc-relative-error" class="nav-link" data-scroll-target="#relative-error">Relative Error</a>
  <ul class="collapse">
  <li><a href="#rounding-error" id="toc-rounding-error" class="nav-link" data-scroll-target="#rounding-error">Rounding Error</a></li>
  <li><a href="#rounding-error-1" id="toc-rounding-error-1" class="nav-link" data-scroll-target="#rounding-error-1">Rounding Error</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#special-bits" id="toc-special-bits" class="nav-link" data-scroll-target="#special-bits">Special bits</a></li>
  <li><a href="#significance-error" id="toc-significance-error" class="nav-link" data-scroll-target="#significance-error">Significance Error</a></li>
  <li><a href="#write-them" id="toc-write-them" class="nav-link" data-scroll-target="#write-them">Write them</a></li>
  <li><a href="#test-them" id="toc-test-them" class="nav-link" data-scroll-target="#test-them">Test them</a></li>
  <li><a href="#significance-error-1" id="toc-significance-error-1" class="nav-link" data-scroll-target="#significance-error-1">Significance Error</a></li>
  <li><a href="#significance-error-dont-floats" id="toc-significance-error-dont-floats" class="nav-link" data-scroll-target="#significance-error-dont-floats">Significance Error – Don’t floats?</a></li>
  <li><a href="#significance-error-dont-floats-1" id="toc-significance-error-dont-floats-1" class="nav-link" data-scroll-target="#significance-error-dont-floats-1">Significance Error – Don’t floats?</a></li>
  <li><a href="#significance-error-dont-floats-2" id="toc-significance-error-dont-floats-2" class="nav-link" data-scroll-target="#significance-error-dont-floats-2">Significance Error – Don’t floats?</a></li>
  <li><a href="#significance-error-dont-floats-3" id="toc-significance-error-dont-floats-3" class="nav-link" data-scroll-target="#significance-error-dont-floats-3">Significance Error – Don’t floats?</a></li>
  <li><a href="#algebraic-assumption-error" id="toc-algebraic-assumption-error" class="nav-link" data-scroll-target="#algebraic-assumption-error">Algebraic Assumption Error</a></li>
  <li><a href="#distribution" id="toc-distribution" class="nav-link" data-scroll-target="#distribution">Distribution</a></li>
  <li><a href="#association" id="toc-association" class="nav-link" data-scroll-target="#association">Association</a></li>
  <li><a href="#interchange" id="toc-interchange" class="nav-link" data-scroll-target="#interchange">Interchange</a></li>
  <li><a href="#floating-point-exceptions" id="toc-floating-point-exceptions" class="nav-link" data-scroll-target="#floating-point-exceptions">Floating Point Exceptions</a></li>
  <li><a href="#but-wait-theres-more" id="toc-but-wait-theres-more" class="nav-link" data-scroll-target="#but-wait-theres-more">But Wait! There’s More!</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">Testing</a></li>
  <li><a href="#today-1" id="toc-today-1" class="nav-link" data-scroll-target="#today-1">Today</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="50_754.rjs.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">IEEE 754</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
<p class="subtitle lead">Systems in Rust</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Calvin </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="announcements" class="level2">
<h2 class="anchored" data-anchor-id="announcements">Announcements</h2>
<ul>
<li><strong>Welcome</strong> to Systems in Rust</li>
<li><strong>Action Items</strong>:
<ul>
<li>“SHA-512” is due on next Friday</li>
<li>Lecture on numbers, inspired by the lab, while we wait.</li>
</ul></li>
</ul>
</section>
<section id="today" class="level2">
<h2 class="anchored" data-anchor-id="today">Today</h2>
<ul>
<li>Understand precision through the lens of floats.
<ul>
<li>Understand the basics of floats</li>
<li>Understand the language of floats</li>
<li>Get a feel for when further investigation is required</li>
</ul></li>
</ul>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">Citation</h2>
<ul>
<li>Yoinked</li>
<li><a href="https://github.com/DigitalInBlue/CPPCon2015">url</a></li>
<li>Author John Farrier, Booz Allen Hamilton</li>
</ul>
</section>
<section id="mission-statement" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="mission-statement">Mission Statement</h2>
<ul>
<li>I’m a normal person.
<ul>
<li>I think <code>5/2</code> is <code>2.5</code> or perhaps 2½.</li>
</ul></li>
<li>I’m a scientist.
<ul>
<li>I’m solving “Black-Scholes”</li>
<li><a href="https://numba.pydata.org/numba-examples/examples/finance/blackscholes/results.html">Does anyone know what this is doing?</a> <span class="math display">\[
d_2 = d_1 - \sigma\sqrt{T - t} = \frac{1}{\sigma\sqrt{T - t}}\left[\ln\left(\frac{S_t}{K}\right) + \left(r - q - \frac{1}{2}\sigma^2\right)(T - t)\right]
\]</span></li>
</ul></li>
</ul>
</section>
<section id="common-fallacies" class="level2">
<h2 class="anchored" data-anchor-id="common-fallacies">Common Fallacies</h2>
<ul>
<li>“Floating point numbers are numbers”
<ul>
<li><code>max(count())</code> Pinocchios</li>
</ul></li>
<li>“It’s floating point error”
<ul>
<li>“All floating point involves magical rounding errors”</li>
</ul></li>
<li>“Linux and Windows handle floats differently”</li>
<li>“Floating point represents an interval value near the actual value”</li>
</ul>
</section>
<section id="common-fallacies-2.0" class="level2">
<h2 class="anchored" data-anchor-id="common-fallacies-2.0">Common Fallacies 2.0</h2>
<ul>
<li>“A double (an <code>f64</code>) holds 15 decimal places and I only need 3, so I have nothing to worry about”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>“My programming language does better math than your programming language”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>“Why can’t computers just store whatever number I use”<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ul>
</section>
<section id="anatomy-of-ieee-floats" class="level2">
<h2 class="anchored" data-anchor-id="anatomy-of-ieee-floats">Anatomy of IEEE Floats</h2>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/IEEE754.svg/550px-IEEE754.svg.png" class="img-fluid"></p>
</section>
<section id="ieee-float-specification" class="level2">
<h2 class="anchored" data-anchor-id="ieee-float-specification">IEEE Float Specification</h2>
<ul>
<li>IEEE 754-1985, IEEE 854-1987, IEEE 754-2008
<ul>
<li>These are paywalled.</li>
<li>Those are years.</li>
</ul></li>
<li>Provide for portable, provably consistent math
<ul>
<li>Consistent, not correct.</li>
</ul></li>
</ul>
</section>
<section id="assurances" class="level2">
<h2 class="anchored" data-anchor-id="assurances">Assurances</h2>
<ul>
<li>Ensure some significant mathematical identities hold true:
<ul>
<li><span class="math inline">\(x + y  = y + x\)</span>
<ul>
<li>Symmetry of addition</li>
</ul></li>
<li><span class="math inline">\(x + 0 = x\)</span>
<ul>
<li>Additive identity</li>
</ul></li>
<li><span class="math inline">\(x = y \implies x - y = 0\)</span>
<ul>
<li>Identity under subtraction</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="assurances-2.0" class="level2">
<h2 class="anchored" data-anchor-id="assurances-2.0">Assurances 2.0</h2>
<p><span class="math display">\[
\frac{x}{\sqrt{x^2+y^2}} \leq 1
\]</span></p>
<ul>
<li>What is missing?</li>
</ul>
</section>
<section id="ieee-float-specification-1" class="level2">
<h2 class="anchored" data-anchor-id="ieee-float-specification-1">IEEE Float Specification</h2>
<ul>
<li>Ensure every floating point number is unique</li>
<li>Ensure every floating point number has an opposite
<ul>
<li><em>Zero</em> is a special case because of this</li>
</ul></li>
<li>Specifies algorithms for addition, subtraction, multiplication, division, and square-root
<ul>
<li>Not really operations/relations! They are algorithms.</li>
</ul></li>
</ul>
</section>
<section id="aside-scientific-notation" class="level2">
<h2 class="anchored" data-anchor-id="aside-scientific-notation">Aside: Scientific Notation</h2>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Scientific_notation">Scientific notation is a way of expressing numbers that are too large or too small to be conveniently written in decimal form, since to do so would require writing out an inconveniently long string of digits.</a></p>
</blockquote>
<ul>
<li>In scientific notation, nonzero numbers are written in the form</li>
</ul>
<p><span class="math display">\[a \times 10^b\]</span></p>
</section>
<section id="aside-explanation" class="level2">
<h2 class="anchored" data-anchor-id="aside-explanation">Aside: Explanation</h2>
<ul>
<li>In scientific notation, nonzero numbers are written in the form</li>
</ul>
<p><span class="math display">\[a \times 10^b\]</span></p>
<ul>
<li><span class="math inline">\(a\)</span> (the coefficient or mantissa) is a number greater than or equal to 1 and less than 10 (<span class="math inline">\(1 \le |a| &lt; 10\)</span>).</li>
<li><span class="math inline">\(10\)</span> is the base.</li>
<li><span class="math inline">\(b\)</span> (the exponent) is an integer.</li>
</ul>
</section>
<section id="aside-physical-examples" class="level2">
<h2 class="anchored" data-anchor-id="aside-physical-examples">Aside: Physical Examples</h2>
<ol type="1">
<li><p><strong>Speed of light:</strong> The speed of light in a vacuum is approximately <span class="math inline">\(300,000,000 \text{ m/s}\)</span> <span class="math display">\[
3 \times 10^8 \text{ m/s}
\]</span></p></li>
<li><p><strong>Mass of an electron:</strong> The mass of an electron is approximately <span class="math inline">\(0.00000000000000000000000000091093837 \text{ g}\)</span>. <span class="math display">\[
9.1093837 \times 10^{-28} \text{ g}
\]</span></p></li>
</ol>
</section>
<section id="aside-economic-examples" class="level2">
<h2 class="anchored" data-anchor-id="aside-economic-examples">Aside: Economic Examples</h2>
<ul>
<li>We can use social science numbers.</li>
<li><a href="https://www.newyorkfed.org/research/college-labor-market#--:explore:outcomes-by-major">Labor Market Outcomes of College Graduates by Major</a></li>
<li>Computer Science majors in 2023 have a $80,000 median wage “early career”
<ul>
<li><span class="math inline">\(8.0000 \times 10^4\)</span></li>
</ul></li>
<li>And 6.1% unemployment
<ul>
<li><span class="math inline">\(6.1 \times 10^{-2}\)</span></li>
</ul></li>
</ul>
</section>
<section id="ieee-layout" class="level2">
<h2 class="anchored" data-anchor-id="ieee-layout">IEEE Layout</h2>
<ul>
<li>An approximation using scientific notation
<ul>
<li><span class="math inline">\(x = -1^s \times 2^e \times 1.m\)</span></li>
<li><span class="math inline">\(x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}\)</span>
<ul>
<li>Where the mantissa is the technical term for the the digits after the decimal point.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="with-binary" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="with-binary">With Binary</h2>
<ul>
<li><span class="math inline">\(x = -0b1^{\text{0b0}} \times 0b10^{\text{0b10000000}}  \times 0b1.10010010000111111011011\)</span></li>
<li>Express in memory as the concatenation:
<ul>
<li><code>0b0</code> to <code>0b10000000</code> to <code>0b10010010000111111011011</code></li>
<li><code>01000000010010010000111111011011</code></li>
</ul></li>
</ul>
</section>
<section id="singles-and-doubles" class="level2">
<h2 class="anchored" data-anchor-id="singles-and-doubles">Singles and Doubles</h2>
<ul>
<li>32 - bits = 1 sign bit + 8 exponent bits + 23 mantissa bits
<ul>
<li><code>0b0</code> to <code>0b10000000</code> to <code>0b10010010000111111011011</code></li>
</ul></li>
<li>64 - bits = 1 sign bit + 12 exponent bits + 52 mantissa bits</li>
</ul>
</section>
<section id="understanding-check" class="level2">
<h2 class="anchored" data-anchor-id="understanding-check">Understanding check</h2>
<ul>
<li>What is the probability a <em>real number</em> <span class="math inline">\(a \in \mathbb{R}\)</span> has an exact float representation?</li>
<li>What is the probability an <em>integer</em> <span class="math inline">\(n \in \mathbb{Z}\)</span> has an exact float representation?</li>
<li>What is the probability a <em>course number</em> <span class="math inline">\(n &lt; 600\)</span> has an exact float representation?</li>
</ul>
</section>
<section id="special-floats---nan" class="level2">
<h2 class="anchored" data-anchor-id="special-floats---nan">Special Floats - NaN</h2>
<ul>
<li>Divide by Zero
<ul>
<li>1 / 0</li>
</ul></li>
<li>Not a Number (NaN)</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">1</span>)<span class="op">/</span>f32(<span class="dv">0</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: divide by zero encountered <span class="kw">in</span> scalar divide</span>
<span id="cb1-4"><a href="#cb1-4"></a>np.float32(inf)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span><span class="op">/</span><span class="dv">0</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>Traceback (most recent call last):</span>
<span id="cb1-7"><a href="#cb1-7"></a>  File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="pp">ZeroDivisionError</span>: division by zero</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="special-floats---inf" class="level2">
<h2 class="anchored" data-anchor-id="special-floats---inf">Special Floats - inf</h2>
<ul>
<li>Signed Infinity
<ul>
<li>Overflow protection</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: overflow encountered <span class="kw">in</span> scalar power</span>
<span id="cb2-3"><a href="#cb2-3"></a>np.float32(inf)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">10.0</span> <span class="op">**</span> <span class="dv">10000</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>Traceback (most recent call last):</span>
<span id="cb2-6"><a href="#cb2-6"></a>File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="pp">OverflowError</span>: (<span class="dv">34</span>, <span class="st">'Numerical result out of range'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="infinity-is-signed" class="level2">
<h2 class="anchored" data-anchor-id="infinity-is-signed">Infinity is signed</h2>
<ul>
<li>We can get negative infinity through a variety of means.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span>(f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a>np.float32(<span class="op">-</span>inf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We note that this suppresses the overflow error use <code>()</code></li>
<li>In some languages this is not ever regarded as an overflow error, like Julia (where we have to use larger powers due to the f64 default)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource jl number-lines code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1"></a>julia<span class="op">&gt;</span> <span class="fl">10.0</span><span class="op">^</span><span class="fl">10000</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="cn">Inf</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>julia<span class="op">&gt;</span> <span class="fu">-</span>(<span class="fl">10.0</span><span class="op">^</span><span class="fl">10000</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="op">-</span><span class="cn">Inf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="signed-zero" class="level2">
<h2 class="anchored" data-anchor-id="signed-zero">Signed Zero</h2>
<ul>
<li>Signed Zero
<ul>
<li>Underflow protection, preserves sign</li>
<li><ul>
<li>0 =− 0</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">==</span> (<span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="va">True</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">-</span> <span class="fl">0.0</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="fl">0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>Works in base Python (e.g.&nbsp;don’t need NumPy).</li>
<li>Couldn’t get it to work in Julia actually (went to -inf or NaN)</li>
</ul>
</section>
<section id="simple-example" class="level2">
<h2 class="anchored" data-anchor-id="simple-example">Simple Example</h2>
<ul>
<li>Floating point is great because it will work exactly how you expect.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>More or less.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fl">0.30000000000000004</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-example-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-example-1">Simple Example</h2>
<ul>
<li>We shouldn’t be suprised by this!</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f32(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fl">0.100000001490116119384765625</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fl">0.20000000298023223876953125</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fl">0.300000011920928955078125</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f64(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="fl">0.1000000000000000055511151231257827021181583404541015625</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="fl">0.200000000000000011102230246251565404236316680908203125</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fl">0.299999999999999988897769753748434595763683319091796875</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="storage-of-1." class="level2">
<h2 class="anchored" data-anchor-id="storage-of-1.">Storage of 1.</h2>
<ul>
<li><span class="math inline">\(x = -1^s \times 2^e \times 1.m\)</span></li>
<li><span class="math inline">\(x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}\)</span></li>
<li><span class="math inline">\(x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1 + \text{mantissa} \times \frac{1}{2^n}\)</span></li>
<li><span class="math inline">\(1 = -1^0 \times 2^0 \times (1 + 0 \times \frac{1}{2^n}\)</span></li>
<li>So each of the sign bit, the base, and the mantissa are zero.
<ul>
<li>I should note I was unable to reproduce this in Rust or C.</li>
<li>I’m not really a floating pointer.</li>
</ul></li>
</ul>
</section>
<section id="except" class="level2">
<h2 class="anchored" data-anchor-id="except">Except…</h2>
<ul>
<li>This is actually a little bit fake.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">$</span> cat src<span class="op">/</span>main<span class="op">.</span>rs</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">1.0</span><span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> x<span class="op">.</span>to_bits())<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="op">}</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="op">$</span> cargo run</span>
<span id="cb9-7"><a href="#cb9-7"></a>    Finished `dev` profile [unoptimized <span class="op">+</span> debuginfo] target(s) <span class="kw">in</span> <span class="dv">0</span><span class="op">.</span>00s</span>
<span id="cb9-8"><a href="#cb9-8"></a>     Running `target<span class="op">/</span>debug<span class="op">/</span>bits`</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="dv">00111111100000000000000000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>What is that?</li>
</ul>
</section>
<section id="shift-127" class="level2">
<h2 class="anchored" data-anchor-id="shift-127">Shift 127</h2>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Internal_representation">While the exponent can be positive or negative, in binary formats it is stored as an unsigned number that has a fixed “bias” added to it.</a></p>
</blockquote>
<ul>
<li>The IEEE 754 binary format specifies a hardware implementation of such that the exponent, be it positive or negative, in binary formats is stored as an unsigned number that has a fixed “bias” added to it.</li>
<li>In the case of 32 bit floats, the bias is 127.</li>
</ul>
</section>
<section id="breakdown" class="level2">
<h2 class="anchored" data-anchor-id="breakdown">Breakdown</h2>
<ul>
<li>Take the following:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="ex">00111111100000000000000000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>That is:
<ul>
<li>Sign bit of <code>0</code></li>
<li>Exponent of <code>01111111</code>
<ul>
<li>All zeroes and all ones are reserved for <code>NaN</code>, <code>inf</code>, etc.</li>
</ul></li>
<li>Mantissa of 23 zeroes.</li>
</ul></li>
</ul>
</section>
<section id="how-precise" class="level2">
<h2 class="anchored" data-anchor-id="how-precise">How precise?</h2>
<ul>
<li>I have referred to <code>f32</code> as having “32 bits of precision”.</li>
<li>How much precision is that?</li>
<li>Well, let’s set the least significant bit of the mantissa to one.</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">1.0</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="kw">let</span> <span class="kw">mut</span> b<span class="op">:</span><span class="dt">u32</span> <span class="op">=</span> x<span class="op">.</span>to_bits()<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    b <span class="op">|=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="pp">println!</span>(<span class="st">"{:1.32}"</span><span class="op">,</span> <span class="dt">f32</span><span class="pp">::</span>from_bits(b))<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="epsilon" class="level2">
<h2 class="anchored" data-anchor-id="epsilon">“Epsilon”</h2>
<ul>
<li>What do we get?</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="ex">$</span> cargo run</span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.00s</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>     <span class="ex">Running</span> <span class="kw">`</span><span class="ex">target/debug/bits</span><span class="kw">`</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="ex">00111111100000000000000000000001</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="ex">1.00000011920928955078125000000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We refer to this value (less one) as <a href="https://en.wikipedia.org/wiki/Machine_epsilon">machine epsilon</a>, or perhaps <span class="math inline">\(\varepsilon\)</span>.</li>
<li>The difference between 1.0 and the next available floating point number.</li>
<li>Much lower, of course, with double and quad precision.</li>
</ul>
</section>
<section id="easier-sig-figs" class="level2">
<h2 class="anchored" data-anchor-id="easier-sig-figs">Easier: “Sig figs”</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Format</th>
<th style="text-align: center;">Sign</th>
<th style="text-align: center;">Exp.</th>
<th style="text-align: center;">Mant.</th>
<th style="text-align: center;">Bits</th>
<th style="text-align: center;">Bias</th>
<th style="text-align: center;">Prec.</th>
<th style="text-align: center;">Significance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Half</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;"><strong>3-4</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Single</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">127</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;"><strong>6-9</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Double</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">1023</td>
<td style="text-align: center;">53</td>
<td style="text-align: center;"><strong>15-17</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Quad</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">128</td>
<td style="text-align: center;">16383</td>
<td style="text-align: center;">113</td>
<td style="text-align: center;"><strong>33-36</strong></td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://people.eecs.berkeley.edu/~wkahan/ieee754status/IEEE754.PDF">Prof.&nbsp;Kahan, UCB EECS</a></li>
</ul>
</section>
<section id="sig-figs" class="level2">
<h2 class="anchored" data-anchor-id="sig-figs">Sig figs</h2>
<ul>
<li>IEEE 754 was intended for <em>scientific computing</em></li>
<li>That is, not systems computing, software etc.</li>
<li>Useful to us to think about information and how bits work.</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Significant_figures">Significant figures, also referred to as significant digits, are specific digits within a number that is written in positional notation that carry both reliability and necessity in conveying a particular quantity.</a></p>
</blockquote>
</section>
<section id="small-values" class="level2">
<h2 class="anchored" data-anchor-id="small-values">Small Values</h2>
<ul>
<li>For 32-bit floats, the minimum base 10 exponent is -36.</li>
<li>How is <span class="math inline">\(1.0 \times 10^{-37}\)</span> represented?</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">// In Rust, we may use '0b' prefix for binary representation.</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">// In Rust, we may us underscores within numerical values.</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="dv">0b0_00000000_11011001110001111101110</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="test-it" class="level2">
<h2 class="anchored" data-anchor-id="test-it">Test it</h2>
<ul>
<li>Write a simple test…</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="kw">let</span> b<span class="op">:</span><span class="dt">u32</span> <span class="op">=</span> <span class="dv">0b0_00000000_11011001110001111101110</span><span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="pp">println!</span>(<span class="st">"{:1.100}"</span><span class="op">,</span> <span class="dt">f32</span><span class="pp">::</span>from_bits(b))<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">10.0_f32</span><span class="op">.</span>powf(<span class="op">-</span><span class="dv">38.0_f32</span>)<span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> x<span class="op">.</span>to_bits())<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="pp">println!</span>(<span class="st">"{:1.100}"</span><span class="op">,</span> x)<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Results are as expected.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="denormalized-number" class="level2">
<h2 class="anchored" data-anchor-id="denormalized-number">“Denormalized Number”</h2>
<ul>
<li>Numbers that have a zero exponent</li>
<li>Required when the exponent is below the minimum exponent</li>
<li>Helps prevent underflow</li>
<li>Generally speaking, if you are using one these, the math is about to get wronger than you’d think.</li>
<li>The good (???) language C++ provides a <code>std::nextafter</code> for which Rust crates exist.</li>
</ul>
</section>
<section id="floating-point-precision" class="level2">
<h2 class="anchored" data-anchor-id="floating-point-precision">Floating Point Precision</h2>
<ul>
<li>Representation is not uniform between numbers</li>
<li>Most precision lies between 0.0 and 0.1</li>
<li>Precision falls away</li>
</ul>
</section>
<section id="visually" class="level2">
<h2 class="anchored" data-anchor-id="visually">Visually</h2>
<p><img src="https://dwayneneed.github.io/static/img/2010-05-06-fun-with-floating-point_6bit-float-distribution.png" class="img-fluid"></p>
<ul>
<li><a href="https://dwayneneed.github.io/.net/2010/05/06/fun-with-floating-point.html">Fun with floating point, Dwayne Need</a></li>
</ul>
</section>
<section id="floating-point-precision-1" class="level2">
<h2 class="anchored" data-anchor-id="floating-point-precision-1">Floating Point Precision</h2>
<p>The number of floats from 0.0</p>
<ul>
<li>… to 0.1 = 1,036,831,949</li>
<li>… to 0.2 = 8,388,608</li>
<li>… to 0.4 = 8,388,608</li>
<li>… to 0.8 = 8,388,608</li>
<li>… to 1.6 = 8,388,608</li>
<li>… to 3.2 = 8,388,608</li>
</ul>
</section>
<section id="errors-in-floating-point" class="level2">
<h2 class="anchored" data-anchor-id="errors-in-floating-point">Errors in Floating Point</h2>
<ul>
<li>Storage of <span class="math inline">\(\pi\)</span></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> pi <span class="im">as</span> pi</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># copy paste Wolfram|Alpha</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="op">&gt;&gt;&gt;</span> <span class="ss">f'</span><span class="sc">{</span>pi<span class="sc">:1.100}</span><span class="ss">'</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">'3.141592653589793115997963468544185161590576171875'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>They differ fairly early on!</li>
</ul>
</section>
<section id="measuring-error-ulps" class="level2">
<h2 class="anchored" data-anchor-id="measuring-error-ulps">Measuring Error: “Ulps”</h2>
<ul>
<li>Units in Last Place</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://en.wikipedia.org/wiki/Unit_in_the_last_place">In computer science and numerical analysis, unit in the last place or unit of least precision (ulp) is the spacing between two consecutive floating-point numbers, i.e., the value the least significant digit (rightmost digit) represents if it is 1. It is used as a measure of accuracy in numeric calculations.</a></p>
</blockquote>
</section>
<section id="haskell" class="level2">
<h2 class="anchored" data-anchor-id="haskell">Haskell</h2>
<ul>
<li>Usually ULP is taught using <a href="https://en.wikipedia.org/wiki/Unit_in_the_last_place#Example_1">Haskell</a>.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource haskell number-lines code-with-copy"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1"></a><span class="op">&gt;</span> <span class="fu">until</span> (\x <span class="ot">-&gt;</span> x <span class="op">==</span> x<span class="op">+</span><span class="dv">1</span>) (<span class="op">+</span><span class="dv">1</span>) <span class="dv">0</span><span class="ot"> ::</span> <span class="dt">Float</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fl">1.6777216e7</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="op">&gt;</span> it<span class="op">-</span><span class="dv">1</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="fl">1.6777215e7</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="op">&gt;</span> it<span class="op">+</span><span class="dv">1</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="fl">1.6777216e7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I’ll translate to .py/.rs</li>
</ul>
</section>
<section id="generators" class="level2">
<h2 class="anchored" data-anchor-id="generators">Generators</h2>
<ul>
<li>By convention we check number theoretic results with lazily evaluated generator expressions in Python.</li>
<li>The following generators all powers of two for a which adding one does not change the value within Python floating points.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="im">from</span> itertools <span class="im">import</span> count</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>gen <span class="op">=</span> (i <span class="cf">for</span> i <span class="kw">in</span> count() <span class="cf">if</span> <span class="fl">2.0</span> <span class="op">**</span> <span class="bu">float</span>(i) <span class="op">+</span> <span class="fl">1.0</span> <span class="op">==</span> <span class="fl">2.0</span> <span class="op">**</span> <span class="bu">float</span>(i))</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a>x <span class="op">=</span> <span class="bu">next</span>(gen)</span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="bu">print</span>(<span class="st">'2.0 ** x + 0.0 = '</span>, <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">0.0</span>)</span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="bu">print</span>(<span class="st">'2.0 ** x + 1.0 = '</span>, <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="iterators" class="level2">
<h2 class="anchored" data-anchor-id="iterators">Iterators</h2>
<ul>
<li>Rust doesn’t require iterators, supporting the infinite iterator by default using <code>unwrap</code>.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">let</span> x <span class="op">=</span> (<span class="dv">0</span><span class="op">..</span>)<span class="op">.</span>find(<span class="op">|&amp;</span>i<span class="op">|</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> i) <span class="op">+</span> <span class="dv">1.0</span> <span class="op">==</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> i))<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">let</span> base <span class="op">=</span> <span class="dt">f64</span><span class="pp">::</span>powi(<span class="dv">2.0</span><span class="op">,</span> x)<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4"></a></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">// Prints the result (2^53 = 9007199254740992.0)</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="pp">println!</span>(<span class="st">"2.0 ** x + 0.0 = {:.1}"</span><span class="op">,</span> base)<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="pp">println!</span>(<span class="st">"2.0 ** x + 1.0 = {:.1}"</span><span class="op">,</span> base <span class="op">+</span> <span class="dv">1.0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I haven’t used <code>find</code> before, this is an LLM donation to our knowledge base.</li>
<li>By the way, that is basically <code>2 ** 53</code> and there are 52 bits of mantissa precision.</li>
</ul>
</section>
<section id="on-ulps" class="level2">
<h2 class="anchored" data-anchor-id="on-ulps">On “Ulps”</h2>
<ul>
<li>We can measure error using ULPs.</li>
</ul>
<blockquote class="blockquote">
<p><a href="https://www.cs.berkeley.edu/~wkahan/LOG10HAF.TXT">The gap between the two floating-point numbers nearest to x, even if x is one of )them.</a></p>
</blockquote>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32, pi <span class="im">as</span> pi, float64 <span class="im">as</span> f64</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="op">&gt;&gt;&gt;</span> f64(pi) <span class="op">-</span> f64(f32(pi))</span>
<span id="cb20-3"><a href="#cb20-3"></a>np.float64(<span class="op">-</span><span class="fl">8.742278012618954e-08</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="rounding" class="level2">
<h2 class="anchored" data-anchor-id="rounding">Rounding</h2>
<ul>
<li>We have some guarantees:
<ul>
<li>IEEE 754 requires that that elementary arithmetic operations are correctly rounded to within 0.5 ulps</li>
<li>Transcendental functions are generally rounded to between 0.5 and 1.0 ulps
<ul>
<li>Transcendental as in <span class="math inline">\(\pi\)</span> or <span class="math inline">\(e\)</span></li>
</ul></li>
</ul></li>
<li>~9 ulps</li>
</ul>
</section>
<section id="relative-error" class="level1">
<h1>Relative Error</h1>
<ul>
<li>The difference between the “real” number and the approximated number, divided by the “real” number.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="op">&gt;&gt;&gt;</span> f64(f32(pi))<span class="op">/</span>f64(pi)</span>
<span id="cb21-2"><a href="#cb21-2"></a>np.float64(<span class="fl">1.0000000278275352</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>So for <code>pi</code> in <code>f32</code>, around <span class="math inline">\(2.9 \times 10^{-8}\)</span></li>
</ul>
<section id="rounding-error" class="level2">
<h2 class="anchored" data-anchor-id="rounding-error">Rounding Error</h2>
<ul>
<li>Induced by approximating an infinite range of numbers into a finite number of bits</li>
<li>Rounding is:
<ul>
<li>Towards the nearest</li>
<li>Towards zero</li>
<li>Towards positive infinity (round up)</li>
<li>Towards negative infinity (round down)</li>
</ul></li>
</ul>
</section>
<section id="rounding-error-1" class="level2">
<h2 class="anchored" data-anchor-id="rounding-error-1">Rounding Error</h2>
<ul>
<li>What about rounding the half-way case? (i.e.&nbsp;0.5)
<ul>
<li>Round Up vs.&nbsp;Round Even</li>
</ul></li>
<li>Correct Rounding:
<ul>
<li>Basic operations (add, subtract, multiply, divide, sqrt) should return the number nearest the mathematical result.</li>
<li>If there is a tie, round to the number with an even mantissa</li>
</ul></li>
</ul>
</section>
<section id="implementation" class="level2">
<h2 class="anchored" data-anchor-id="implementation">Implementation</h2>
<ul>
<li>“Guard Bit”, “Round Bit”, “Sticky Bit”</li>
<li>Only used while doing calculations
<ul>
<li>Not stored in the float itself</li>
<li>The mantissa is shifted in calculations to align radix</li>
</ul></li>
<li>The guard bits and round bits are extra precision</li>
<li>The sticky bit is an OR of anything that shifts through it</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1"></a>0_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="special-bits" class="level2">
<h2 class="anchored" data-anchor-id="special-bits">Special bits</h2>
<ul>
<li>“Guard Bit”, “Round Bit”, “Sticky Bit”</li>
<li><strong>[G][R][S]</strong></li>
<li><strong>[0][-][-]</strong> - Round Down (do nothing)</li>
<li><strong>[1][0][0]</strong> - Round Up if the mantissa LSB is 1</li>
<li><strong>[1][0][1]</strong> - Round Up</li>
<li><strong>[1][1][0]</strong> - Round Up</li>
<li><strong>[1][1][1]</strong> - Round Up</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb23-1"><a href="#cb23-1"></a>0_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="significance-error" class="level2">
<h2 class="anchored" data-anchor-id="significance-error">Significance Error</h2>
<ul>
<li>Compute the Area of a Triangle given side lengths</li>
<li><a href="https://en.wikipedia.org/wiki/Heron%27s_formula">Hero(n)’s Formula</a>:
<ul>
<li>Take <span class="math inline">\(s = \frac{1}{2}(a + b + c)\)</span></li>
<li>Then <span class="math inline">\(\sqrt{s(s-a)(s-b)(s-c)}\)</span></li>
</ul></li>
<li><a href="https://people.eecs.berkeley.edu/~wkahan/Triangle.pdf">Kahan’s Algorithm</a>:
<ul>
<li>Take <span class="math inline">\(((a, b, c) | a \leq b \leq c)\)</span></li>
<li>Then <span class="math inline">\(\sqrt{\frac{(x + (y + z)) \times (z - (x - y)) \times (z + (x - y)) \times (x + (y - z))}{4}}\)</span></li>
</ul></li>
</ul>
</section>
<section id="write-them" class="level2">
<h2 class="anchored" data-anchor-id="write-them">Write them</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/lib.rs</strong></pre>
</div>
<div class="sourceCode" id="cb24" data-filename="src/lib.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">fn</span> heron(a<span class="op">:</span><span class="dt">f32</span><span class="op">,</span> b<span class="op">:</span><span class="dt">f32</span><span class="op">,</span> c<span class="op">:</span><span class="dt">f32</span>) <span class="op">-&gt;</span> <span class="dt">f32</span> <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>    <span class="kw">let</span> s <span class="op">=</span> (a <span class="op">+</span> b <span class="op">+</span> c)<span class="op">/</span><span class="dv">2.0_f32</span><span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="cf">return</span> (s <span class="op">*</span> (s <span class="op">-</span> a) <span class="op">*</span> (s <span class="op">-</span> b) <span class="op">*</span> (s <span class="op">-</span> c))<span class="op">.</span>sqrt()<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="op">}</span></span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="kw">fn</span> kahan(a<span class="op">:</span><span class="dt">f32</span><span class="op">,</span> b<span class="op">:</span><span class="dt">f32</span><span class="op">,</span> c<span class="op">:</span><span class="dt">f32</span>) <span class="op">-&gt;</span> <span class="dt">f32</span> <span class="op">{</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="kw">let</span> <span class="kw">mut</span> s <span class="op">=</span> <span class="pp">vec!</span>[a<span class="op">,</span>b<span class="op">,</span>c]<span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>    s<span class="op">.</span>sort_by(<span class="op">|</span>a<span class="op">,</span> b<span class="op">|</span> a<span class="op">.</span>partial_cmp(b)<span class="op">.</span>unwrap())<span class="op">;</span> <span class="co">// "partial"? Why not `.sort`?</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="kw">let</span> <span class="kw">mut</span> prod <span class="op">=</span> s[<span class="dv">0</span>] <span class="op">+</span> s[<span class="dv">1</span>] <span class="op">+</span> s[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>    prod <span class="op">*=</span> s[<span class="dv">2</span>] <span class="op">-</span> (s[<span class="dv">0</span>] <span class="op">-</span> s[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>    prod <span class="op">*=</span> s[<span class="dv">2</span>] <span class="op">+</span> (s[<span class="dv">0</span>] <span class="op">-</span> s[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>    prod <span class="op">*=</span> s[<span class="dv">0</span>] <span class="op">+</span> (s[<span class="dv">1</span>] <span class="op">-</span> s[<span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb24-13"><a href="#cb24-13"></a>    <span class="cf">return</span> prod<span class="op">.</span>sqrt() <span class="op">/</span> <span class="dv">4.0</span><span class="op">;</span></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-them" class="level2">
<h2 class="anchored" data-anchor-id="test-them">Test them</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb25" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">fn</span> main()<span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="pp">dbg!</span>(heron(<span class="dv">3.0</span><span class="op">,</span><span class="dv">4.0</span><span class="op">,</span><span class="dv">5.0</span>))<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>    <span class="pp">dbg!</span>(kahan(<span class="dv">3.0</span><span class="op">,</span><span class="dv">4.0</span><span class="op">,</span><span class="dv">5.0</span>))<span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>    <span class="kw">let</span> a <span class="op">=</span> <span class="dv">100_000.0_f32</span><span class="op">;</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>    <span class="kw">let</span> c <span class="op">=</span> <span class="dv">0.01_f32</span><span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>    <span class="pp">dbg!</span>(heron(a<span class="op">,</span>a<span class="op">,</span>c))<span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>    <span class="pp">dbg!</span>(kahan(a<span class="op">,</span>a<span class="op">,</span>c))<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Oh what’s that?</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1"></a><span class="ex">[src/main.rs:21:5]</span> heron<span class="er">(</span><span class="ex">3.0,4.0,5.0</span><span class="kw">)</span> <span class="ex">=</span> 6.0</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="ex">[src/main.rs:22:5]</span> kahan<span class="er">(</span><span class="ex">3.0,4.0,5.0</span><span class="kw">)</span> <span class="ex">=</span> 6.0</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="ex">[src/main.rs:25:5]</span> heron<span class="er">(</span><span class="ex">a,a,c</span><span class="kw">)</span> <span class="ex">=</span> 781.25006</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="ex">[src/main.rs:26:5]</span> kahan<span class="er">(</span><span class="ex">a,a,c</span><span class="kw">)</span> <span class="ex">=</span> 500.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Using <code>f64</code> (vs <code>f32</code>) we get 499.9999999999994</li>
</ul>
</section>
<section id="significance-error-1" class="level2">
<h2 class="anchored" data-anchor-id="significance-error-1">Significance Error</h2>
<ul>
<li>Use Stable Algorithms
<ul>
<li>Keep big numbers with big numbers, little numbers with little numbers.</li>
</ul></li>
<li>Parentheses can help</li>
<li>The compiler won’t re-arrange your math if it cannot prove it would yield the same!
<ul>
<li>E.g. you can’t use <code>&lt;</code> in Rust as you may provide a <code>NaN</code>.</li>
</ul></li>
</ul>
</section>
<section id="significance-error-dont-floats" class="level2">
<h2 class="anchored" data-anchor-id="significance-error-dont-floats">Significance Error – Don’t floats?</h2>
<ul>
<li>Use integers
<ul>
<li>Very fast</li>
<li>Trade more precision for less range</li>
<li>Only input/output may be impacted by floating point conversions</li>
<li>Financial applications represent dollars as only cents or tenth’s of cents</li>
</ul></li>
</ul>
</section>
<section id="significance-error-dont-floats-1" class="level2">
<h2 class="anchored" data-anchor-id="significance-error-dont-floats-1">Significance Error – Don’t floats?</h2>
<ul>
<li>Use a math library
<ul>
<li>Slower</li>
<li>Define your own level of accuracy</li>
<li>Usually GMP or hardware specific.</li>
</ul></li>
</ul>
</section>
<section id="significance-error-dont-floats-2" class="level2">
<h2 class="anchored" data-anchor-id="significance-error-dont-floats-2">Significance Error – Don’t floats?</h2>
<ul>
<li>Execute symbolically
<ul>
<li>Slowest</li>
<li>Arbitrary accuracy</li>
<li>Round only at output</li>
</ul></li>
</ul>
</section>
<section id="significance-error-dont-floats-3" class="level2">
<h2 class="anchored" data-anchor-id="significance-error-dont-floats-3">Significance Error – Don’t floats?</h2>
<ul>
<li>Write your own library?
<ul>
<li>Use vectors of bits or bytes.</li>
<li>Write your own arithmetic operations.</li>
<li>Test and debug your own implemention.</li>
</ul></li>
<li>Coming soon to a homework near you!</li>
</ul>
</section>
<section id="algebraic-assumption-error" class="level2">
<h2 class="anchored" data-anchor-id="algebraic-assumption-error">Algebraic Assumption Error</h2>
<ul>
<li>Distributive Rule does not apply:
<ul>
<li><span class="math inline">\(a = x \times y - x \times z \nRightarrow a = x (y - z)\)</span></li>
</ul></li>
<li>Associative Rule does not apply: 𝑥 + 𝑦 +𝑧 ≠ 𝑥 +𝑦 +𝑧
<ul>
<li><span class="math inline">\(a = x + (y + z) \nRightarrow a = (x + y) + z\)</span></li>
</ul></li>
<li>Cannot interchange division and multiplication:
<ul>
<li><span class="math inline">\(a = \frac{x}{10.0} \nRightarrow a = x \times 0.1\)</span></li>
</ul></li>
</ul>
</section>
<section id="distribution" class="level2">
<h2 class="anchored" data-anchor-id="distribution">Distribution</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="op">&gt;&gt;&gt;</span> x, y, z</span>
<span id="cb27-2"><a href="#cb27-2"></a>(np.float32(<span class="fl">1000000000.0</span>), np.float32(<span class="fl">1.0000005</span>), np.float32(<span class="fl">1.0</span>))</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">*</span> y <span class="op">-</span> x <span class="op">*</span> z <span class="op">;</span> x <span class="op">*</span> (y <span class="op">-</span> z)</span>
<span id="cb27-4"><a href="#cb27-4"></a>np.float32(<span class="fl">448.0</span>)</span>
<span id="cb27-5"><a href="#cb27-5"></a>np.float32(<span class="fl">476.83716</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="association" class="level2">
<h2 class="anchored" data-anchor-id="association">Association</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="op">&gt;&gt;&gt;</span> x, y, z</span>
<span id="cb28-2"><a href="#cb28-2"></a>(np.float32(<span class="fl">16777216.0</span>), np.float32(<span class="fl">1.0</span>), np.float32(<span class="fl">1.0</span>))</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">+</span> (y <span class="op">+</span> z) <span class="op">;</span> (x <span class="op">+</span> y) <span class="op">+</span> z</span>
<span id="cb28-4"><a href="#cb28-4"></a>np.float32(<span class="fl">16777218.0</span>)</span>
<span id="cb28-5"><a href="#cb28-5"></a>np.float32(<span class="fl">16777216.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="interchange" class="level2">
<h2 class="anchored" data-anchor-id="interchange">Interchange</h2>
<ul>
<li>Check last digit</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">7</span> <span class="op">/</span> <span class="dv">100000000</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="fl">1.4285714285714284e-09</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">100000000</span> <span class="op">/</span> <span class="dv">7</span></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="fl">1.4285714285714286e-09</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="floating-point-exceptions" class="level2">
<h2 class="anchored" data-anchor-id="floating-point-exceptions">Floating Point Exceptions</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 37%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">IEEE 754 Exception</th>
<th style="text-align: left;">Result when traps disabled</th>
<th style="text-align: left;">Argument to trap handler</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>overflow</strong></td>
<td style="text-align: left;"><span class="math inline">\(\pm \infty\)</span> or <span class="math inline">\(\pm x_{\text{max}}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\text{round}(x 2^{-a})\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>underflow</strong></td>
<td style="text-align: left;"><span class="math inline">\(0, \pm 2^{\text{min}}\)</span> or denormalized</td>
<td style="text-align: left;"><span class="math inline">\(\text{round}(x 2^{a})\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>divide by zero</strong></td>
<td style="text-align: left;"><span class="math inline">\(\pm \infty\)</span></td>
<td style="text-align: left;">invalid operation</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>invalid</strong></td>
<td style="text-align: left;"><span class="math inline">\(\text{NaN}\)</span></td>
<td style="text-align: left;">invalid operation</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>inexact</strong></td>
<td style="text-align: left;"><span class="math inline">\(\text{round}(x)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\text{round}(x)\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="but-wait-theres-more" class="level2">
<h2 class="anchored" data-anchor-id="but-wait-theres-more">But Wait! There’s More!</h2>
<ul>
<li>Binary to Decimal Conversion Error</li>
<li>Summation Error</li>
<li>Propagation Error</li>
<li>Underflow, Overflow</li>
<li>Type Narrowing/Widening Rules</li>
</ul>
</section>
<section id="testing" class="level2">
<h2 class="anchored" data-anchor-id="testing">Testing</h2>
<ul>
<li>Design for Numerical Stability</li>
<li>Perform Meaningful Testing</li>
<li>Document assumptions</li>
<li>Track sources of approximation</li>
<li>Quantify goodness
<ul>
<li>Well conditioned algorithms</li>
</ul></li>
<li>Backward error analysis
<ul>
<li>Are the outputs identical for slightly modified inputs?</li>
</ul></li>
</ul>
</section>
<section id="today-1" class="level2">
<h2 class="anchored" data-anchor-id="today-1">Today</h2>
<ul>
<li>Understand precision through the lens of floats.
<ul>
<li>Understand the basics of floats</li>
<li>Understand the language of floats</li>
<li>Get a feel for when further investigation is required</li>
</ul></li>
</ul>


<!-- -->

</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Grammatically, this statement should be “so I have nothing about which to worry.”<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This is true in the special case that your programming language is Haskell.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This is due to how many numbers there are.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./42_sha512.html" class="pagination-link" aria-label="SHA-512">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">SHA-512</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./51_f16.html" class="pagination-link" aria-label="f16">
        <span class="nav-page-text">f16</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="an">title:</span><span class="co"> "IEEE 754"</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co">---</span></span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="fu">## Announcements</span></span>
<span id="cb30-6"><a href="#cb30-6"></a></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="ss">- </span>**Welcome** to Systems in Rust</span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="ss">- </span>**Action Items**:</span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="ss">  - </span>"SHA-512" is due on next Friday</span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="ss">  - </span>Lecture on numbers, inspired by the lab, while we wait.</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="fu">## Today</span></span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="ss">- </span>Understand precision through the lens of floats.</span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="ss">    - </span>Understand the basics of floats</span>
<span id="cb30-16"><a href="#cb30-16"></a><span class="ss">    - </span>Understand the language of floats</span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="ss">    - </span>Get a feel for when further investigation is required</span>
<span id="cb30-18"><a href="#cb30-18"></a></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="fu">## Citation</span></span>
<span id="cb30-20"><a href="#cb30-20"></a></span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="ss">- </span>Yoinked</span>
<span id="cb30-22"><a href="#cb30-22"></a><span class="ss">- </span><span class="co">[</span><span class="ot">url</span><span class="co">](https://github.com/DigitalInBlue/CPPCon2015)</span></span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="ss">- </span>Author John Farrier, Booz Allen Hamilton</span>
<span id="cb30-24"><a href="#cb30-24"></a></span>
<span id="cb30-25"><a href="#cb30-25"></a><span class="fu">## Mission Statement{.smaller}</span></span>
<span id="cb30-26"><a href="#cb30-26"></a></span>
<span id="cb30-27"><a href="#cb30-27"></a><span class="ss">- </span>I'm a normal person.</span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="ss">    -   </span>I think <span class="in">`5/2`</span> is <span class="in">`2.5`</span> or perhaps 2½.</span>
<span id="cb30-29"><a href="#cb30-29"></a><span class="ss">- </span>I'm a scientist.</span>
<span id="cb30-30"><a href="#cb30-30"></a><span class="ss">    - </span>I'm solving "Black-Scholes"</span>
<span id="cb30-31"><a href="#cb30-31"></a><span class="ss">    - </span><span class="co">[</span><span class="ot">Does anyone know what this is doing?</span><span class="co">](https://numba.pydata.org/numba-examples/examples/finance/blackscholes/results.html)</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>$$</span>
<span id="cb30-33"><a href="#cb30-33"></a>d_2 = d_1 - \sigma\sqrt{T - t} = \frac{1}{\sigma\sqrt{T - t}}\left<span class="co">[</span><span class="ot">\ln\left(\frac{S_t}{K}\right) + \left(r - q - \frac{1}{2}\sigma^2\right)(T - t)\right</span><span class="co">]</span></span>
<span id="cb30-34"><a href="#cb30-34"></a>$$</span>
<span id="cb30-35"><a href="#cb30-35"></a></span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="fu">## Common Fallacies</span></span>
<span id="cb30-37"><a href="#cb30-37"></a></span>
<span id="cb30-38"><a href="#cb30-38"></a><span class="ss">- </span>"Floating point numbers are numbers"</span>
<span id="cb30-39"><a href="#cb30-39"></a><span class="ss">    - </span><span class="in">`max(count())`</span> Pinocchios</span>
<span id="cb30-40"><a href="#cb30-40"></a><span class="ss">- </span>"It’s floating point error"</span>
<span id="cb30-41"><a href="#cb30-41"></a><span class="ss">    - </span>"All floating point involves magical rounding errors"</span>
<span id="cb30-42"><a href="#cb30-42"></a><span class="ss">- </span>"Linux and Windows handle floats differently"</span>
<span id="cb30-43"><a href="#cb30-43"></a><span class="ss">- </span>"Floating point represents an interval value near the actual value"</span>
<span id="cb30-44"><a href="#cb30-44"></a></span>
<span id="cb30-45"><a href="#cb30-45"></a><span class="fu">## Common Fallacies 2.0</span></span>
<span id="cb30-46"><a href="#cb30-46"></a></span>
<span id="cb30-47"><a href="#cb30-47"></a><span class="ss">- </span>"A double (an <span class="in">`f64`</span>) holds 15 decimal places and I only need 3, so I have nothing to worry about"<span class="ot">[^1]</span></span>
<span id="cb30-48"><a href="#cb30-48"></a><span class="ss">- </span>"My programming language does better math than your programming language"<span class="ot">[^2]</span></span>
<span id="cb30-49"><a href="#cb30-49"></a><span class="ss">- </span>"Why can't computers just store whatever number I use"<span class="ot">[^3]</span></span>
<span id="cb30-50"><a href="#cb30-50"></a></span>
<span id="cb30-51"><a href="#cb30-51"></a><span class="ot">[^1]: </span>Grammatically, this statement should be "so I have nothing about which to worry."</span>
<span id="cb30-52"><a href="#cb30-52"></a><span class="ot">[^2]: </span>This is true in the special case that your programming language is Haskell.</span>
<span id="cb30-53"><a href="#cb30-53"></a><span class="ot">[^3]: </span>This is due to how many numbers there are.</span>
<span id="cb30-54"><a href="#cb30-54"></a></span>
<span id="cb30-55"><a href="#cb30-55"></a><span class="fu">## Anatomy of IEEE Floats</span></span>
<span id="cb30-56"><a href="#cb30-56"></a></span>
<span id="cb30-57"><a href="#cb30-57"></a><span class="al">![](https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/IEEE754.svg/550px-IEEE754.svg.png)</span></span>
<span id="cb30-58"><a href="#cb30-58"></a></span>
<span id="cb30-59"><a href="#cb30-59"></a><span class="fu">## IEEE Float Specification</span></span>
<span id="cb30-60"><a href="#cb30-60"></a></span>
<span id="cb30-61"><a href="#cb30-61"></a><span class="ss">- </span>IEEE 754-1985, IEEE 854-1987, IEEE 754-2008</span>
<span id="cb30-62"><a href="#cb30-62"></a><span class="ss">    - </span>These are paywalled.</span>
<span id="cb30-63"><a href="#cb30-63"></a><span class="ss">    - </span>Those are years.</span>
<span id="cb30-64"><a href="#cb30-64"></a><span class="ss">- </span>Provide for portable, provably consistent math</span>
<span id="cb30-65"><a href="#cb30-65"></a><span class="ss">    - </span>Consistent, not correct.</span>
<span id="cb30-66"><a href="#cb30-66"></a></span>
<span id="cb30-67"><a href="#cb30-67"></a><span class="fu">## Assurances</span></span>
<span id="cb30-68"><a href="#cb30-68"></a></span>
<span id="cb30-69"><a href="#cb30-69"></a><span class="ss">- </span>Ensure some significant mathematical identities hold true:</span>
<span id="cb30-70"><a href="#cb30-70"></a><span class="ss">    - </span>$x + y  = y + x$</span>
<span id="cb30-71"><a href="#cb30-71"></a><span class="ss">        - </span>Symmetry of addition</span>
<span id="cb30-72"><a href="#cb30-72"></a><span class="ss">    - </span>$x + 0 = x$</span>
<span id="cb30-73"><a href="#cb30-73"></a><span class="ss">        - </span>Additive identity</span>
<span id="cb30-74"><a href="#cb30-74"></a><span class="ss">    - </span>$x = y \implies x - y = 0$</span>
<span id="cb30-75"><a href="#cb30-75"></a><span class="ss">        - </span>Identity under subtraction</span>
<span id="cb30-76"><a href="#cb30-76"></a>        </span>
<span id="cb30-77"><a href="#cb30-77"></a><span class="fu">## Assurances 2.0</span></span>
<span id="cb30-78"><a href="#cb30-78"></a></span>
<span id="cb30-79"><a href="#cb30-79"></a>$$</span>
<span id="cb30-80"><a href="#cb30-80"></a>\frac{x}{\sqrt{x^2+y^2}} \leq 1</span>
<span id="cb30-81"><a href="#cb30-81"></a>$$</span>
<span id="cb30-82"><a href="#cb30-82"></a></span>
<span id="cb30-83"><a href="#cb30-83"></a><span class="ss">- </span>What is missing?</span>
<span id="cb30-84"><a href="#cb30-84"></a></span>
<span id="cb30-85"><a href="#cb30-85"></a><span class="fu">## IEEE Float Specification</span></span>
<span id="cb30-86"><a href="#cb30-86"></a></span>
<span id="cb30-87"><a href="#cb30-87"></a><span class="ss">- </span>Ensure every floating point number is unique</span>
<span id="cb30-88"><a href="#cb30-88"></a><span class="ss">- </span>Ensure every floating point number has an opposite</span>
<span id="cb30-89"><a href="#cb30-89"></a><span class="ss">    - </span>_Zero_ is a special case because of this</span>
<span id="cb30-90"><a href="#cb30-90"></a><span class="ss">- </span>Specifies algorithms for addition, subtraction, multiplication, division, and square-root</span>
<span id="cb30-91"><a href="#cb30-91"></a><span class="ss">    - </span>Not really operations/relations! They are algorithms.</span>
<span id="cb30-92"><a href="#cb30-92"></a>    </span>
<span id="cb30-93"><a href="#cb30-93"></a>    </span>
<span id="cb30-94"><a href="#cb30-94"></a><span class="fu">## Aside: Scientific Notation</span></span>
<span id="cb30-95"><a href="#cb30-95"></a></span>
<span id="cb30-96"><a href="#cb30-96"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">Scientific notation is a way of expressing numbers that are too large or too small to be conveniently written in decimal form, since to do so would require writing out an inconveniently long string of digits.</span><span class="co">](https://en.wikipedia.org/wiki/Scientific_notation)</span></span>
<span id="cb30-97"><a href="#cb30-97"></a></span>
<span id="cb30-98"><a href="#cb30-98"></a><span class="ss">- </span>In scientific notation, nonzero numbers are written in the form </span>
<span id="cb30-99"><a href="#cb30-99"></a></span>
<span id="cb30-100"><a href="#cb30-100"></a>$$a \times 10^b$$</span>
<span id="cb30-101"><a href="#cb30-101"></a></span>
<span id="cb30-102"><a href="#cb30-102"></a><span class="fu">## Aside: Explanation</span></span>
<span id="cb30-103"><a href="#cb30-103"></a></span>
<span id="cb30-104"><a href="#cb30-104"></a></span>
<span id="cb30-105"><a href="#cb30-105"></a><span class="ss">- </span>In scientific notation, nonzero numbers are written in the form </span>
<span id="cb30-106"><a href="#cb30-106"></a></span>
<span id="cb30-107"><a href="#cb30-107"></a>$$a \times 10^b$$</span>
<span id="cb30-108"><a href="#cb30-108"></a></span>
<span id="cb30-109"><a href="#cb30-109"></a></span>
<span id="cb30-110"><a href="#cb30-110"></a><span class="ss">* </span>$a$ (the coefficient or mantissa) is a number greater than or equal to 1 and less than 10 ($1 \le |a| &lt; 10$).</span>
<span id="cb30-111"><a href="#cb30-111"></a><span class="ss">* </span>$10$ is the base.</span>
<span id="cb30-112"><a href="#cb30-112"></a><span class="ss">* </span>$b$ (the exponent) is an integer.</span>
<span id="cb30-113"><a href="#cb30-113"></a></span>
<span id="cb30-114"><a href="#cb30-114"></a></span>
<span id="cb30-115"><a href="#cb30-115"></a><span class="fu">## Aside: Physical Examples</span></span>
<span id="cb30-116"><a href="#cb30-116"></a></span>
<span id="cb30-117"><a href="#cb30-117"></a><span class="ss">1.  </span>**Speed of light:** The speed of light in a vacuum is approximately $300,000,000 \text{ m/s}$</span>
<span id="cb30-118"><a href="#cb30-118"></a>$$</span>
<span id="cb30-119"><a href="#cb30-119"></a>3 \times 10^8 \text{ m/s}</span>
<span id="cb30-120"><a href="#cb30-120"></a>$$</span>
<span id="cb30-121"><a href="#cb30-121"></a></span>
<span id="cb30-122"><a href="#cb30-122"></a><span class="ss">2.  </span>**Mass of an electron:** The mass of an electron is approximately $0.00000000000000000000000000091093837 \text{ g}$.</span>
<span id="cb30-123"><a href="#cb30-123"></a>$$</span>
<span id="cb30-124"><a href="#cb30-124"></a>9.1093837 \times 10^{-28} \text{ g}</span>
<span id="cb30-125"><a href="#cb30-125"></a>$$</span>
<span id="cb30-126"><a href="#cb30-126"></a></span>
<span id="cb30-127"><a href="#cb30-127"></a><span class="fu">## Aside: Economic Examples</span></span>
<span id="cb30-128"><a href="#cb30-128"></a></span>
<span id="cb30-129"><a href="#cb30-129"></a><span class="ss">- </span>We can use social science numbers.</span>
<span id="cb30-130"><a href="#cb30-130"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Labor Market Outcomes of College Graduates by Major</span><span class="co">](https://www.newyorkfed.org/research/college-labor-market#--:explore:outcomes-by-major)</span></span>
<span id="cb30-131"><a href="#cb30-131"></a><span class="ss">- </span>Computer Science majors in 2023 have a \$80,000 median wage "early career"</span>
<span id="cb30-132"><a href="#cb30-132"></a><span class="ss">    - </span>$8.0000 \times 10^4$</span>
<span id="cb30-133"><a href="#cb30-133"></a><span class="ss">- </span>And 6.1% unemployment</span>
<span id="cb30-134"><a href="#cb30-134"></a><span class="ss">    - </span>$6.1 \times 10^{-2}$</span>
<span id="cb30-135"><a href="#cb30-135"></a></span>
<span id="cb30-136"><a href="#cb30-136"></a><span class="fu">## IEEE Layout</span></span>
<span id="cb30-137"><a href="#cb30-137"></a></span>
<span id="cb30-138"><a href="#cb30-138"></a><span class="ss">- </span>An approximation using scientific notation</span>
<span id="cb30-139"><a href="#cb30-139"></a><span class="ss">    - </span>$x = -1^s \times 2^e \times 1.m$</span>
<span id="cb30-140"><a href="#cb30-140"></a><span class="ss">    - </span>$x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}$</span>
<span id="cb30-141"><a href="#cb30-141"></a><span class="ss">        - </span>Where the mantissa is the technical term for the the digits after the decimal point.</span>
<span id="cb30-142"><a href="#cb30-142"></a>        </span>
<span id="cb30-143"><a href="#cb30-143"></a><span class="fu">## With Binary{.smaller}</span></span>
<span id="cb30-144"><a href="#cb30-144"></a></span>
<span id="cb30-145"><a href="#cb30-145"></a><span class="ss">- </span>$x = -0b1^{\text{0b0}} \times 0b10^{\text{0b10000000}}  \times 0b1.10010010000111111011011$</span>
<span id="cb30-146"><a href="#cb30-146"></a><span class="ss">- </span>Express in memory as the concatenation:</span>
<span id="cb30-147"><a href="#cb30-147"></a><span class="ss">    - </span><span class="in">`0b0`</span> to <span class="in">`0b10000000`</span> to <span class="in">`0b10010010000111111011011`</span></span>
<span id="cb30-148"><a href="#cb30-148"></a><span class="ss">    - </span><span class="in">`01000000010010010000111111011011`</span></span>
<span id="cb30-149"><a href="#cb30-149"></a>        </span>
<span id="cb30-150"><a href="#cb30-150"></a><span class="fu">## Singles and Doubles</span></span>
<span id="cb30-151"><a href="#cb30-151"></a>        </span>
<span id="cb30-152"><a href="#cb30-152"></a><span class="ss">- </span>32 - bits = 1 sign bit + 8 exponent bits + 23 mantissa bits</span>
<span id="cb30-153"><a href="#cb30-153"></a><span class="ss">    - </span><span class="in">`0b0`</span> to <span class="in">`0b10000000`</span> to <span class="in">`0b10010010000111111011011`</span></span>
<span id="cb30-154"><a href="#cb30-154"></a><span class="ss">- </span>64 - bits = 1 sign bit + 12 exponent bits + 52 mantissa bits</span>
<span id="cb30-155"><a href="#cb30-155"></a></span>
<span id="cb30-156"><a href="#cb30-156"></a><span class="fu">## Understanding check</span></span>
<span id="cb30-157"><a href="#cb30-157"></a></span>
<span id="cb30-158"><a href="#cb30-158"></a><span class="ss">- </span>What is the probability a *real number* $a \in \mathbb{R}$ has an exact float representation?</span>
<span id="cb30-159"><a href="#cb30-159"></a><span class="ss">- </span>What is the probability an *integer* $n \in \mathbb{Z}$ has an exact float representation?</span>
<span id="cb30-160"><a href="#cb30-160"></a><span class="ss">- </span>What is the probability a *course number* $n &lt; 600$ has an exact float representation?</span>
<span id="cb30-161"><a href="#cb30-161"></a></span>
<span id="cb30-162"><a href="#cb30-162"></a></span>
<span id="cb30-163"><a href="#cb30-163"></a><span class="fu">## Special Floats - NaN</span></span>
<span id="cb30-164"><a href="#cb30-164"></a></span>
<span id="cb30-165"><a href="#cb30-165"></a><span class="ss">- </span>Divide by Zero</span>
<span id="cb30-166"><a href="#cb30-166"></a><span class="ss">    - </span>1 / 0</span>
<span id="cb30-167"><a href="#cb30-167"></a><span class="ss">- </span>Not a Number (NaN)</span>
<span id="cb30-168"><a href="#cb30-168"></a></span>
<span id="cb30-169"><a href="#cb30-169"></a><span class="in">```py</span></span>
<span id="cb30-170"><a href="#cb30-170"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> float32 <span class="im">as</span> f32</span>
<span id="cb30-171"><a href="#cb30-171"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">1</span>)<span class="op">/</span>f32(<span class="dv">0</span>)</span>
<span id="cb30-172"><a href="#cb30-172"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: divide by zero encountered <span class="kw">in</span> scalar divide</span>
<span id="cb30-173"><a href="#cb30-173"></a>np.float32(inf)</span>
<span id="cb30-174"><a href="#cb30-174"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span><span class="op">/</span><span class="dv">0</span></span>
<span id="cb30-175"><a href="#cb30-175"></a>Traceback (most recent call last):</span>
<span id="cb30-176"><a href="#cb30-176"></a>  File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb30-177"><a href="#cb30-177"></a><span class="pp">ZeroDivisionError</span>: division by zero</span>
<span id="cb30-178"><a href="#cb30-178"></a><span class="in">```</span></span>
<span id="cb30-179"><a href="#cb30-179"></a></span>
<span id="cb30-180"><a href="#cb30-180"></a><span class="fu">## Special Floats - inf</span></span>
<span id="cb30-181"><a href="#cb30-181"></a></span>
<span id="cb30-182"><a href="#cb30-182"></a><span class="ss">- </span>Signed Infinity</span>
<span id="cb30-183"><a href="#cb30-183"></a><span class="ss">    - </span>Overflow protection</span>
<span id="cb30-184"><a href="#cb30-184"></a><span class="in">```py</span></span>
<span id="cb30-185"><a href="#cb30-185"></a><span class="op">&gt;&gt;&gt;</span> f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>)</span>
<span id="cb30-186"><a href="#cb30-186"></a><span class="op">&lt;</span>stdin<span class="op">&gt;</span>:<span class="dv">1</span>: <span class="pp">RuntimeWarning</span>: overflow encountered <span class="kw">in</span> scalar power</span>
<span id="cb30-187"><a href="#cb30-187"></a>np.float32(inf)</span>
<span id="cb30-188"><a href="#cb30-188"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">10.0</span> <span class="op">**</span> <span class="dv">10000</span></span>
<span id="cb30-189"><a href="#cb30-189"></a>Traceback (most recent call last):</span>
<span id="cb30-190"><a href="#cb30-190"></a>  File <span class="st">"&lt;stdin&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb30-191"><a href="#cb30-191"></a><span class="pp">OverflowError</span>: (<span class="dv">34</span>, <span class="st">'Numerical result out of range'</span>)</span>
<span id="cb30-192"><a href="#cb30-192"></a><span class="in">```</span></span>
<span id="cb30-193"><a href="#cb30-193"></a></span>
<span id="cb30-194"><a href="#cb30-194"></a><span class="fu">## Infinity is signed </span></span>
<span id="cb30-195"><a href="#cb30-195"></a></span>
<span id="cb30-196"><a href="#cb30-196"></a><span class="ss">- </span>We can get negative infinity through a variety of means.</span>
<span id="cb30-197"><a href="#cb30-197"></a></span>
<span id="cb30-198"><a href="#cb30-198"></a><span class="in">```py</span></span>
<span id="cb30-199"><a href="#cb30-199"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span>(f32(<span class="dv">10</span>) <span class="op">**</span> f32(<span class="dv">100</span>))</span>
<span id="cb30-200"><a href="#cb30-200"></a>np.float32(<span class="op">-</span>inf)</span>
<span id="cb30-201"><a href="#cb30-201"></a><span class="in">```</span></span>
<span id="cb30-202"><a href="#cb30-202"></a></span>
<span id="cb30-203"><a href="#cb30-203"></a><span class="ss">- </span>We note that this suppresses the overflow error use <span class="in">`()`</span></span>
<span id="cb30-204"><a href="#cb30-204"></a><span class="ss">- </span>In some languages this is not ever regarded as an overflow error, like Julia (where we have to use larger powers due to the f64 default)</span>
<span id="cb30-205"><a href="#cb30-205"></a><span class="in">```jl</span></span>
<span id="cb30-206"><a href="#cb30-206"></a><span class="in">julia&gt; 10.0^10000</span></span>
<span id="cb30-207"><a href="#cb30-207"></a><span class="in">Inf</span></span>
<span id="cb30-208"><a href="#cb30-208"></a></span>
<span id="cb30-209"><a href="#cb30-209"></a><span class="in">julia&gt; -(10.0^10000)</span></span>
<span id="cb30-210"><a href="#cb30-210"></a><span class="in">-Inf</span></span>
<span id="cb30-211"><a href="#cb30-211"></a></span>
<span id="cb30-212"><a href="#cb30-212"></a><span class="in">```</span></span>
<span id="cb30-213"><a href="#cb30-213"></a></span>
<span id="cb30-214"><a href="#cb30-214"></a><span class="fu">## Signed Zero</span></span>
<span id="cb30-215"><a href="#cb30-215"></a></span>
<span id="cb30-216"><a href="#cb30-216"></a><span class="ss">- </span>Signed Zero</span>
<span id="cb30-217"><a href="#cb30-217"></a><span class="ss">    - </span>Underflow protection, preserves sign</span>
<span id="cb30-218"><a href="#cb30-218"></a><span class="ss">    - </span>+ 0 =− 0</span>
<span id="cb30-219"><a href="#cb30-219"></a><span class="in">```py</span></span>
<span id="cb30-220"><a href="#cb30-220"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span></span>
<span id="cb30-221"><a href="#cb30-221"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb30-222"><a href="#cb30-222"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">==</span> (<span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">**</span> <span class="dv">1000</span>)</span>
<span id="cb30-223"><a href="#cb30-223"></a><span class="va">True</span></span>
<span id="cb30-224"><a href="#cb30-224"></a><span class="op">&gt;&gt;&gt;</span> <span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb30-225"><a href="#cb30-225"></a><span class="op">-</span><span class="fl">0.0</span></span>
<span id="cb30-226"><a href="#cb30-226"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.0</span> <span class="op">-</span> <span class="fl">0.0</span></span>
<span id="cb30-227"><a href="#cb30-227"></a><span class="fl">0.0</span></span>
<span id="cb30-228"><a href="#cb30-228"></a><span class="in">```</span></span>
<span id="cb30-229"><a href="#cb30-229"></a><span class="ss">- </span>Works in base Python (e.g. don't need NumPy).</span>
<span id="cb30-230"><a href="#cb30-230"></a><span class="ss">- </span>Couldn't get it to work in Julia actually (went to -inf or NaN)</span>
<span id="cb30-231"><a href="#cb30-231"></a></span>
<span id="cb30-232"><a href="#cb30-232"></a></span>
<span id="cb30-233"><a href="#cb30-233"></a></span>
<span id="cb30-234"><a href="#cb30-234"></a><span class="fu">## Simple Example</span></span>
<span id="cb30-235"><a href="#cb30-235"></a></span>
<span id="cb30-236"><a href="#cb30-236"></a><span class="ss">- </span>Floating point is great because it will work exactly how you expect.</span>
<span id="cb30-237"><a href="#cb30-237"></a></span>
<span id="cb30-238"><a href="#cb30-238"></a><span class="in">```py</span></span>
<span id="cb30-239"><a href="#cb30-239"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb30-240"><a href="#cb30-240"></a><span class="va">False</span></span>
<span id="cb30-241"><a href="#cb30-241"></a><span class="in">```</span></span>
<span id="cb30-242"><a href="#cb30-242"></a></span>
<span id="cb30-243"><a href="#cb30-243"></a><span class="ss">- </span>More or less.</span>
<span id="cb30-244"><a href="#cb30-244"></a></span>
<span id="cb30-245"><a href="#cb30-245"></a><span class="in">```py</span></span>
<span id="cb30-246"><a href="#cb30-246"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span></span>
<span id="cb30-247"><a href="#cb30-247"></a><span class="fl">0.30000000000000004</span></span>
<span id="cb30-248"><a href="#cb30-248"></a><span class="in">```</span></span>
<span id="cb30-249"><a href="#cb30-249"></a></span>
<span id="cb30-250"><a href="#cb30-250"></a><span class="fu">## Simple Example</span></span>
<span id="cb30-251"><a href="#cb30-251"></a></span>
<span id="cb30-252"><a href="#cb30-252"></a></span>
<span id="cb30-253"><a href="#cb30-253"></a><span class="ss">- </span>We shouldn't be suprised by this!</span>
<span id="cb30-254"><a href="#cb30-254"></a><span class="in">```py</span></span>
<span id="cb30-255"><a href="#cb30-255"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f32(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb30-256"><a href="#cb30-256"></a><span class="fl">0.100000001490116119384765625</span></span>
<span id="cb30-257"><a href="#cb30-257"></a><span class="fl">0.20000000298023223876953125</span></span>
<span id="cb30-258"><a href="#cb30-258"></a><span class="fl">0.300000011920928955078125</span></span>
<span id="cb30-259"><a href="#cb30-259"></a><span class="op">&gt;&gt;&gt;</span> _ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>f64(i<span class="op">/</span><span class="dv">10</span>)<span class="sc">:1.100}</span><span class="ss">"</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb30-260"><a href="#cb30-260"></a><span class="fl">0.1000000000000000055511151231257827021181583404541015625</span></span>
<span id="cb30-261"><a href="#cb30-261"></a><span class="fl">0.200000000000000011102230246251565404236316680908203125</span></span>
<span id="cb30-262"><a href="#cb30-262"></a><span class="fl">0.299999999999999988897769753748434595763683319091796875</span></span>
<span id="cb30-263"><a href="#cb30-263"></a><span class="in">```</span></span>
<span id="cb30-264"><a href="#cb30-264"></a></span>
<span id="cb30-265"><a href="#cb30-265"></a><span class="fu">## Storage of 1.</span></span>
<span id="cb30-266"><a href="#cb30-266"></a></span>
<span id="cb30-267"><a href="#cb30-267"></a></span>
<span id="cb30-268"><a href="#cb30-268"></a><span class="ss">- </span>$x = -1^s \times 2^e \times 1.m$</span>
<span id="cb30-269"><a href="#cb30-269"></a><span class="ss">- </span>$x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1.\text{mantissa}$</span>
<span id="cb30-270"><a href="#cb30-270"></a><span class="ss">- </span>$x = -1^{\text{sign bit}} \times \text{base} 2^{\text{exponent}} \times 1 + \text{mantissa} \times \frac{1}{2^n}$</span>
<span id="cb30-271"><a href="#cb30-271"></a><span class="ss">- </span>$1 = -1^0 \times 2^0 \times (1 + 0 \times \frac{1}{2^n}$</span>
<span id="cb30-272"><a href="#cb30-272"></a><span class="ss">- </span>So each of the sign bit, the base, and the mantissa are zero.</span>
<span id="cb30-273"><a href="#cb30-273"></a><span class="ss">    - </span>I should note I was unable to reproduce this in Rust or C.</span>
<span id="cb30-274"><a href="#cb30-274"></a><span class="ss">    - </span>I'm not really a floating pointer.</span>
<span id="cb30-275"><a href="#cb30-275"></a></span>
<span id="cb30-276"><a href="#cb30-276"></a><span class="fu">## Except...</span></span>
<span id="cb30-277"><a href="#cb30-277"></a></span>
<span id="cb30-278"><a href="#cb30-278"></a><span class="ss">- </span>This is actually a little bit fake.</span>
<span id="cb30-279"><a href="#cb30-279"></a><span class="in">```rs</span></span>
<span id="cb30-280"><a href="#cb30-280"></a><span class="op">$</span> cat src<span class="op">/</span>main<span class="op">.</span>rs</span>
<span id="cb30-281"><a href="#cb30-281"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb30-282"><a href="#cb30-282"></a>    <span class="kw">let</span> x<span class="op">:</span><span class="dt">f32</span> <span class="op">=</span> <span class="dv">1.0</span><span class="op">;</span></span>
<span id="cb30-283"><a href="#cb30-283"></a>    <span class="pp">println!</span>(<span class="st">"{:032b}"</span><span class="op">,</span> x<span class="op">.</span>to_bits())<span class="op">;</span></span>
<span id="cb30-284"><a href="#cb30-284"></a><span class="op">}</span></span>
<span id="cb30-285"><a href="#cb30-285"></a><span class="op">$</span> cargo run</span>
<span id="cb30-286"><a href="#cb30-286"></a>    Finished `dev` profile [unoptimized <span class="op">+</span> debuginfo] target(s) <span class="kw">in</span> <span class="dv">0</span><span class="op">.</span>00s</span>
<span id="cb30-287"><a href="#cb30-287"></a>     Running `target<span class="op">/</span>debug<span class="op">/</span>bits`</span>
<span id="cb30-288"><a href="#cb30-288"></a><span class="dv">00111111100000000000000000000000</span></span>
<span id="cb30-289"><a href="#cb30-289"></a><span class="in">```</span></span>
<span id="cb30-290"><a href="#cb30-290"></a><span class="ss">- </span>What is that?</span>
<span id="cb30-291"><a href="#cb30-291"></a></span>
<span id="cb30-292"><a href="#cb30-292"></a><span class="fu">## Shift 127</span></span>
<span id="cb30-293"><a href="#cb30-293"></a></span>
<span id="cb30-294"><a href="#cb30-294"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">While the exponent can be positive or negative, in binary formats it is stored as an unsigned number that has a fixed "bias" added to it.</span><span class="co">](https://en.wikipedia.org/wiki/Floating-point_arithmetic#Internal_representation)</span></span>
<span id="cb30-295"><a href="#cb30-295"></a></span>
<span id="cb30-296"><a href="#cb30-296"></a><span class="ss">- </span>The IEEE 754 binary format specifies a hardware implementation of such that the exponent, be it positive or negative, in binary formats is stored as an unsigned number that has a fixed "bias" added to it.</span>
<span id="cb30-297"><a href="#cb30-297"></a><span class="ss">- </span>In the case of 32 bit floats, the bias is 127.</span>
<span id="cb30-298"><a href="#cb30-298"></a></span>
<span id="cb30-299"><a href="#cb30-299"></a><span class="fu">## Breakdown</span></span>
<span id="cb30-300"><a href="#cb30-300"></a></span>
<span id="cb30-301"><a href="#cb30-301"></a><span class="ss">- </span>Take the following:</span>
<span id="cb30-302"><a href="#cb30-302"></a><span class="in">```sh</span></span>
<span id="cb30-303"><a href="#cb30-303"></a><span class="ex">00111111100000000000000000000000</span></span>
<span id="cb30-304"><a href="#cb30-304"></a><span class="in">```</span></span>
<span id="cb30-305"><a href="#cb30-305"></a><span class="ss">- </span>That is:</span>
<span id="cb30-306"><a href="#cb30-306"></a><span class="ss">    - </span>Sign bit of <span class="in">`0`</span></span>
<span id="cb30-307"><a href="#cb30-307"></a><span class="ss">    - </span>Exponent of <span class="in">`01111111`</span></span>
<span id="cb30-308"><a href="#cb30-308"></a><span class="ss">        - </span>All zeroes and all ones are reserved for <span class="in">`NaN`</span>, <span class="in">`inf`</span>, etc.</span>
<span id="cb30-309"><a href="#cb30-309"></a><span class="ss">    - </span>Mantissa of 23 zeroes.</span>
<span id="cb30-310"><a href="#cb30-310"></a>    </span>
<span id="cb30-311"><a href="#cb30-311"></a><span class="fu">## How precise?</span></span>
<span id="cb30-312"><a href="#cb30-312"></a></span>
<span id="cb30-313"><a href="#cb30-313"></a><span class="ss">- </span>I have referred to <span class="in">`f32`</span> as having "32 bits of precision".</span>
<span id="cb30-314"><a href="#cb30-314"></a><span class="ss">- </span>How much precision is that?</span>
<span id="cb30-315"><a href="#cb30-315"></a><span class="ss">- </span>Well, let's set the least significant bit of the mantissa to one.</span>
<span id="cb30-316"><a href="#cb30-316"></a><span class="in">```{.rs filename="main.rs"}</span></span>
<span id="cb30-317"><a href="#cb30-317"></a><span class="in">fn main() {</span></span>
<span id="cb30-318"><a href="#cb30-318"></a><span class="in">    let x:f32 = 1.0;</span></span>
<span id="cb30-319"><a href="#cb30-319"></a><span class="in">    let mut b:u32 = x.to_bits();</span></span>
<span id="cb30-320"><a href="#cb30-320"></a><span class="in">    b |= 1;</span></span>
<span id="cb30-321"><a href="#cb30-321"></a><span class="in">    println!("{:032b}", b);</span></span>
<span id="cb30-322"><a href="#cb30-322"></a><span class="in">    println!("{:1.32}", f32::from_bits(b));</span></span>
<span id="cb30-323"><a href="#cb30-323"></a><span class="in">}</span></span>
<span id="cb30-324"><a href="#cb30-324"></a><span class="in">```</span></span>
<span id="cb30-325"><a href="#cb30-325"></a></span>
<span id="cb30-326"><a href="#cb30-326"></a><span class="fu">## "Epsilon"</span></span>
<span id="cb30-327"><a href="#cb30-327"></a></span>
<span id="cb30-328"><a href="#cb30-328"></a><span class="ss">- </span>What do we get?</span>
<span id="cb30-329"><a href="#cb30-329"></a><span class="in">```sh</span></span>
<span id="cb30-330"><a href="#cb30-330"></a><span class="ex">$</span> cargo run</span>
<span id="cb30-331"><a href="#cb30-331"></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.00s</span></span>
<span id="cb30-332"><a href="#cb30-332"></a>     <span class="ex">Running</span> <span class="kw">`</span><span class="ex">target/debug/bits</span><span class="kw">`</span></span>
<span id="cb30-333"><a href="#cb30-333"></a><span class="ex">00111111100000000000000000000001</span></span>
<span id="cb30-334"><a href="#cb30-334"></a><span class="ex">1.00000011920928955078125000000000</span></span>
<span id="cb30-335"><a href="#cb30-335"></a><span class="in">```</span></span>
<span id="cb30-336"><a href="#cb30-336"></a></span>
<span id="cb30-337"><a href="#cb30-337"></a><span class="ss">- </span>We refer to this value (less one) as <span class="co">[</span><span class="ot">machine epsilon</span><span class="co">](https://en.wikipedia.org/wiki/Machine_epsilon)</span>, or perhaps $\varepsilon$.</span>
<span id="cb30-338"><a href="#cb30-338"></a><span class="ss">- </span>The difference between 1.0 and the next available floating point number.</span>
<span id="cb30-339"><a href="#cb30-339"></a><span class="ss">- </span>Much lower, of course, with double and quad precision.</span>
<span id="cb30-340"><a href="#cb30-340"></a></span>
<span id="cb30-341"><a href="#cb30-341"></a></span>
<span id="cb30-342"><a href="#cb30-342"></a><span class="fu">## Easier: "Sig figs"</span></span>
<span id="cb30-343"><a href="#cb30-343"></a></span>
<span id="cb30-344"><a href="#cb30-344"></a>| Format | Sign | Exp.  | Mant. | Bits  | Bias | Prec. | Significance |</span>
<span id="cb30-345"><a href="#cb30-345"></a>| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: |</span>
<span id="cb30-346"><a href="#cb30-346"></a>| Half  | 1 | 5 | 10 | 16 | 15 | 11 | **3-4** |</span>
<span id="cb30-347"><a href="#cb30-347"></a>| Single | 1 | 8 | 23 | 32 | 127 | 24 | **6-9** |</span>
<span id="cb30-348"><a href="#cb30-348"></a>| Double | 1 | 11 | 52 | 64 | 1023 | 53 | **15-17** |</span>
<span id="cb30-349"><a href="#cb30-349"></a>| Quad | 1 | 15 | 112 | 128 | 16383 | 113 | **33-36** |</span>
<span id="cb30-350"><a href="#cb30-350"></a></span>
<span id="cb30-351"><a href="#cb30-351"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Prof. Kahan, UCB EECS</span><span class="co">](https://people.eecs.berkeley.edu/~wkahan/ieee754status/IEEE754.PDF)</span></span>
<span id="cb30-352"><a href="#cb30-352"></a></span>
<span id="cb30-353"><a href="#cb30-353"></a><span class="fu">## Sig figs</span></span>
<span id="cb30-354"><a href="#cb30-354"></a></span>
<span id="cb30-355"><a href="#cb30-355"></a><span class="ss">- </span>IEEE 754 was intended for *scientific computing*</span>
<span id="cb30-356"><a href="#cb30-356"></a><span class="ss">- </span>That is, not systems computing, software etc.</span>
<span id="cb30-357"><a href="#cb30-357"></a><span class="ss">- </span>Useful to us to think about information and how bits work.</span>
<span id="cb30-358"><a href="#cb30-358"></a></span>
<span id="cb30-359"><a href="#cb30-359"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">Significant figures, also referred to as significant digits, are specific digits within a number that is written in positional notation that carry both reliability and necessity in conveying a particular quantity.</span><span class="co">](https://en.wikipedia.org/wiki/Significant_figures)</span></span>
<span id="cb30-360"><a href="#cb30-360"></a></span>
<span id="cb30-361"><a href="#cb30-361"></a><span class="fu">## Small Values</span></span>
<span id="cb30-362"><a href="#cb30-362"></a></span>
<span id="cb30-363"><a href="#cb30-363"></a><span class="ss">- </span>For 32-bit floats, the minimum base 10 exponent is -36.</span>
<span id="cb30-364"><a href="#cb30-364"></a><span class="ss">- </span>How is $1.0 \times 10^{-37}$ represented?</span>
<span id="cb30-365"><a href="#cb30-365"></a></span>
<span id="cb30-366"><a href="#cb30-366"></a><span class="in">```rs</span></span>
<span id="cb30-367"><a href="#cb30-367"></a><span class="co">// In Rust, we may use '0b' prefix for binary representation.</span></span>
<span id="cb30-368"><a href="#cb30-368"></a><span class="co">// In Rust, we may us underscores within numerical values.</span></span>
<span id="cb30-369"><a href="#cb30-369"></a><span class="dv">0b0_00000000_11011001110001111101110</span></span>
<span id="cb30-370"><a href="#cb30-370"></a><span class="in">```</span></span>
<span id="cb30-371"><a href="#cb30-371"></a></span>
<span id="cb30-372"><a href="#cb30-372"></a><span class="fu">## Test it</span></span>
<span id="cb30-373"><a href="#cb30-373"></a></span>
<span id="cb30-374"><a href="#cb30-374"></a><span class="ss">- </span>Write a simple test...</span>
<span id="cb30-375"><a href="#cb30-375"></a><span class="in">```{.rs filename="src/main.rs"}</span></span>
<span id="cb30-376"><a href="#cb30-376"></a><span class="in">fn main() {</span></span>
<span id="cb30-377"><a href="#cb30-377"></a><span class="in">    let b:u32 = 0b0_00000000_11011001110001111101110;</span></span>
<span id="cb30-378"><a href="#cb30-378"></a><span class="in">    println!("{:032b}", b);</span></span>
<span id="cb30-379"><a href="#cb30-379"></a><span class="in">    println!("{:1.100}", f32::from_bits(b));</span></span>
<span id="cb30-380"><a href="#cb30-380"></a><span class="in">    let x:f32 = 10.0_f32.powf(-38.0_f32);</span></span>
<span id="cb30-381"><a href="#cb30-381"></a><span class="in">    println!("{:032b}", x.to_bits());</span></span>
<span id="cb30-382"><a href="#cb30-382"></a><span class="in">    println!("{:1.100}", x);</span></span>
<span id="cb30-383"><a href="#cb30-383"></a><span class="in">}</span></span>
<span id="cb30-384"><a href="#cb30-384"></a><span class="in">```</span></span>
<span id="cb30-385"><a href="#cb30-385"></a><span class="ss">- </span>Results are as expected.</span>
<span id="cb30-386"><a href="#cb30-386"></a><span class="in">```sh</span></span>
<span id="cb30-387"><a href="#cb30-387"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb30-388"><a href="#cb30-388"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span>
<span id="cb30-389"><a href="#cb30-389"></a><span class="ex">00000000011011001110001111101110</span></span>
<span id="cb30-390"><a href="#cb30-390"></a><span class="ex">0.0000000000000000000000000000000000000099999993504564039245746141539976645128551939195729831580121175</span></span>
<span id="cb30-391"><a href="#cb30-391"></a><span class="in">```</span></span>
<span id="cb30-392"><a href="#cb30-392"></a></span>
<span id="cb30-393"><a href="#cb30-393"></a></span>
<span id="cb30-394"><a href="#cb30-394"></a><span class="fu">## "Denormalized Number"</span></span>
<span id="cb30-395"><a href="#cb30-395"></a></span>
<span id="cb30-396"><a href="#cb30-396"></a><span class="ss">- </span>Numbers that have a zero exponent</span>
<span id="cb30-397"><a href="#cb30-397"></a><span class="ss">- </span>Required when the exponent is below the minimum exponent</span>
<span id="cb30-398"><a href="#cb30-398"></a><span class="ss">- </span>Helps prevent underflow</span>
<span id="cb30-399"><a href="#cb30-399"></a><span class="ss">- </span>Generally speaking, if you are using one these, the math is about to get wronger than you'd think.</span>
<span id="cb30-400"><a href="#cb30-400"></a><span class="ss">- </span>The good (???) language C++ provides a <span class="in">`std::nextafter`</span> for which Rust crates exist.</span>
<span id="cb30-401"><a href="#cb30-401"></a></span>
<span id="cb30-402"><a href="#cb30-402"></a><span class="fu">## Floating Point Precision</span></span>
<span id="cb30-403"><a href="#cb30-403"></a></span>
<span id="cb30-404"><a href="#cb30-404"></a></span>
<span id="cb30-405"><a href="#cb30-405"></a><span class="ss">- </span>Representation is not uniform between numbers</span>
<span id="cb30-406"><a href="#cb30-406"></a><span class="ss">- </span>Most precision lies between 0.0 and 0.1</span>
<span id="cb30-407"><a href="#cb30-407"></a><span class="ss">- </span>Precision falls away</span>
<span id="cb30-408"><a href="#cb30-408"></a></span>
<span id="cb30-409"><a href="#cb30-409"></a><span class="fu">## Visually</span></span>
<span id="cb30-410"><a href="#cb30-410"></a></span>
<span id="cb30-411"><a href="#cb30-411"></a><span class="al">![](https://dwayneneed.github.io/static/img/2010-05-06-fun-with-floating-point_6bit-float-distribution.png)</span></span>
<span id="cb30-412"><a href="#cb30-412"></a></span>
<span id="cb30-413"><a href="#cb30-413"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Fun with floating point, Dwayne Need</span><span class="co">](https://dwayneneed.github.io/.net/2010/05/06/fun-with-floating-point.html)</span></span>
<span id="cb30-414"><a href="#cb30-414"></a></span>
<span id="cb30-415"><a href="#cb30-415"></a><span class="fu">## Floating Point Precision</span></span>
<span id="cb30-416"><a href="#cb30-416"></a></span>
<span id="cb30-417"><a href="#cb30-417"></a>The number of floats from 0.0</span>
<span id="cb30-418"><a href="#cb30-418"></a></span>
<span id="cb30-419"><a href="#cb30-419"></a><span class="ss">- </span>... to 0.1 = 1,036,831,949</span>
<span id="cb30-420"><a href="#cb30-420"></a><span class="ss">- </span>... to 0.2 = 8,388,608</span>
<span id="cb30-421"><a href="#cb30-421"></a><span class="ss">- </span>... to 0.4 = 8,388,608</span>
<span id="cb30-422"><a href="#cb30-422"></a><span class="ss">- </span>... to 0.8 = 8,388,608</span>
<span id="cb30-423"><a href="#cb30-423"></a><span class="ss">- </span>... to 1.6 = 8,388,608</span>
<span id="cb30-424"><a href="#cb30-424"></a><span class="ss">- </span>... to 3.2 = 8,388,608</span>
<span id="cb30-425"><a href="#cb30-425"></a></span>
<span id="cb30-426"><a href="#cb30-426"></a></span>
<span id="cb30-427"><a href="#cb30-427"></a><span class="fu">## Errors in Floating Point</span></span>
<span id="cb30-428"><a href="#cb30-428"></a></span>
<span id="cb30-429"><a href="#cb30-429"></a><span class="ss">- </span>Storage of $\pi$</span>
<span id="cb30-430"><a href="#cb30-430"></a><span class="in">```py</span></span>
<span id="cb30-431"><a href="#cb30-431"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> numpy <span class="im">import</span> pi <span class="im">as</span> pi</span>
<span id="cb30-432"><a href="#cb30-432"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># copy paste Wolfram|Alpha</span></span>
<span id="cb30-433"><a href="#cb30-433"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb30-434"><a href="#cb30-434"></a><span class="co">'3.14159265358979323846264338327950288419716939937510582097494459230781640628'</span></span>
<span id="cb30-435"><a href="#cb30-435"></a><span class="op">&gt;&gt;&gt;</span> <span class="ss">f'</span><span class="sc">{</span>pi<span class="sc">:1.100}</span><span class="ss">'</span></span>
<span id="cb30-436"><a href="#cb30-436"></a><span class="co">'3.141592653589793115997963468544185161590576171875'</span></span>
<span id="cb30-437"><a href="#cb30-437"></a><span class="in">```</span></span>
<span id="cb30-438"><a href="#cb30-438"></a><span class="ss">- </span>They differ fairly early on!</span>
<span id="cb30-439"><a href="#cb30-439"></a></span>
<span id="cb30-440"><a href="#cb30-440"></a><span class="fu">## Measuring Error: "Ulps"</span></span>
<span id="cb30-441"><a href="#cb30-441"></a></span>
<span id="cb30-442"><a href="#cb30-442"></a><span class="ss">- </span>Units in Last Place</span>
<span id="cb30-443"><a href="#cb30-443"></a></span>
<span id="cb30-444"><a href="#cb30-444"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">In computer science and numerical analysis, unit in the last place or unit of least precision (ulp) is the spacing between two consecutive floating-point numbers, i.e., the value the least significant digit (rightmost digit) represents if it is 1. It is used as a measure of accuracy in numeric calculations.</span><span class="co">](https://en.wikipedia.org/wiki/Unit_in_the_last_place)</span></span>
<span id="cb30-445"><a href="#cb30-445"></a></span>
<span id="cb30-446"><a href="#cb30-446"></a><span class="fu">## Haskell</span></span>
<span id="cb30-447"><a href="#cb30-447"></a></span>
<span id="cb30-448"><a href="#cb30-448"></a><span class="ss">- </span>Usually ULP is taught using <span class="co">[</span><span class="ot">Haskell</span><span class="co">](https://en.wikipedia.org/wiki/Unit_in_the_last_place#Example_1)</span>.</span>
<span id="cb30-449"><a href="#cb30-449"></a></span>
<span id="cb30-450"><a href="#cb30-450"></a><span class="in">```haskell</span></span>
<span id="cb30-451"><a href="#cb30-451"></a><span class="op">&gt;</span> <span class="fu">until</span> (\x <span class="ot">-&gt;</span> x <span class="op">==</span> x<span class="op">+</span><span class="dv">1</span>) (<span class="op">+</span><span class="dv">1</span>) <span class="dv">0</span><span class="ot"> ::</span> <span class="dt">Float</span></span>
<span id="cb30-452"><a href="#cb30-452"></a><span class="fl">1.6777216e7</span></span>
<span id="cb30-453"><a href="#cb30-453"></a><span class="op">&gt;</span> it<span class="op">-</span><span class="dv">1</span></span>
<span id="cb30-454"><a href="#cb30-454"></a><span class="fl">1.6777215e7</span></span>
<span id="cb30-455"><a href="#cb30-455"></a><span class="op">&gt;</span> it<span class="op">+</span><span class="dv">1</span></span>
<span id="cb30-456"><a href="#cb30-456"></a><span class="fl">1.6777216e7</span></span>
<span id="cb30-457"><a href="#cb30-457"></a><span class="ot">```</span></span>
<span id="cb30-458"><a href="#cb30-458"></a></span>
<span id="cb30-459"><a href="#cb30-459"></a><span class="ot">- I'll translate to .py/.rs</span></span>
<span id="cb30-460"><a href="#cb30-460"></a></span>
<span id="cb30-461"><a href="#cb30-461"></a><span class="ot">## Generators</span></span>
<span id="cb30-462"><a href="#cb30-462"></a></span>
<span id="cb30-463"><a href="#cb30-463"></a><span class="ot">- By convention we check number theoretic results with lazily evaluated generator expressions in Python.</span></span>
<span id="cb30-464"><a href="#cb30-464"></a><span class="ot">- The following generators all powers of two for a which adding one does not change the value within Python floating points.</span></span>
<span id="cb30-465"><a href="#cb30-465"></a><span class="ot">```</span>py</span>
<span id="cb30-466"><a href="#cb30-466"></a>from itertools <span class="kw">import</span> count</span>
<span id="cb30-467"><a href="#cb30-467"></a></span>
<span id="cb30-468"><a href="#cb30-468"></a>gen <span class="ot">=</span> (i for i <span class="kw">in</span> count() <span class="kw">if</span> <span class="fl">2.0</span> <span class="op">**</span> float(i) <span class="op">+</span> <span class="fl">1.0</span> <span class="op">==</span> <span class="fl">2.0</span> <span class="op">**</span> float(i))</span>
<span id="cb30-469"><a href="#cb30-469"></a></span>
<span id="cb30-470"><a href="#cb30-470"></a>x <span class="ot">=</span> next(gen)</span>
<span id="cb30-471"><a href="#cb30-471"></a></span>
<span id="cb30-472"><a href="#cb30-472"></a><span class="fu">print</span>('<span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">0.0</span> <span class="ot">=</span> ', <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">0.0</span>)</span>
<span id="cb30-473"><a href="#cb30-473"></a><span class="fu">print</span>('<span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">1.0</span> <span class="ot">=</span> ', <span class="fl">2.0</span> <span class="op">**</span> x <span class="op">+</span> <span class="fl">1.0</span>)</span>
<span id="cb30-474"><a href="#cb30-474"></a><span class="ot">```</span></span>
<span id="cb30-475"><a href="#cb30-475"></a></span>
<span id="cb30-476"><a href="#cb30-476"></a><span class="ot">## Iterators</span></span>
<span id="cb30-477"><a href="#cb30-477"></a></span>
<span id="cb30-478"><a href="#cb30-478"></a><span class="ot">- Rust doesn't require iterators, supporting the infinite iterator by default using `</span>unwrap<span class="ot">`.</span></span>
<span id="cb30-479"><a href="#cb30-479"></a><span class="ot">```</span>rs</span>
<span id="cb30-480"><a href="#cb30-480"></a><span class="kw">let</span> x <span class="ot">=</span> (<span class="dv">0</span><span class="op">..</span>)<span class="op">.</span>find(<span class="op">|&amp;</span>i<span class="op">|</span><span class="ot"> f64::</span>powi(<span class="fl">2.0</span>, i) <span class="op">+</span> <span class="fl">1.0</span> <span class="op">==</span><span class="ot"> f64::</span>powi(<span class="fl">2.0</span>, i))<span class="op">.</span>unwrap();</span>
<span id="cb30-481"><a href="#cb30-481"></a></span>
<span id="cb30-482"><a href="#cb30-482"></a><span class="kw">let</span> base <span class="ot">= f64::</span>powi(<span class="fl">2.0</span>, x);</span>
<span id="cb30-483"><a href="#cb30-483"></a></span>
<span id="cb30-484"><a href="#cb30-484"></a><span class="op">//</span> <span class="dt">Prints</span> the result (<span class="dv">2</span><span class="op">^</span><span class="dv">53</span> <span class="ot">=</span> <span class="fl">9007199254740992.0</span>)</span>
<span id="cb30-485"><a href="#cb30-485"></a>println<span class="op">!</span>(<span class="st">"2.0 ** x + 0.0 = {:.1}"</span>, base);</span>
<span id="cb30-486"><a href="#cb30-486"></a>println<span class="op">!</span>(<span class="st">"2.0 ** x + 1.0 = {:.1}"</span>, base <span class="op">+</span> <span class="fl">1.0</span>);</span>
<span id="cb30-487"><a href="#cb30-487"></a><span class="ot">```</span></span>
<span id="cb30-488"><a href="#cb30-488"></a><span class="ot">- I haven't used `</span>find<span class="ot">` before, this is an LLM donation to our knowledge base.</span></span>
<span id="cb30-489"><a href="#cb30-489"></a><span class="ot">- By the way, that is basically `</span><span class="dv">2</span> <span class="op">**</span> <span class="dv">53</span><span class="ot">` and there are 52 bits of mantissa precision.</span></span>
<span id="cb30-490"><a href="#cb30-490"></a></span>
<span id="cb30-491"><a href="#cb30-491"></a><span class="ot">## On "Ulps"</span></span>
<span id="cb30-492"><a href="#cb30-492"></a></span>
<span id="cb30-493"><a href="#cb30-493"></a><span class="ot">- We can measure error using ULPs.</span></span>
<span id="cb30-494"><a href="#cb30-494"></a></span>
<span id="cb30-495"><a href="#cb30-495"></a><span class="ot">&gt; [The gap between the two floating-point numbers nearest to x, even if x is one of )them.](https://www.cs.berkeley.edu/~wkahan/LOG10HAF.TXT)</span></span>
<span id="cb30-496"><a href="#cb30-496"></a></span>
<span id="cb30-497"><a href="#cb30-497"></a><span class="ot">```</span>py</span>
<span id="cb30-498"><a href="#cb30-498"></a><span class="op">&gt;&gt;&gt;</span> from numpy <span class="kw">import</span> float32 <span class="kw">as</span> f32, pi <span class="kw">as</span> pi, float64 <span class="kw">as</span> f64</span>
<span id="cb30-499"><a href="#cb30-499"></a><span class="op">&gt;&gt;&gt;</span> f64(<span class="fu">pi</span>) <span class="op">-</span> f64(f32(<span class="fu">pi</span>))</span>
<span id="cb30-500"><a href="#cb30-500"></a>np<span class="op">.</span>float64(<span class="op">-</span><span class="fl">8.742278012618954e-08</span>)</span>
<span id="cb30-501"><a href="#cb30-501"></a><span class="ot">```</span></span>
<span id="cb30-502"><a href="#cb30-502"></a></span>
<span id="cb30-503"><a href="#cb30-503"></a><span class="ot">## Rounding</span></span>
<span id="cb30-504"><a href="#cb30-504"></a></span>
<span id="cb30-505"><a href="#cb30-505"></a><span class="ot">- We have some guarantees:</span></span>
<span id="cb30-506"><a href="#cb30-506"></a><span class="ot">    - IEEE 754 requires that that elementary arithmetic operations are correctly rounded to within 0.5 ulps</span></span>
<span id="cb30-507"><a href="#cb30-507"></a><span class="ot">    - Transcendental functions are generally rounded to between 0.5 and 1.0 ulps</span></span>
<span id="cb30-508"><a href="#cb30-508"></a><span class="ot">        - Transcendental as in $\pi$ or $e$</span></span>
<span id="cb30-509"><a href="#cb30-509"></a></span>
<span id="cb30-510"><a href="#cb30-510"></a><span class="ot">- ~9 ulps</span></span>
<span id="cb30-511"><a href="#cb30-511"></a></span>
<span id="cb30-512"><a href="#cb30-512"></a><span class="ot"># Relative Error</span></span>
<span id="cb30-513"><a href="#cb30-513"></a></span>
<span id="cb30-514"><a href="#cb30-514"></a><span class="ot">- The difference between the "real" number and the approximated number, divided by the "real" number.</span></span>
<span id="cb30-515"><a href="#cb30-515"></a></span>
<span id="cb30-516"><a href="#cb30-516"></a><span class="ot">```</span>py</span>
<span id="cb30-517"><a href="#cb30-517"></a><span class="op">&gt;&gt;&gt;</span> f64(f32(<span class="fu">pi</span>))<span class="op">/</span>f64(<span class="fu">pi</span>)</span>
<span id="cb30-518"><a href="#cb30-518"></a>np<span class="op">.</span>float64(<span class="fl">1.0000000278275352</span>)</span>
<span id="cb30-519"><a href="#cb30-519"></a><span class="ot">```</span></span>
<span id="cb30-520"><a href="#cb30-520"></a></span>
<span id="cb30-521"><a href="#cb30-521"></a><span class="ot">- So for `</span>pi<span class="ot">` in `</span>f32<span class="ot">`, around $2.9 \times 10^{-8}$</span></span>
<span id="cb30-522"><a href="#cb30-522"></a></span>
<span id="cb30-523"><a href="#cb30-523"></a><span class="ot">## Rounding Error</span></span>
<span id="cb30-524"><a href="#cb30-524"></a></span>
<span id="cb30-525"><a href="#cb30-525"></a><span class="ot">- Induced by approximating an infinite range of numbers into a finite number of bits</span></span>
<span id="cb30-526"><a href="#cb30-526"></a><span class="ot">- Rounding is:</span></span>
<span id="cb30-527"><a href="#cb30-527"></a><span class="ot">    - Towards the nearest</span></span>
<span id="cb30-528"><a href="#cb30-528"></a><span class="ot">    - Towards zero</span></span>
<span id="cb30-529"><a href="#cb30-529"></a><span class="ot">    - Towards positive infinity (round up)</span></span>
<span id="cb30-530"><a href="#cb30-530"></a><span class="ot">    - Towards negative infinity (round down)</span></span>
<span id="cb30-531"><a href="#cb30-531"></a></span>
<span id="cb30-532"><a href="#cb30-532"></a><span class="ot">## Rounding Error</span></span>
<span id="cb30-533"><a href="#cb30-533"></a></span>
<span id="cb30-534"><a href="#cb30-534"></a><span class="ot">- What about rounding the half-way case? (i.e. 0.5)</span></span>
<span id="cb30-535"><a href="#cb30-535"></a><span class="ot">    - Round Up vs. Round Even</span></span>
<span id="cb30-536"><a href="#cb30-536"></a><span class="ot">- Correct Rounding:</span></span>
<span id="cb30-537"><a href="#cb30-537"></a><span class="ot">    - Basic operations (add, subtract, multiply, divide, sqrt) should return the number nearest the</span></span>
<span id="cb30-538"><a href="#cb30-538"></a><span class="ot">       mathematical result.</span></span>
<span id="cb30-539"><a href="#cb30-539"></a><span class="ot">    - If there is a tie, round to the number with an even mantissa</span></span>
<span id="cb30-540"><a href="#cb30-540"></a></span>
<span id="cb30-541"><a href="#cb30-541"></a><span class="ot">## Implementation</span></span>
<span id="cb30-542"><a href="#cb30-542"></a></span>
<span id="cb30-543"><a href="#cb30-543"></a><span class="ot">- "Guard Bit", "Round Bit", "Sticky Bit"</span></span>
<span id="cb30-544"><a href="#cb30-544"></a><span class="ot">- Only used while doing calculations</span></span>
<span id="cb30-545"><a href="#cb30-545"></a><span class="ot">    - Not stored in the float itself</span></span>
<span id="cb30-546"><a href="#cb30-546"></a><span class="ot">    - The mantissa is shifted in calculations to align radix</span></span>
<span id="cb30-547"><a href="#cb30-547"></a><span class="ot">- The guard bits and round bits are extra precision</span></span>
<span id="cb30-548"><a href="#cb30-548"></a><span class="ot">- The sticky bit is an OR of anything that shifts through it</span></span>
<span id="cb30-549"><a href="#cb30-549"></a></span>
<span id="cb30-550"><a href="#cb30-550"></a><span class="ot">```</span>rs</span>
<span id="cb30-551"><a href="#cb30-551"></a><span class="dv">0</span>_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span>
<span id="cb30-552"><a href="#cb30-552"></a><span class="ot">```</span></span>
<span id="cb30-553"><a href="#cb30-553"></a></span>
<span id="cb30-554"><a href="#cb30-554"></a><span class="ot">## Special bits</span></span>
<span id="cb30-555"><a href="#cb30-555"></a></span>
<span id="cb30-556"><a href="#cb30-556"></a><span class="ot">- "Guard Bit", "Round Bit", "Sticky Bit"</span></span>
<span id="cb30-557"><a href="#cb30-557"></a><span class="ot">- **[G][R][S]**</span></span>
<span id="cb30-558"><a href="#cb30-558"></a><span class="ot">- **[0][-][-]** - Round Down (do nothing)</span></span>
<span id="cb30-559"><a href="#cb30-559"></a><span class="ot">- **[1][0][0]** - Round Up if the mantissa LSB is 1</span></span>
<span id="cb30-560"><a href="#cb30-560"></a><span class="ot">- **[1][0][1]** - Round Up</span></span>
<span id="cb30-561"><a href="#cb30-561"></a><span class="ot">- **[1][1][0]** - Round Up</span></span>
<span id="cb30-562"><a href="#cb30-562"></a><span class="ot">- **[1][1][1]** - Round Up</span></span>
<span id="cb30-563"><a href="#cb30-563"></a></span>
<span id="cb30-564"><a href="#cb30-564"></a><span class="ot">```</span>rs</span>
<span id="cb30-565"><a href="#cb30-565"></a><span class="dv">0</span>_00000000_00000000000000000000000_G_R_S<span class="op">..</span></span>
<span id="cb30-566"><a href="#cb30-566"></a><span class="ot">```</span></span>
<span id="cb30-567"><a href="#cb30-567"></a></span>
<span id="cb30-568"><a href="#cb30-568"></a><span class="ot">## Significance Error</span></span>
<span id="cb30-569"><a href="#cb30-569"></a></span>
<span id="cb30-570"><a href="#cb30-570"></a><span class="ot">- Compute the Area of a Triangle given side lengths</span></span>
<span id="cb30-571"><a href="#cb30-571"></a><span class="ot">- [Hero(n)’s Formula](https://en.wikipedia.org/wiki/Heron%27s_formula):</span></span>
<span id="cb30-572"><a href="#cb30-572"></a><span class="ot">    - Take $s = \frac{1}{2}(a + b + c)$</span></span>
<span id="cb30-573"><a href="#cb30-573"></a><span class="ot">    - Then $\sqrt{s(s-a)(s-b)(s-c)}$</span></span>
<span id="cb30-574"><a href="#cb30-574"></a></span>
<span id="cb30-575"><a href="#cb30-575"></a><span class="ot">- [Kahan’s Algorithm](https://people.eecs.berkeley.edu/~wkahan/Triangle.pdf):</span></span>
<span id="cb30-576"><a href="#cb30-576"></a><span class="ot">   - Take $((a, b, c) | a \leq b \leq c)$</span></span>
<span id="cb30-577"><a href="#cb30-577"></a><span class="ot">   - Then $\sqrt{\frac{(x + (y + z)) \times (z - (x - y)) \times (z + (x - y)) \times (x + (y - z))}{4}}$</span></span>
<span id="cb30-578"><a href="#cb30-578"></a></span>
<span id="cb30-579"><a href="#cb30-579"></a><span class="ot">## Write them</span></span>
<span id="cb30-580"><a href="#cb30-580"></a></span>
<span id="cb30-581"><a href="#cb30-581"></a><span class="ot">```</span>{<span class="op">.</span>rs filename<span class="ot">=</span><span class="st">"src/lib.rs"</span>}</span>
<span id="cb30-582"><a href="#cb30-582"></a>fn heron(a<span class="op">:</span>f32, b<span class="op">:</span>f32, c<span class="op">:</span>f32) <span class="ot">-&gt;</span> f32 {</span>
<span id="cb30-583"><a href="#cb30-583"></a>    <span class="kw">let</span> s <span class="ot">=</span> (a <span class="op">+</span> b <span class="op">+</span> c)<span class="op">/</span><span class="fl">2.0</span>_f32;</span>
<span id="cb30-584"><a href="#cb30-584"></a>    <span class="fu">return</span> (s <span class="op">*</span> (s <span class="op">-</span> a) <span class="op">*</span> (s <span class="op">-</span> b) <span class="op">*</span> (s <span class="op">-</span> c))<span class="op">.</span><span class="fu">sqrt</span>();</span>
<span id="cb30-585"><a href="#cb30-585"></a>}</span>
<span id="cb30-586"><a href="#cb30-586"></a></span>
<span id="cb30-587"><a href="#cb30-587"></a>fn kahan(a<span class="op">:</span>f32, b<span class="op">:</span>f32, c<span class="op">:</span>f32) <span class="ot">-&gt;</span> f32 {</span>
<span id="cb30-588"><a href="#cb30-588"></a>    <span class="kw">let</span> mut s <span class="ot">=</span> vec<span class="op">!</span>[a,b,c];</span>
<span id="cb30-589"><a href="#cb30-589"></a>    s<span class="op">.</span>sort_by(<span class="op">|</span>a, b<span class="op">|</span> a<span class="op">.</span>partial_cmp(b)<span class="op">.</span>unwrap()); <span class="op">//</span> <span class="st">"partial"</span><span class="op">?</span> <span class="dt">Why</span> <span class="fu">not</span> <span class="ot">`.sort`</span><span class="op">?</span></span>
<span id="cb30-590"><a href="#cb30-590"></a>    <span class="kw">let</span> mut prod <span class="ot">=</span> s[<span class="dv">0</span>] <span class="op">+</span> s[<span class="dv">1</span>] <span class="op">+</span> s[<span class="dv">2</span>];</span>
<span id="cb30-591"><a href="#cb30-591"></a>    prod <span class="op">*=</span> s[<span class="dv">2</span>] <span class="op">-</span> (s[<span class="dv">0</span>] <span class="op">-</span> s[<span class="dv">1</span>]);</span>
<span id="cb30-592"><a href="#cb30-592"></a>    prod <span class="op">*=</span> s[<span class="dv">2</span>] <span class="op">+</span> (s[<span class="dv">0</span>] <span class="op">-</span> s[<span class="dv">1</span>]);</span>
<span id="cb30-593"><a href="#cb30-593"></a>    prod <span class="op">*=</span> s[<span class="dv">0</span>] <span class="op">+</span> (s[<span class="dv">1</span>] <span class="op">-</span> s[<span class="dv">2</span>]);</span>
<span id="cb30-594"><a href="#cb30-594"></a>    <span class="fu">return</span> prod<span class="op">.</span><span class="fu">sqrt</span>() <span class="op">/</span> <span class="fl">4.0</span>;</span>
<span id="cb30-595"><a href="#cb30-595"></a>}</span>
<span id="cb30-596"><a href="#cb30-596"></a><span class="ot">```</span></span>
<span id="cb30-597"><a href="#cb30-597"></a></span>
<span id="cb30-598"><a href="#cb30-598"></a><span class="ot">## Test them</span></span>
<span id="cb30-599"><a href="#cb30-599"></a></span>
<span id="cb30-600"><a href="#cb30-600"></a><span class="ot">```</span>{<span class="op">.</span>rs filename<span class="ot">=</span><span class="st">"src/main.rs"</span>}</span>
<span id="cb30-601"><a href="#cb30-601"></a>fn main(){</span>
<span id="cb30-602"><a href="#cb30-602"></a>    dbg<span class="op">!</span>(heron(<span class="fl">3.0</span>,<span class="fl">4.0</span>,<span class="fl">5.0</span>));</span>
<span id="cb30-603"><a href="#cb30-603"></a>    dbg<span class="op">!</span>(kahan(<span class="fl">3.0</span>,<span class="fl">4.0</span>,<span class="fl">5.0</span>));</span>
<span id="cb30-604"><a href="#cb30-604"></a>    <span class="kw">let</span> a <span class="ot">=</span> <span class="dv">100</span>_000<span class="op">.</span><span class="dv">0</span>_f32;</span>
<span id="cb30-605"><a href="#cb30-605"></a>    <span class="kw">let</span> c <span class="ot">=</span> <span class="fl">0.01</span>_f32;</span>
<span id="cb30-606"><a href="#cb30-606"></a>    dbg<span class="op">!</span>(heron(a,a,c));</span>
<span id="cb30-607"><a href="#cb30-607"></a>    dbg<span class="op">!</span>(kahan(a,a,c));</span>
<span id="cb30-608"><a href="#cb30-608"></a>}</span>
<span id="cb30-609"><a href="#cb30-609"></a><span class="ot">```</span></span>
<span id="cb30-610"><a href="#cb30-610"></a><span class="ot">- Oh what's that?</span></span>
<span id="cb30-611"><a href="#cb30-611"></a><span class="ot">```</span>sh</span>
<span id="cb30-612"><a href="#cb30-612"></a>[src<span class="op">/</span>main<span class="op">.</span>rs<span class="op">:</span><span class="dv">21</span><span class="op">:</span><span class="dv">5</span>] heron(<span class="fl">3.0</span>,<span class="fl">4.0</span>,<span class="fl">5.0</span>) <span class="ot">=</span> <span class="fl">6.0</span></span>
<span id="cb30-613"><a href="#cb30-613"></a>[src<span class="op">/</span>main<span class="op">.</span>rs<span class="op">:</span><span class="dv">22</span><span class="op">:</span><span class="dv">5</span>] kahan(<span class="fl">3.0</span>,<span class="fl">4.0</span>,<span class="fl">5.0</span>) <span class="ot">=</span> <span class="fl">6.0</span></span>
<span id="cb30-614"><a href="#cb30-614"></a>[src<span class="op">/</span>main<span class="op">.</span>rs<span class="op">:</span><span class="dv">25</span><span class="op">:</span><span class="dv">5</span>] heron(a,a,c) <span class="ot">=</span> <span class="fl">781.25006</span></span>
<span id="cb30-615"><a href="#cb30-615"></a>[src<span class="op">/</span>main<span class="op">.</span>rs<span class="op">:</span><span class="dv">26</span><span class="op">:</span><span class="dv">5</span>] kahan(a,a,c) <span class="ot">=</span> <span class="fl">500.0</span></span>
<span id="cb30-616"><a href="#cb30-616"></a><span class="ot">```</span></span>
<span id="cb30-617"><a href="#cb30-617"></a><span class="ot">- Using `</span>f64<span class="ot">` (vs `</span>f32<span class="ot">`) we get 499.9999999999994</span></span>
<span id="cb30-618"><a href="#cb30-618"></a></span>
<span id="cb30-619"><a href="#cb30-619"></a><span class="ot">## Significance Error</span></span>
<span id="cb30-620"><a href="#cb30-620"></a></span>
<span id="cb30-621"><a href="#cb30-621"></a><span class="ot">- Use Stable Algorithms</span></span>
<span id="cb30-622"><a href="#cb30-622"></a><span class="ot">    - Keep big numbers with big numbers, little numbers with little numbers.</span></span>
<span id="cb30-623"><a href="#cb30-623"></a><span class="ot">- Parentheses can help</span></span>
<span id="cb30-624"><a href="#cb30-624"></a><span class="ot">- The compiler won’t re-arrange your math if it cannot prove it would yield the same!</span></span>
<span id="cb30-625"><a href="#cb30-625"></a><span class="ot">    - E.g. you can't use `</span><span class="op">&lt;</span><span class="ot">` in Rust as you may provide a `</span><span class="dt">NaN</span><span class="ot">`.</span></span>
<span id="cb30-626"><a href="#cb30-626"></a></span>
<span id="cb30-627"><a href="#cb30-627"></a></span>
<span id="cb30-628"><a href="#cb30-628"></a><span class="ot">## Significance Error – Don’t floats?</span></span>
<span id="cb30-629"><a href="#cb30-629"></a></span>
<span id="cb30-630"><a href="#cb30-630"></a><span class="ot">- Use integers</span></span>
<span id="cb30-631"><a href="#cb30-631"></a><span class="ot">    - Very fast</span></span>
<span id="cb30-632"><a href="#cb30-632"></a><span class="ot">    - Trade more precision for less range</span></span>
<span id="cb30-633"><a href="#cb30-633"></a><span class="ot">    - Only input/output may be impacted by floating point conversions</span></span>
<span id="cb30-634"><a href="#cb30-634"></a><span class="ot">    - Financial applications represent dollars as only cents or tenth’s of cents</span></span>
<span id="cb30-635"><a href="#cb30-635"></a><span class="ot">    </span></span>
<span id="cb30-636"><a href="#cb30-636"></a><span class="ot">## Significance Error – Don’t floats?</span></span>
<span id="cb30-637"><a href="#cb30-637"></a></span>
<span id="cb30-638"><a href="#cb30-638"></a><span class="ot">- Use a math library</span></span>
<span id="cb30-639"><a href="#cb30-639"></a><span class="ot">    - Slower</span></span>
<span id="cb30-640"><a href="#cb30-640"></a><span class="ot">    - Define your own level of accuracy</span></span>
<span id="cb30-641"><a href="#cb30-641"></a><span class="ot">    - Usually GMP or hardware specific.</span></span>
<span id="cb30-642"><a href="#cb30-642"></a><span class="ot">    </span></span>
<span id="cb30-643"><a href="#cb30-643"></a><span class="ot">## Significance Error – Don’t floats?</span></span>
<span id="cb30-644"><a href="#cb30-644"></a></span>
<span id="cb30-645"><a href="#cb30-645"></a><span class="ot">- Execute symbolically</span></span>
<span id="cb30-646"><a href="#cb30-646"></a><span class="ot">    - Slowest</span></span>
<span id="cb30-647"><a href="#cb30-647"></a><span class="ot">    - Arbitrary accuracy</span></span>
<span id="cb30-648"><a href="#cb30-648"></a><span class="ot">    - Round only at output</span></span>
<span id="cb30-649"><a href="#cb30-649"></a><span class="ot">       </span></span>
<span id="cb30-650"><a href="#cb30-650"></a><span class="ot">## Significance Error – Don’t floats?</span></span>
<span id="cb30-651"><a href="#cb30-651"></a></span>
<span id="cb30-652"><a href="#cb30-652"></a><span class="ot">- Write your own library?</span></span>
<span id="cb30-653"><a href="#cb30-653"></a><span class="ot">    - Use vectors of bits or bytes.</span></span>
<span id="cb30-654"><a href="#cb30-654"></a><span class="ot">    - Write your own arithmetic operations.</span></span>
<span id="cb30-655"><a href="#cb30-655"></a><span class="ot">    - Test and debug your own implemention.</span></span>
<span id="cb30-656"><a href="#cb30-656"></a><span class="ot">- Coming soon to a homework near you!</span></span>
<span id="cb30-657"><a href="#cb30-657"></a></span>
<span id="cb30-658"><a href="#cb30-658"></a><span class="ot">## Algebraic Assumption Error</span></span>
<span id="cb30-659"><a href="#cb30-659"></a></span>
<span id="cb30-660"><a href="#cb30-660"></a><span class="ot">- Distributive Rule does not apply:</span></span>
<span id="cb30-661"><a href="#cb30-661"></a><span class="ot">    - $a = x \times y - x \times z \nRightarrow a = x (y - z)$</span></span>
<span id="cb30-662"><a href="#cb30-662"></a><span class="ot">- Associative Rule does not apply: 𝑥 + 𝑦 +𝑧 ≠ 𝑥 +𝑦 +𝑧</span></span>
<span id="cb30-663"><a href="#cb30-663"></a><span class="ot">    - $a = x + (y + z) \nRightarrow a = (x + y) + z$</span></span>
<span id="cb30-664"><a href="#cb30-664"></a><span class="ot">- Cannot interchange division and multiplication:</span></span>
<span id="cb30-665"><a href="#cb30-665"></a><span class="ot">    - $a = \frac{x}{10.0} \nRightarrow a = x \times 0.1$</span></span>
<span id="cb30-666"><a href="#cb30-666"></a></span>
<span id="cb30-667"><a href="#cb30-667"></a><span class="ot">## Distribution</span></span>
<span id="cb30-668"><a href="#cb30-668"></a></span>
<span id="cb30-669"><a href="#cb30-669"></a><span class="ot">```</span>py</span>
<span id="cb30-670"><a href="#cb30-670"></a><span class="op">&gt;&gt;&gt;</span> x, y, z</span>
<span id="cb30-671"><a href="#cb30-671"></a>(np<span class="op">.</span>float32(<span class="fl">1000000000.0</span>), np<span class="op">.</span>float32(<span class="fl">1.0000005</span>), np<span class="op">.</span>float32(<span class="fl">1.0</span>))</span>
<span id="cb30-672"><a href="#cb30-672"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">*</span> y <span class="op">-</span> x <span class="op">*</span> z ; x <span class="op">*</span> (y <span class="op">-</span> z)</span>
<span id="cb30-673"><a href="#cb30-673"></a>np<span class="op">.</span>float32(<span class="fl">448.0</span>)</span>
<span id="cb30-674"><a href="#cb30-674"></a>np<span class="op">.</span>float32(<span class="fl">476.83716</span>)</span>
<span id="cb30-675"><a href="#cb30-675"></a><span class="ot">```</span></span>
<span id="cb30-676"><a href="#cb30-676"></a></span>
<span id="cb30-677"><a href="#cb30-677"></a><span class="ot">## Association</span></span>
<span id="cb30-678"><a href="#cb30-678"></a></span>
<span id="cb30-679"><a href="#cb30-679"></a><span class="ot">```</span>py</span>
<span id="cb30-680"><a href="#cb30-680"></a><span class="op">&gt;&gt;&gt;</span> x, y, z</span>
<span id="cb30-681"><a href="#cb30-681"></a>(np<span class="op">.</span>float32(<span class="fl">16777216.0</span>), np<span class="op">.</span>float32(<span class="fl">1.0</span>), np<span class="op">.</span>float32(<span class="fl">1.0</span>))</span>
<span id="cb30-682"><a href="#cb30-682"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">+</span> (y <span class="op">+</span> z) ; (x <span class="op">+</span> y) <span class="op">+</span> z</span>
<span id="cb30-683"><a href="#cb30-683"></a>np<span class="op">.</span>float32(<span class="fl">16777218.0</span>)</span>
<span id="cb30-684"><a href="#cb30-684"></a>np<span class="op">.</span>float32(<span class="fl">16777216.0</span>)</span>
<span id="cb30-685"><a href="#cb30-685"></a><span class="ot">```</span></span>
<span id="cb30-686"><a href="#cb30-686"></a></span>
<span id="cb30-687"><a href="#cb30-687"></a><span class="ot">## Interchange</span></span>
<span id="cb30-688"><a href="#cb30-688"></a></span>
<span id="cb30-689"><a href="#cb30-689"></a><span class="ot">- Check last digit</span></span>
<span id="cb30-690"><a href="#cb30-690"></a></span>
<span id="cb30-691"><a href="#cb30-691"></a><span class="ot">```</span>py</span>
<span id="cb30-692"><a href="#cb30-692"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">7</span> <span class="op">/</span> <span class="dv">100000000</span></span>
<span id="cb30-693"><a href="#cb30-693"></a><span class="fl">1.4285714285714284e-09</span></span>
<span id="cb30-694"><a href="#cb30-694"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">100000000</span> <span class="op">/</span> <span class="dv">7</span></span>
<span id="cb30-695"><a href="#cb30-695"></a><span class="fl">1.4285714285714286e-09</span></span>
<span id="cb30-696"><a href="#cb30-696"></a><span class="ot">```</span></span>
<span id="cb30-697"><a href="#cb30-697"></a></span>
<span id="cb30-698"><a href="#cb30-698"></a><span class="ot">## Floating Point Exceptions</span></span>
<span id="cb30-699"><a href="#cb30-699"></a></span>
<span id="cb30-700"><a href="#cb30-700"></a><span class="ot">| IEEE 754 Exception | Result when traps disabled | Argument to trap handler |</span></span>
<span id="cb30-701"><a href="#cb30-701"></a><span class="ot">| :------------------ | :------------------------- | :----------------------- |</span></span>
<span id="cb30-702"><a href="#cb30-702"></a><span class="ot">| **overflow** | $\pm \infty$ or $\pm x_{\text{max}}$ | $\text{round}(x 2^{-a})$ |</span></span>
<span id="cb30-703"><a href="#cb30-703"></a><span class="ot">| **underflow** | $0, \pm 2^{\text{min}}$ or denormalized | $\text{round}(x 2^{a})$ |</span></span>
<span id="cb30-704"><a href="#cb30-704"></a><span class="ot">| **divide by zero** | $\pm \infty$               | invalid operation        |</span></span>
<span id="cb30-705"><a href="#cb30-705"></a><span class="ot">| **invalid** | $\text{NaN}$               | invalid operation        |</span></span>
<span id="cb30-706"><a href="#cb30-706"></a><span class="ot">| **inexact** | $\text{round}(x)$          | $\text{round}(x)$        |</span></span>
<span id="cb30-707"><a href="#cb30-707"></a></span>
<span id="cb30-708"><a href="#cb30-708"></a></span>
<span id="cb30-709"><a href="#cb30-709"></a><span class="ot">## But Wait! There’s More!</span></span>
<span id="cb30-710"><a href="#cb30-710"></a></span>
<span id="cb30-711"><a href="#cb30-711"></a><span class="ot">- Binary to Decimal Conversion Error</span></span>
<span id="cb30-712"><a href="#cb30-712"></a><span class="ot">- Summation Error</span></span>
<span id="cb30-713"><a href="#cb30-713"></a><span class="ot">- Propagation Error</span></span>
<span id="cb30-714"><a href="#cb30-714"></a><span class="ot">- Underflow, Overflow</span></span>
<span id="cb30-715"><a href="#cb30-715"></a><span class="ot">- Type Narrowing/Widening Rules</span></span>
<span id="cb30-716"><a href="#cb30-716"></a></span>
<span id="cb30-717"><a href="#cb30-717"></a><span class="ot">## Testing</span></span>
<span id="cb30-718"><a href="#cb30-718"></a></span>
<span id="cb30-719"><a href="#cb30-719"></a><span class="ot">- Design for Numerical Stability</span></span>
<span id="cb30-720"><a href="#cb30-720"></a><span class="ot">- Perform Meaningful Testing</span></span>
<span id="cb30-721"><a href="#cb30-721"></a><span class="ot">- Document assumptions</span></span>
<span id="cb30-722"><a href="#cb30-722"></a><span class="ot">- Track sources of approximation</span></span>
<span id="cb30-723"><a href="#cb30-723"></a><span class="ot">- Quantify goodness</span></span>
<span id="cb30-724"><a href="#cb30-724"></a><span class="ot">    - Well conditioned algorithms</span></span>
<span id="cb30-725"><a href="#cb30-725"></a><span class="ot">- Backward error analysis</span></span>
<span id="cb30-726"><a href="#cb30-726"></a><span class="ot">    - Are the outputs identical for slightly modified inputs?</span></span>
<span id="cb30-727"><a href="#cb30-727"></a></span>
<span id="cb30-728"><a href="#cb30-728"></a><span class="ot">## Today</span></span>
<span id="cb30-729"><a href="#cb30-729"></a></span>
<span id="cb30-730"><a href="#cb30-730"></a><span class="ot">- Understand precision through the lens of floats.</span></span>
<span id="cb30-731"><a href="#cb30-731"></a><span class="ot">    - Understand the basics of floats</span></span>
<span id="cb30-732"><a href="#cb30-732"></a><span class="ot">    - Understand the language of floats</span></span>
<span id="cb30-733"><a href="#cb30-733"></a><span class="ot">    - Get a feel for when further investigation is required</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>